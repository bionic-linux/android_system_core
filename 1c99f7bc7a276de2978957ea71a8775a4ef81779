{
  "comments": [
    {
      "key": {
        "uuid": "9f3ba272_57dfeafe",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2020-07-22T15:39:58Z",
      "side": 1,
      "message": "I thought the linux distro symlinks were to the device node in /dev, not a path to sysfs.  I checked my desktop and that is the case there.\n\nWe have /dev/block/by-name which includes \u0027userdata\u0027 as a symlink to the block device that backs \u0027userdata\u0027.  Albeit, it\u0027s the actual block device that holds the partition, not the dm-verity device that /data is mounted on.",
      "revId": "1c99f7bc7a276de2978957ea71a8775a4ef81779",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "680530b5_0dd31b01",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1176763
      },
      "writtenOn": "2020-07-22T15:55:23Z",
      "side": 1,
      "message": "Okay, I came to this based on Greg\u0027s comment.\nhttps://lore.kernel.org/linux-f2fs-devel/20200719151640.GA301791@kroah.com/\n\nIndeed, /dev looks bad for this as it is for the device node.\nHow do you feel about /sys/fs/by-partlabel/userdata -\u003e /sys/fs/f2fs/dm-4 ?",
      "parentUuid": "9f3ba272_57dfeafe",
      "revId": "1c99f7bc7a276de2978957ea71a8775a4ef81779",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "be93ddb7_23b4ed35",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2020-07-22T16:12:42Z",
      "side": 1,
      "message": "I don\u0027t think we can `mkdir` or `ln` in /sys, since it\u0027s not a real file system.",
      "parentUuid": "680530b5_0dd31b01",
      "revId": "1c99f7bc7a276de2978957ea71a8775a4ef81779",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0f7497c0_d2c191f2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1176763
      },
      "writtenOn": "2020-07-22T16:45:33Z",
      "side": 1,
      "message": "In that case, we were supposed to create it in kernel side.",
      "parentUuid": "be93ddb7_23b4ed35",
      "revId": "1c99f7bc7a276de2978957ea71a8775a4ef81779",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9d723dfb_9b5dd560",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1176763
      },
      "writtenOn": "2020-07-22T18:43:01Z",
      "side": 1,
      "message": "So, creating any symlink in sysfs is totally NAKed by Greg, and I returned back to manage this in user-land.\n\nTom, how do you think about new path to have some sysfs links like this?\n/syslink/fs/by-name/userdata -\u003e /sys/fs/f2fs/dm-X\n/syslink/block/bootdevice -\u003e /sys/devices/platform/\u003cufs\u003e\n/syslink/block/by-name/userdata -\u003e /sys/devices/virtual/block/dm-X",
      "parentUuid": "0f7497c0_d2c191f2",
      "revId": "1c99f7bc7a276de2978957ea71a8775a4ef81779",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a91df0f1_86ec78f6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2020-07-22T19:42:05Z",
      "side": 1,
      "message": "I\u0027d rather not create a new top level directory just to hold this.\n\nWho are the users of this symlink?  If it\u0027s all code, could we have a library that abstracts this read behind a function, GetUserdataSysfsPath() ?  I believe the properties have pretty wide read permissions, so that shouldn\u0027t be a blocker.",
      "parentUuid": "9d723dfb_9b5dd560",
      "revId": "1c99f7bc7a276de2978957ea71a8775a4ef81779",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "efde8491_26aaf1ad",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1176763
      },
      "writtenOn": "2020-07-22T20:57:16Z",
      "side": 1,
      "message": "Hmm, I found that actually /dev has many sysfs entries as well. (e.g., cpuset, blkio, memcg) So, it seems Android has relaxed this a bit?\n\nI\u0027m preparing back to use in /dev like:\n/dev/sys/block/by-name/userdata -\u003e /sys/block/dm-X\n/dev/sys/fs/by-name/userdata -\u003e /sys/fs/f2fs/dm-X\n/dev/sys/block/bootdevice -\u003e /sys/devices/platform/${ro.boot_devices}/ (in vendor.rc)\n\nIf we have this, we can simplify lots of redundant code to find dm-X such as dumpstate, powerhints, checkpoint_gc.sh, sysfs of fsmgr option and idleMaint, and many QA test cases. The main reason for this symlink is actually for powerhints which requires hardcoding that we can\u0027t use any library or script.\n\nWDYT?",
      "parentUuid": "a91df0f1_86ec78f6",
      "revId": "1c99f7bc7a276de2978957ea71a8775a4ef81779",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9f9c9e62_574cc194",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2020-07-22T22:12:52Z",
      "side": 1,
      "message": "Fair point.  cpuset, blkio, memcg aren\u0027t symlinks to /sys; they\u0027re actually their own mount points so I get your point that we\u0027re not strict about this.\n\n/dev/sys/... sounds better to me than /syslink as a top level directory.  I\u0027d be okay with this if no one else here objects.",
      "parentUuid": "efde8491_26aaf1ad",
      "revId": "1c99f7bc7a276de2978957ea71a8775a4ef81779",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1b9ef588_765df571",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2020-07-23T00:23:08Z",
      "side": 1,
      "message": "Agree, /dev/sys sounds better than /syslink.",
      "parentUuid": "9f9c9e62_574cc194",
      "revId": "1c99f7bc7a276de2978957ea71a8775a4ef81779",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e54a5c0f_d53b9660",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2020-07-23T03:41:29Z",
      "side": 1,
      "message": "/dev/sys looks ok to me.",
      "parentUuid": "1b9ef588_765df571",
      "revId": "1c99f7bc7a276de2978957ea71a8775a4ef81779",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}