{
  "comments": [
    {
      "key": {
        "uuid": "0192ef11_d49f58b8",
        "filename": "rootdir/init.rc",
        "patchSetId": 2
      },
      "lineNbr": 325,
      "author": {
        "id": 1103203
      },
      "writtenOn": "2019-08-29T15:37:20Z",
      "side": 1,
      "message": "Narayan, am I understanding correctly that exec will generally assume that the binary will return 0 in case of success, or nonzero in case of error?\n\nIf so, then I\u0027ll need to change \n\nhttp://r.android.com/c/platform/external/conscrypt/+/1107433/2/apex/selftest/boringssl_self_test.cpp\n\nbecause of the current draft, it returns nonzero in case of success, zero in case of failure.",
      "range": {
        "startLine": 325,
        "startChar": 0,
        "endLine": 325,
        "endChar": 62
      },
      "revId": "97fdd9b203647abea1f27b50160d513ecc2df052",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9403e896_223bd5a0",
        "filename": "rootdir/init.rc",
        "patchSetId": 2
      },
      "lineNbr": 325,
      "author": {
        "id": 1014443
      },
      "writtenOn": "2019-08-29T15:43:54Z",
      "side": 1,
      "message": "Yes, but does init\u0027s \"exec\" command care about the return value ?",
      "parentUuid": "0192ef11_d49f58b8",
      "range": {
        "startLine": 325,
        "startChar": 0,
        "endLine": 325,
        "endChar": 62
      },
      "revId": "97fdd9b203647abea1f27b50160d513ecc2df052",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b455884b_0fbb3d81",
        "filename": "rootdir/init.rc",
        "patchSetId": 2
      },
      "lineNbr": 325,
      "author": {
        "id": 1103203
      },
      "writtenOn": "2019-08-29T15:55:26Z",
      "side": 1,
      "message": "\u003e init\u0027s \"exec\" command care about the return value ?\n\nSeems like it doesn\u0027t, because it happily carries on if the exec\u0027d command returns 1.\n\nIs it possible to do anything here that reboots into bootloader if the exec\u0027d command abort()s or returns anything other than 0? That\u0027s the behavior that I\u0027d like to have. I can make boringssl_self_test.cpp call\n\nandroid_reboot(ANDROID_RB_RESTART2, 0, \"bootloader,boringssl-self-check-failed\");\n\nor similar, but then boringssl_self_test.cpp would gain a bunch of depdendencies again that I think might be cleaner to keep out of there because that binary is in a separate SELinux security domain.\n\nRight now, \n - the binary returns 1 in case of success, 0 in case of a bug where libcrypto isn\u0027t the FIPS version, and abort()s in case of failure.\n - init.rc\u0027s exec ignores the return value.\n\nWhat I\u0027d like:\n - in case of abort() or a non-zero return value, the device should reboot into bootloader\n   - this happens if the self test fails or libcrypto is not in FIPS mode\n - in case of zero return value (self test ran and succeeded), we should carry on.",
      "parentUuid": "9403e896_223bd5a0",
      "range": {
        "startLine": 325,
        "startChar": 0,
        "endLine": 325,
        "endChar": 62
      },
      "revId": "97fdd9b203647abea1f27b50160d513ecc2df052",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fcfb464d_7ecb2f42",
        "filename": "rootdir/init.rc",
        "patchSetId": 2
      },
      "lineNbr": 325,
      "author": {
        "id": 1014443
      },
      "writtenOn": "2019-08-29T15:57:59Z",
      "side": 1,
      "message": "That\u0027s a question for tomcherry@",
      "parentUuid": "b455884b_0fbb3d81",
      "range": {
        "startLine": 325,
        "startChar": 0,
        "endLine": 325,
        "endChar": 62
      },
      "revId": "97fdd9b203647abea1f27b50160d513ecc2df052",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "006e13e8_d1211bf1",
        "filename": "rootdir/init.rc",
        "patchSetId": 2
      },
      "lineNbr": 326,
      "author": {
        "id": 1103203
      },
      "writtenOn": "2019-08-29T17:03:47Z",
      "side": 1,
      "message": "Narayan/Tom: Can you think of any reason why the following might be happening:\n\n* It turns out that the *64 binary here successfully writes the marker file but the *32 one does not.\n* This is the case regardless of the order in which they are started here (initially I thought that maybe it was a race condition if apexd.status\u003dready was signalled slightly too early).\n* If I run the 32bit binary manually (as root), then it writes the missing marker file\n* running \"file boringssl_self_test*\" confirms that they are 32bit vs. 64bit binaries, respectively\n* based on logcat, both processes are run successfully:\n\nstarting service \u0027exec 15 (/apex/com.android.conscrypt/bin/boringssl_self_test64)\u0027...\nSVC_EXEC service \u0027exec 15 (/apex/com.android.conscrypt/bin/boringssl_self_test64)\u0027 pid 916 (uid 0 gid 0+0 context default) started; waiting...\nService \u0027exec 15 (/apex/com.android.conscrypt/bin/boringssl_self_test64)\u0027 (pid 916) exited with status 0 waiting took 0.019000 seconds\nstarting service \u0027exec 16 (/apex/com.android.conscrypt/bin/boringssl_self_test32)\u0027...\nSVC_EXEC service \u0027exec 16 (/apex/com.android.conscrypt/bin/boringssl_self_test32)\u0027 pid 917 (uid 0 gid 0+0 context default) started; waiting...\nService \u0027exec 16 (/apex/com.android.conscrypt/bin/boringssl_self_test32)\u0027 (pid 917) exited with status 0 waiting took 0.017000 seconds",
      "range": {
        "startLine": 326,
        "startChar": 0,
        "endLine": 326,
        "endChar": 62
      },
      "revId": "97fdd9b203647abea1f27b50160d513ecc2df052",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}