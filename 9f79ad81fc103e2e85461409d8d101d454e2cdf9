{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "0f0662c6_2093d00e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1157738
      },
      "writtenOn": "2022-08-10T06:13:36Z",
      "side": 1,
      "message": "I\u0027ll rely on TJ and Elliott to review this one.",
      "revId": "9f79ad81fc103e2e85461409d8d101d454e2cdf9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "de69d756_bd2fd063",
        "filename": "libprocessgroup/processgroup.cpp",
        "patchSetId": 4
      },
      "lineNbr": 175,
      "author": {
        "id": 1930620
      },
      "writtenOn": "2022-08-10T20:10:00Z",
      "side": 1,
      "message": "Why 4?",
      "revId": "9f79ad81fc103e2e85461409d8d101d454e2cdf9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "92502c92_8f6209ce",
        "filename": "libprocessgroup/processgroup.cpp",
        "patchSetId": 4
      },
      "lineNbr": 175,
      "author": {
        "id": 1869780
      },
      "writtenOn": "2022-08-10T20:39:25Z",
      "side": 1,
      "message": "All SetTaskProfiles() and SetProcessProfiles() calls that I found and that pass an initializer list as the \u0027profiles\u0027 argument pass an initializer list with length one. So any value \u003e\u003d 1 prevents that any memory allocation happens for such calls. The command I used to look up these calls is as follows:\n\nrepo-grep -nH \u0027SetProcessProfiles(.*{\\|SetTaskProfiles(.*{\u0027 \u0027**.cpp\u0027",
      "parentUuid": "de69d756_bd2fd063",
      "revId": "9f79ad81fc103e2e85461409d8d101d454e2cdf9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "037cfe9a_7f7f39fb",
        "filename": "libprocessgroup/processgroup.cpp",
        "patchSetId": 4
      },
      "lineNbr": 175,
      "author": {
        "id": 1930620
      },
      "writtenOn": "2022-08-11T03:57:06Z",
      "side": 1,
      "message": "Sorry I still don\u0027t follow this. There are allocations all over the place here. Now I think it\u0027s possible to do just:\n```\nbool SetTaskProfiles(int tid, std::initializer_list\u003cstd::string_view\u003e profiles, bool use_fd_cache) {\n    return TaskProfiles::GetInstance().SetTaskProfiles(tid, std::span(profiles), ...);\n\n```\nBut we\u0027d need a successful build to make sure there are no odd callers whose arguments can\u0027t be converted to std::string_view.\n\nThis should also address the fact that you are throwing away the length information and recomputing it by decaying `const char[N]` to `const char *` for string literals, since the compiler can see the string literal from the same place the conversion to `std::string_view` happens (and thus more than likely optimize out the runtime `Traits::length`).",
      "parentUuid": "92502c92_8f6209ce",
      "revId": "9f79ad81fc103e2e85461409d8d101d454e2cdf9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "968a0ed9_66fb111f",
        "filename": "libprocessgroup/task_profiles.h",
        "patchSetId": 4
      },
      "lineNbr": 28,
      "author": {
        "id": 1930620
      },
      "writtenOn": "2022-08-10T20:10:00Z",
      "side": 1,
      "message": "This does not look like it\u0027s needed here.",
      "revId": "9f79ad81fc103e2e85461409d8d101d454e2cdf9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9db33532_aaa1f2f3",
        "filename": "libprocessgroup/task_profiles.h",
        "patchSetId": 4
      },
      "lineNbr": 28,
      "author": {
        "id": 1869780
      },
      "writtenOn": "2022-08-10T20:39:25Z",
      "side": 1,
      "message": "Indeed. I have removed this include directive.",
      "parentUuid": "968a0ed9_66fb111f",
      "revId": "9f79ad81fc103e2e85461409d8d101d454e2cdf9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5d1ab1fb_7a090fbf",
        "filename": "libprocessgroup/task_profiles.h",
        "patchSetId": 4
      },
      "lineNbr": 216,
      "author": {
        "id": 1930620
      },
      "writtenOn": "2022-08-10T20:10:00Z",
      "side": 1,
      "message": "Why not just make these all a function template?",
      "revId": "9f79ad81fc103e2e85461409d8d101d454e2cdf9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c5201374_388c6358",
        "filename": "libprocessgroup/task_profiles.h",
        "patchSetId": 4
      },
      "lineNbr": 216,
      "author": {
        "id": 1869780
      },
      "writtenOn": "2022-08-10T20:39:25Z",
      "side": 1,
      "message": "Because that would cause std::vector\u003cstd::string\u003e objects to be passed by value instead of by reference. I want to avoid this.",
      "parentUuid": "5d1ab1fb_7a090fbf",
      "revId": "9f79ad81fc103e2e85461409d8d101d454e2cdf9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c5cd4ebc_5b3bde11",
        "filename": "libprocessgroup/task_profiles.h",
        "patchSetId": 4
      },
      "lineNbr": 216,
      "author": {
        "id": 1930620
      },
      "writtenOn": "2022-08-10T20:51:36Z",
      "side": 1,
      "message": "Huh? This is what I mean:\n\n```\ntemplate \u003ctypename T\u003e\nbool SetProcessProfiles(uid_t uid, pid_t pid, T\u0026\u0026 profiles, bool use_fd_cache) {\n    SetTaskProfilesT(uid, pid, std::forward\u003cT\u003e(profiles), use_fd_cache);  // But actually put the impl here since clang isn\u0027t always as smart as it could be about inlining these\n}\n```\nThere should be no copies of profiles (the std::vector\u003cstd::string\u003e) with that.",
      "parentUuid": "c5201374_388c6358",
      "revId": "9f79ad81fc103e2e85461409d8d101d454e2cdf9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6648bd1a_ad96ca32",
        "filename": "libprocessgroup/task_profiles.h",
        "patchSetId": 4
      },
      "lineNbr": 216,
      "author": {
        "id": 1869780
      },
      "writtenOn": "2022-08-10T22:03:49Z",
      "side": 1,
      "message": "How about changing the argument type into std::span\u003cT\u003e instead, as done in the latest version of this patch?",
      "parentUuid": "c5cd4ebc_5b3bde11",
      "revId": "9f79ad81fc103e2e85461409d8d101d454e2cdf9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e664f744_45232604",
        "filename": "libprocessgroup/task_profiles.h",
        "patchSetId": 4
      },
      "lineNbr": 216,
      "author": {
        "id": 1930620
      },
      "writtenOn": "2022-08-10T22:54:10Z",
      "side": 1,
      "message": "Yeah nicer, thanks.",
      "parentUuid": "6648bd1a_ad96ca32",
      "revId": "9f79ad81fc103e2e85461409d8d101d454e2cdf9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}