{
  "comments": [
    {
      "key": {
        "uuid": "ae9b108c_efa0dfb9",
        "filename": "logd/LogStatistics.cpp",
        "patchSetId": 1
      },
      "lineNbr": 160,
      "author": {
        "id": 1013433
      },
      "writtenOn": "2016-04-07T20:34:45Z",
      "side": 1,
      "message": "this could be getuid(), if Im self, its string auditd",
      "revId": "a3a9a45598e51f0f2cbe104cc70e531fff064cbf",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae9b108c_8ff83367",
        "filename": "logd/LogStatistics.cpp",
        "patchSetId": 1
      },
      "lineNbr": 160,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2016-04-07T21:02:22Z",
      "side": 1,
      "message": "Wanted to keep this constant, rather than runtime. At issue is some of the threads within logd are actually run in other-than-AID_LOGD user id.",
      "parentUuid": "ae9b108c_efa0dfb9",
      "revId": "a3a9a45598e51f0f2cbe104cc70e531fff064cbf",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae9b108c_afdf7752",
        "filename": "logd/LogStatistics.cpp",
        "patchSetId": 1
      },
      "lineNbr": 167,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2016-04-07T22:09:48Z",
      "side": 1,
      "message": "I do not know what to do with this. 256 is \u0027safe\u0027 today, failure (an option) just falls through and finds other possible names, and in the end we do print the UID number if it fails. A long name like this will give logcat -S a real formatting headache, so here we do not really care if ERANGE is triggered.",
      "range": {
        "startLine": 167,
        "startChar": 18,
        "endLine": 167,
        "endChar": 21
      },
      "revId": "a3a9a45598e51f0f2cbe104cc70e531fff064cbf",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae9b108c_95aba6e0",
        "filename": "logd/LogStatistics.cpp",
        "patchSetId": 1
      },
      "lineNbr": 167,
      "author": {
        "id": 1013433
      },
      "writtenOn": "2016-04-08T03:43:58Z",
      "side": 1,
      "message": "Agreed.",
      "parentUuid": "ae9b108c_afdf7752",
      "range": {
        "startLine": 167,
        "startChar": 18,
        "endLine": 167,
        "endChar": 21
      },
      "revId": "a3a9a45598e51f0f2cbe104cc70e531fff064cbf",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae9b108c_6f5bb05f",
        "filename": "logd/LogStatistics.cpp",
        "patchSetId": 1
      },
      "lineNbr": 181,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2016-04-07T18:31:13Z",
      "side": 1,
      "message": "In the future, parse of /data/system/packages.list _could_ be integrated into getpwuid. However, this is difficult here in logd since a separate thread running as AID_SYSTEM is accessing that data, and this thread is AID_LOGD (android::uidToName actually does some serialized rpc to that thread).",
      "range": {
        "startLine": 165,
        "startChar": 4,
        "endLine": 181,
        "endChar": 20
      },
      "revId": "a3a9a45598e51f0f2cbe104cc70e531fff064cbf",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae9b108c_cfcf5b79",
        "filename": "logd/LogStatistics.cpp",
        "patchSetId": 1
      },
      "lineNbr": 181,
      "author": {
        "id": 1013433
      },
      "writtenOn": "2016-04-07T20:34:45Z",
      "side": 1,
      "message": "Yeah but it would be nice to get rid of this... I was looking at the design of this again last night, and its quite clunky. But we can address packageparser after we get some integration into grp/pwd later.",
      "parentUuid": "ae9b108c_6f5bb05f",
      "range": {
        "startLine": 165,
        "startChar": 4,
        "endLine": 181,
        "endChar": 20
      },
      "revId": "a3a9a45598e51f0f2cbe104cc70e531fff064cbf",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae9b108c_af141768",
        "filename": "logd/LogStatistics.cpp",
        "patchSetId": 1
      },
      "lineNbr": 181,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2016-04-07T21:02:22Z",
      "side": 1,
      "message": "AID_LOGD does _not_ have access to /data/system/packages.list, so getpwuid_r would fail to be enhanced when libpackagelistparser is referenced.\n\nAllow AID_LOGD access to /data/system; but making it system/logd will have ramifications.\n\nuid name is picked up here (in context of logcat -S command in logd.control thread) and in chatty (in context of logcat logd.reader.per transitory thread); and we use logd.daemon thread to perform the data pickup. Elevating logd.reader.per to AID_SYSTEM is not security-wise possible.\n\nThe solution I expect is to double-wrap libpackageparser with a WEAK package_aid_to_name(aid) in libc that in-turn has WEAK stubs to libpackageparser; and override package_aid_to_name(aid) here with our own version.\n\nlater dude ;-}",
      "parentUuid": "ae9b108c_cfcf5b79",
      "range": {
        "startLine": 165,
        "startChar": 4,
        "endLine": 181,
        "endChar": 20
      },
      "revId": "a3a9a45598e51f0f2cbe104cc70e531fff064cbf",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae9b108c_4fd10bd4",
        "filename": "logd/LogStatistics.cpp",
        "patchSetId": 1
      },
      "lineNbr": 181,
      "author": {
        "id": 1013433
      },
      "writtenOn": "2016-04-07T21:07:01Z",
      "side": 1,
      "message": "I would just have the other threads post requests to the system thread to fulfill them and give them their response. I wouldn\u0027t touch the perms on the packages.lst file itself. Slight re-architecture of this code I would imagine. I\u0027m not super familiar with the logd code, id have to spend more time with it.",
      "parentUuid": "ae9b108c_af141768",
      "range": {
        "startLine": 165,
        "startChar": 4,
        "endLine": 181,
        "endChar": 20
      },
      "revId": "a3a9a45598e51f0f2cbe104cc70e531fff064cbf",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae9b108c_2f51270c",
        "filename": "logd/LogStatistics.cpp",
        "patchSetId": 1
      },
      "lineNbr": 181,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2016-04-07T21:23:31Z",
      "side": 1,
      "message": "Basically yes, that was my final possible solution, getpwuid() would call back to package_aid_to_name(aid); the WEAK stub in libc library would make direct calls to WEAK stubs in libc that looked like libpackageparser calls. We would implement a local package_aid_to_name(aid) function that calls to logd.daemon to pick up the content (shown here as android::uidToName(aid)).",
      "parentUuid": "ae9b108c_4fd10bd4",
      "range": {
        "startLine": 165,
        "startChar": 4,
        "endLine": 181,
        "endChar": 20
      },
      "revId": "a3a9a45598e51f0f2cbe104cc70e531fff064cbf",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae9b108c_b53b4a7b",
        "filename": "logd/LogStatistics.cpp",
        "patchSetId": 1
      },
      "lineNbr": 181,
      "author": {
        "id": 1013433
      },
      "writtenOn": "2016-04-08T03:43:58Z",
      "side": 1,
      "message": "Where is the package_aid_to_name(), is it the weak stub in libc your referring to?\n\nWhy couldn\u0027t we just put a weak stub calls to libpackageparser in libc, and gave the pwd functions call them, if you want full appid resolution link your binary to libc + libpackageparser.\n\nWhy does logd need to implement teh override package_aid_to_name? Eventually uidToName() would just be replaced with getpwduid().\n\nI guess I don\u0027t understand what the additional indirection of having logs have to implement this package_aid_to_name() routine.",
      "parentUuid": "ae9b108c_2f51270c",
      "range": {
        "startLine": 165,
        "startChar": 4,
        "endLine": 181,
        "endChar": 20
      },
      "revId": "a3a9a45598e51f0f2cbe104cc70e531fff064cbf",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}