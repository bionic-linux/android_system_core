{
  "comments": [
    {
      "key": {
        "uuid": "5d8968a7_22c6d082",
        "filename": "adb/sysdeps.h",
        "patchSetId": 1
      },
      "lineNbr": 184,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2016-02-18T02:51:02Z",
      "side": 1,
      "message": "My understanding is that this returns a pseudo-handle, in other words it always returns the same value (0xFFFFFFFE). So it can\u0027t be used to compare different threads. Some alternatives:\n\n1. Use GetCurrentThreadId(). I think this is what Win32 codebases will typically do for the sort of check you\u0027re doing. But it is an id, not a adb_thread_t (HANDLE).\n\n2. If you really want a thread handle, use DuplicateHandle(GetCurrentThread()). That is a real pain to use compared to just calling GetCurrentThreadId(). I\u0027d probably only recommend this route if you really need a thread handle for some reason.\n\n3. Use adb_thread_id() instead?",
      "range": {
        "startLine": 184,
        "startChar": 11,
        "endLine": 184,
        "endChar": 27
      },
      "revId": "90ac3381e0f8d926016b061e748b8bcbbdf2cde4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c23655de_d89c4535",
        "filename": "adb/sysdeps.h",
        "patchSetId": 1
      },
      "lineNbr": 184,
      "author": {
        "id": 1079148
      },
      "writtenOn": "2016-02-18T22:03:46Z",
      "side": 1,
      "message": "Oh, yikes. I didn\u0027t read that documentation page carefully enough. (i.e., at all, apparently). Switched to using adb_thread_id.",
      "parentUuid": "5d8968a7_22c6d082",
      "range": {
        "startLine": 184,
        "startChar": 11,
        "endLine": 184,
        "endChar": 27
      },
      "revId": "90ac3381e0f8d926016b061e748b8bcbbdf2cde4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5d8968a7_42c3d471",
        "filename": "adb/sysdeps.h",
        "patchSetId": 1
      },
      "lineNbr": 188,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2016-02-18T02:51:02Z",
      "side": 1,
      "message": "see comments above about thread handles/ids",
      "range": {
        "startLine": 188,
        "startChar": 11,
        "endLine": 188,
        "endChar": 47
      },
      "revId": "90ac3381e0f8d926016b061e748b8bcbbdf2cde4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3d9034ca_0142ac87",
        "filename": "adb/sysdeps_win32.cpp",
        "patchSetId": 1
      },
      "lineNbr": 667,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2016-02-18T02:51:02Z",
      "side": 1,
      "message": "Wow, does the caller really pass bad stuff in practice?\n\nSo the point of `sockets\u0027 is to filter the invalid/non-socket handles and also to create WSAPoll structures with Win32 HANDLE values (from fh-\u003eu.socket) instead of sysdeps fd values?",
      "range": {
        "startLine": 667,
        "startChar": 4,
        "endLine": 667,
        "endChar": 94
      },
      "revId": "90ac3381e0f8d926016b061e748b8bcbbdf2cde4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bd7c2458_05239440",
        "filename": "adb/sysdeps_win32.cpp",
        "patchSetId": 1
      },
      "lineNbr": 667,
      "author": {
        "id": 1079148
      },
      "writtenOn": "2016-02-18T03:19:22Z",
      "side": 1,
      "message": "In practice, probably not (hopefully not, at least). There was a test that was running into this, though.\n\n\u003e So the point of `sockets\u0027 is to filter the invalid/non-socket handles and also to create WSAPoll structures with Win32 HANDLE values (from fh-\u003eu.socket) instead of sysdeps fd values?\n\nYep.",
      "parentUuid": "3d9034ca_0142ac87",
      "range": {
        "startLine": 667,
        "startChar": 4,
        "endLine": 667,
        "endChar": 94
      },
      "revId": "90ac3381e0f8d926016b061e748b8bcbbdf2cde4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3d9034ca_2175e8d3",
        "filename": "adb/sysdeps_win32.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1136,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2016-02-18T02:54:04Z",
      "side": 1,
      "message": "Do we have to worry about someone else connecting to this (localhost) socket maliciously or inadvertently? My thinking is no, but just throwing it out there... Seems pointless to worry about maliciousness when port 5037 has no security for starters. The connect happens pretty fast so hopefully no inadvertent connect should get in...",
      "range": {
        "startLine": 1136,
        "startChar": 4,
        "endLine": 1136,
        "endChar": 18
      },
      "revId": "90ac3381e0f8d926016b061e748b8bcbbdf2cde4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6243e950_1524d446",
        "filename": "adb/sysdeps_win32.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1136,
      "author": {
        "id": 1079148
      },
      "writtenOn": "2016-02-18T22:03:46Z",
      "side": 1,
      "message": "Yeah, this seemed a bit scary to me as well, but I dismissed it for the same reason. Perhaps this should generate a random token that gets validated on both sides, but it might be better to leave that for a follow up patch.",
      "parentUuid": "3d9034ca_2175e8d3",
      "range": {
        "startLine": 1136,
        "startChar": 4,
        "endLine": 1136,
        "endChar": 18
      },
      "revId": "90ac3381e0f8d926016b061e748b8bcbbdf2cde4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bd6504c6_a0de5ef7",
        "filename": "adb/sysdeps_win32.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1140,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2016-02-18T02:51:02Z",
      "side": 1,
      "message": "sockaddr_storage?",
      "range": {
        "startLine": 1140,
        "startChar": 4,
        "endLine": 1140,
        "endChar": 15
      },
      "revId": "90ac3381e0f8d926016b061e748b8bcbbdf2cde4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "620e892a_40da8493",
        "filename": "adb/sysdeps_win32.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1140,
      "author": {
        "id": 1079148
      },
      "writtenOn": "2016-02-18T22:03:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "bd6504c6_a0de5ef7",
      "range": {
        "startLine": 1140,
        "startChar": 4,
        "endLine": 1140,
        "endChar": 15
      },
      "revId": "90ac3381e0f8d926016b061e748b8bcbbdf2cde4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fd993cfa_9ffc57d6",
        "filename": "adb/sysdeps_win32.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1147,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2016-02-18T02:51:02Z",
      "side": 1,
      "message": "network_loopback_server doesn\u0027t set errno (since it sets the error string instead), so errno isn\u0027t meaningful here. Maybe something to fix in the future (seems like David is working on socket stuff these days).",
      "range": {
        "startLine": 1147,
        "startChar": 8,
        "endLine": 1147,
        "endChar": 18
      },
      "revId": "90ac3381e0f8d926016b061e748b8bcbbdf2cde4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "021f8d56_daa9e5ed",
        "filename": "adb/sysdeps_win32.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1147,
      "author": {
        "id": 1079148
      },
      "writtenOn": "2016-02-18T22:03:46Z",
      "side": 1,
      "message": "I made network_loopback_server/client set errno in one of the other patches.",
      "parentUuid": "fd993cfa_9ffc57d6",
      "range": {
        "startLine": 1147,
        "startChar": 8,
        "endLine": 1147,
        "endChar": 18
      },
      "revId": "90ac3381e0f8d926016b061e748b8bcbbdf2cde4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "dd9478c3_de6341a7",
        "filename": "adb/sysdeps_win32.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1165,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2016-02-18T02:51:02Z",
      "side": 1,
      "message": "network_loopback_client doesn\u0027t set errno either.",
      "range": {
        "startLine": 1165,
        "startChar": 8,
        "endLine": 1165,
        "endChar": 18
      },
      "revId": "90ac3381e0f8d926016b061e748b8bcbbdf2cde4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}