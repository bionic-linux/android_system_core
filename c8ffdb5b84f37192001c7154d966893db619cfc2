{
  "comments": [
    {
      "key": {
        "uuid": "97d3953d_7264463c",
        "filename": "fs_mgr/fs_mgr.cpp",
        "patchSetId": 16
      },
      "lineNbr": 330,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2020-06-10T20:50:39Z",
      "side": 1,
      "message": "What exactly are these encryption checks for? It looks like read_ext4_superblock will always be called immediately before mounting, so there shouldn\u0027t be any risk of reading from the wrong device (CMIIW).",
      "revId": "c8ffdb5b84f37192001c7154d966893db619cfc2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5adee492_c99ae2d0",
        "filename": "fs_mgr/fs_mgr.cpp",
        "patchSetId": 16
      },
      "lineNbr": 330,
      "author": {
        "id": 1292830
      },
      "writtenOn": "2020-06-10T23:06:52Z",
      "side": 1,
      "message": "Hi David, the idea is to avoid unnecessary scan on raw /data block.\nfor example, the raw /data block device is /dev/block/sda45 -\u003e encrypted by metadata encryption.\nAnd the wrapped /data block device is /dev/block/dm-2. -\u003e ext4 plain text\nSo, if fs_mgr tries to mount /dev/block/sda45 in the beginning, without the checks, 7 unnecessary scans (blksize\u003d1024, 2048, 4096, ..., 65536) will be conducted on /dev/block/sda45.\nI want to avoid these 7 scans.",
      "parentUuid": "97d3953d_7264463c",
      "revId": "c8ffdb5b84f37192001c7154d966893db619cfc2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6f87b1e4_9670ddda",
        "filename": "fs_mgr/fs_mgr.cpp",
        "patchSetId": 16
      },
      "lineNbr": 330,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2020-06-11T03:45:55Z",
      "side": 1,
      "message": "Oh, I see now - it\u0027s due to the unfortunate way things are ordered in mount_all. Can you add a comment above, explaining that you don\u0027t want to scan blocks on the encrypted device? And simplify the logic a bit so it\u0027s clearer:\n\n    bool encrypted \u003d should_use_metadata_encryption(entry) || needs_block_encryption(entry);\n    if (entry.mount_point \u003d\u003d \"/data\" \u0026\u0026 (!encrypted || android::base::StartsWith ...\n\nSomeday we\u0027ll have to refactor this so mount_all calls encryptFstab before attempting to read anything.",
      "parentUuid": "5adee492_c99ae2d0",
      "revId": "c8ffdb5b84f37192001c7154d966893db619cfc2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}