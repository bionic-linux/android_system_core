{
  "comments": [
    {
      "key": {
        "uuid": "fd92ccf1_3bd8a9d1",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 11,
      "author": {
        "id": 1041673
      },
      "writtenOn": "2018-01-15T13:55:55Z",
      "side": 1,
      "message": "I do not really understand.. why is something made available to all apps should be restricted to vendor apps?",
      "revId": "e031994f2f7adfe8f3358bfdc3073c47fb61fa69",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4e726212_df3af4ec",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 11,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2018-01-15T14:41:02Z",
      "side": 1,
      "message": "then the vendor apks won\u0027t work when the system partition is replaced with the Generic System Image, which is built by Google, for CTS/VTS.\n\nSince SoC vendors are upstreams of OEMs, the former shouldn\u0027t depend on the latter.\n\nIn case of 3p apps, this is okay because such apps are downstream of OEM\u0027s fork of Android.",
      "parentUuid": "fd92ccf1_3bd8a9d1",
      "revId": "e031994f2f7adfe8f3358bfdc3073c47fb61fa69",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c0c8cf48_e964356a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 11,
      "author": {
        "id": 1041673
      },
      "writtenOn": "2018-01-15T14:45:28Z",
      "side": 1,
      "message": "I do not see how the fact that these libraries are accessible to vendor apps necessarily leads to the situation where they do not work on generic system image.\n\nNote that for 3p apps this is the case as well.. OEM libs are not somethings that are present for all android devices. This is an extra part and (well designed) apps using these libraries should be able to work on android devices without them.",
      "parentUuid": "4e726212_df3af4ec",
      "revId": "e031994f2f7adfe8f3358bfdc3073c47fb61fa69",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5045a7a3_3b92bfa1",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 11,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2018-01-15T15:01:59Z",
      "side": 1,
      "message": "No, they don\u0027t always fail, but we must not rely on how they are implemented. If we can rely on that, the entire Treble would have been so easy. No build-time and run-time enforcement is necessary because CTS/VTS on GSI can guarantee everything.\n\nI don\u0027t see a reason for an SoC company (which owns the vendor partition) to use a library in system library defined by OEM which is a downstream of the SoC vendor. Since an SoC can be sold to any OEM, it can\u0027t assume a specific OEM library. That just doesn\u0027t make sense logically.",
      "parentUuid": "c0c8cf48_e964356a",
      "revId": "e031994f2f7adfe8f3358bfdc3073c47fb61fa69",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "428b6070_1710d3f1",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 11,
      "author": {
        "id": 1041673
      },
      "writtenOn": "2018-01-15T18:47:01Z",
      "side": 1,
      "message": "I do not think this is a good reason for creating 2nd class citizens out of certain kind of apps.",
      "parentUuid": "5045a7a3_3b92bfa1",
      "revId": "e031994f2f7adfe8f3358bfdc3073c47fb61fa69",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "942355a6_bfc68ab9",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 11,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2018-01-16T13:07:17Z",
      "side": 1,
      "message": "I don\u0027t intend to make the vendor apks as 2nd class citizen. Each types of apps (bundled in system, bundled in vendor, unbundled, downloaded, etc) are all provided with different sets of libraries depending on their expected lifecycle. There is no 1st/2nd/3rd class citizens with strict order.",
      "parentUuid": "428b6070_1710d3f1",
      "revId": "e031994f2f7adfe8f3358bfdc3073c47fb61fa69",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "10c40163_508be6ee",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 11,
      "author": {
        "id": 1041673
      },
      "writtenOn": "2018-01-16T14:13:02Z",
      "side": 1,
      "message": "Ok, leaving aside questions about bundled vendor apps for the moment.\n\nMy main worry with this approach is this. I think it is ok to place restrictions limiting bad actors from doing things they should not be doing. But it is not ok for these restrictions to punish good actors.\n\nFor example if a vendor app uses oem libraries responsibly (use the if they are available and have fallback for the cases when they are not) IMO it should not have it\u0027s access revoked because there is some bad vendor app working only with images with oem libraries available.",
      "parentUuid": "942355a6_bfc68ab9",
      "revId": "e031994f2f7adfe8f3358bfdc3073c47fb61fa69",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "56ee16e4_222209e0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 11,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2018-01-16T15:00:54Z",
      "side": 1,
      "message": "Hmm, I don\u0027t disagree with your statement in general. However, I still argue that we shouldn\u0027t simply hope that there will be many good actors and blame the failure to the violators. If that theory was working, why did we hide private system libs from ordinary apps since Nougat? They also could have used the private system libs responsibly (e.g. by dynamically examining the symbol\u0027s existence or use it on a certain device, etc.).\n\nAnother counter example is native vendor modules. With Treble, they can\u0027t access OEM-added libs and of course private system libs except for VNDK libraries. Then why should we allow the libs to vendor *apps* and expect them to behave nicely? IMO, this seems to be an inconsistent policy.\n\nIf vendors really want to use OEM-added libs, they should be copying the lib into the vendor partition so that the app and the lib are always bundled together.",
      "parentUuid": "10c40163_508be6ee",
      "revId": "e031994f2f7adfe8f3358bfdc3073c47fb61fa69",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a9105cc4_b173d253",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 11,
      "author": {
        "id": 1041673
      },
      "writtenOn": "2018-01-16T15:10:49Z",
      "side": 1,
      "message": "\u003e Hmm, I don\u0027t disagree with your statement in general. However, I still argue that we shouldn\u0027t simply hope that there will be many good actors and blame the failure to the violators. If that theory was working, why did we hide private system libs from ordinary apps since Nougat? They also could have used the private system libs responsibly (e.g. by dynamically examining the symbol\u0027s existence or use it on a certain device, etc.).\n\nI believe I have answered this question... current policy with limiting access to system libs does not punish good actors.\n\n\u003e Another counter example is native vendor modules. With Treble, they can\u0027t access OEM-added libs and of course private system libs except for VNDK libraries. Then why should we allow the libs to vendor *apps* and expect them to behave nicely? IMO, this seems to be an inconsistent policy.\n\nAgain, this is different problem. I\u0027m not very familiar with modules my limited understanding tells me that they are probably different from apps. I do not think this example helps here - it only confuses things.\n\n\u003e \n\u003e If vendors really want to use OEM-added libs, they should be copying the lib into the vendor partition so that the app and the lib are always bundled together.\n\nOk.. this also applies for all other apps, no? Every app can do that. Why are non-vendor apps special? Don\u0027t you want to remove access to oem libs for all apps in this case and have them package these libs if they want to use them?",
      "parentUuid": "56ee16e4_222209e0",
      "revId": "e031994f2f7adfe8f3358bfdc3073c47fb61fa69",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c157953a_b12bc998",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 11,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2018-01-16T15:27:24Z",
      "side": 1,
      "message": "Answering to the last question: non-vendor apps (apps downloaded from PlayStore) are okay because they are downstream of the device makers. And while it\u0027s technically possible for them to embed oem libs, but it\u0027s better to let them in the system partition because, the libraries may have slightly different implementations optimized for each device (with the same ABI). Also, the oem library may have internal dependency to the private system libs, which makes the embedding impossible. (but, in this case, copying oem libs to vendor may work if the oem lib is depending on vndk libs which are already available to vendors)",
      "parentUuid": "a9105cc4_b173d253",
      "revId": "e031994f2f7adfe8f3358bfdc3073c47fb61fa69",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e2953138_d5036bdc",
        "filename": "libnativeloader/native_loader.cpp",
        "patchSetId": 1
      },
      "lineNbr": 225,
      "author": {
        "id": 1041673
      },
      "writtenOn": "2018-01-17T11:16:59Z",
      "side": 1,
      "message": "It looks like this allows apps to load second copies of the libraries from /vendor/lib - is this intended? Won\u0027t this cause problems with inconsistent global state?",
      "revId": "e031994f2f7adfe8f3358bfdc3073c47fb61fa69",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "81d7705c_e4c8a328",
        "filename": "libnativeloader/native_loader.cpp",
        "patchSetId": 1
      },
      "lineNbr": 225,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2018-01-17T14:18:06Z",
      "side": 1,
      "message": "By this line, /vendor/lib/*.so can be loaded into the classloader-namespace. At the same time, since this is an Android app, SP-HAL libraries (EGL/GLES, Vulkan, ...) in the vendor partition may have been loaded into the \u0027sphal\u0027 namespace. So, yes, if a vendor app calls System.loadLibrary(\"/vendor/lib/hw/libGLES_adreno.so\") then it is dual loaded in the classloader ns and the sphal ns.\n\nHowever, since the sp-hal libraries set is fixed and cannot be extended by vendors, and they are never meant to be directly loaded by apps (but always indirectly via corresponding loaders, for example libEGL is a loader for libEGL_\u003cvendor\u003e.so), this shouldn\u0027t be a practical problem. In short, a random vendor library can\u0027t be double loaded.",
      "parentUuid": "e2953138_d5036bdc",
      "revId": "e031994f2f7adfe8f3358bfdc3073c47fb61fa69",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8901ce93_4724e2fd",
        "filename": "libnativeloader/native_loader.cpp",
        "patchSetId": 1
      },
      "lineNbr": 239,
      "author": {
        "id": 1041673
      },
      "writtenOn": "2018-01-17T11:16:59Z",
      "side": 1,
      "message": "and if these are bundled vendor apps? (is_shared \u003d\u003d true)\n\nIf such thing is not supported please add a CHECK (LOG_ALWAYS_FATAL_IF)",
      "revId": "e031994f2f7adfe8f3358bfdc3073c47fb61fa69",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5bab1819_538b2071",
        "filename": "libnativeloader/native_loader.cpp",
        "patchSetId": 1
      },
      "lineNbr": 239,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2018-01-17T14:18:06Z",
      "side": 1,
      "message": "If is_shared is true for vendor apks, then it means the device is not fully treble-ized (\u003d the default namespace has /vendor/lib in its search paths). In that case, system/vendor separation does not make sense, so we don\u0027t hide oem libs to vendor apks.",
      "parentUuid": "8901ce93_4724e2fd",
      "revId": "e031994f2f7adfe8f3358bfdc3073c47fb61fa69",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}