{
  "comments": [
    {
      "key": {
        "uuid": "10479fed_73a382ce",
        "filename": "libnativebridge/native_bridge.cc",
        "patchSetId": 5
      },
      "lineNbr": 234,
      "author": {
        "id": 1051763
      },
      "writtenOn": "2014-09-18T05:17:04Z",
      "side": 1,
      "message": "It\u0027s not reasonable to get cpuinfo file here under private dir. NativeBridge has no chance to get the path of private dir and put cpufino file, because it hasn\u0027t involved at all before PreInitialized. Can we make a agreement on the cpuinfo path per instruction set? For example, the path should be /system/lib(64)/\u003cinstrction_set\u003e/cpuinfo.",
      "range": {
        "startLine": 226,
        "startChar": 0,
        "endLine": 234,
        "endChar": 67
      },
      "revId": "f4318f0cd645d2b341489f531711a2dfbdca42e3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7021bb30_d95dd35e",
        "filename": "libnativebridge/native_bridge.cc",
        "patchSetId": 5
      },
      "lineNbr": 234,
      "author": {
        "id": 1041833
      },
      "writtenOn": "2014-09-18T06:04:20Z",
      "side": 1,
      "message": "The intention here was that the code cache sub-directory name is known (it\u0027s public API for L). The bridge will be provided with the data directory on Initialize (see the new signature), which basically happens immediately after the dropping of the privileges. So the bridge can construct the same path and write to the file just fine before any app code is executed.\n\nYou will need the directory anyways to store compiled things in there / load them out of there. So that seemed like a decent approach.\n\nI\u0027ll discuss your proposal internally tomorrow.",
      "parentUuid": "10479fed_73a382ce",
      "range": {
        "startLine": 226,
        "startChar": 0,
        "endLine": 234,
        "endChar": 67
      },
      "revId": "f4318f0cd645d2b341489f531711a2dfbdca42e3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9081cf4e_12e80cc5",
        "filename": "libnativebridge/native_bridge.cc",
        "patchSetId": 5
      },
      "lineNbr": 234,
      "author": {
        "id": 1022077
      },
      "writtenOn": "2014-09-18T10:52:20Z",
      "side": 1,
      "message": "The only drawback for this is that we\u0027ll have quite a lot of duplication for cpuinfo files (unless the nativebridge is somehow smart enough to use symlink).\n\nHowever it\u0027s still the most flexible approach and I favor it as well (the cpuinfo is pretty small)",
      "parentUuid": "7021bb30_d95dd35e",
      "range": {
        "startLine": 226,
        "startChar": 0,
        "endLine": 234,
        "endChar": 67
      },
      "revId": "f4318f0cd645d2b341489f531711a2dfbdca42e3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3042e3dc_f9769756",
        "filename": "libnativebridge/native_bridge.cc",
        "patchSetId": 5
      },
      "lineNbr": 234,
      "author": {
        "id": 1051763
      },
      "writtenOn": "2014-09-18T13:52:07Z",
      "side": 1,
      "message": "Thanks for your clarify. But I still didn\u0027t get the point. The app_data_dir is different both for Zygote and each app. The PreInitializeNativeBridge is always invoked before InitializeNativeBridge. The bridge only involves and knows the app_data_dir after initialized in InitializeNativeBridge. Then it gets the chance the create the cpuinfo or its soft link for the app. But PreInitializeNativeBridge will open/bind-mount the cpuinfo before all above happened. Then, an error is always exposed duo to no cpuinfo file there. If any mistake, please help me on this. Thanks.",
      "parentUuid": "7021bb30_d95dd35e",
      "range": {
        "startLine": 226,
        "startChar": 0,
        "endLine": 234,
        "endChar": 67
      },
      "revId": "f4318f0cd645d2b341489f531711a2dfbdca42e3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f02ccb2f_95dc04a9",
        "filename": "libnativebridge/native_bridge.cc",
        "patchSetId": 5
      },
      "lineNbr": 234,
      "author": {
        "id": 1022077
      },
      "writtenOn": "2014-09-18T13:58:36Z",
      "side": 1,
      "message": "If you look at L238 you\u0027ll notice O_CREAT flag. The file will be there (and properly mounted) when the native bridge initializes. It\u0027s up to the native bridge to populate the file with the correct content.\n\nRegarding my early comment, symlinks can\u0027t actually be used with this design so we\u0027ll end up with some duplication.",
      "parentUuid": "3042e3dc_f9769756",
      "range": {
        "startLine": 226,
        "startChar": 0,
        "endLine": 234,
        "endChar": 67
      },
      "revId": "f4318f0cd645d2b341489f531711a2dfbdca42e3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f02ccb2f_55d0ac02",
        "filename": "libnativebridge/native_bridge.cc",
        "patchSetId": 5
      },
      "lineNbr": 279,
      "author": {
        "id": 1022077
      },
      "writtenOn": "2014-09-18T10:52:20Z",
      "side": 1,
      "message": "a bit more wasteful but i think it will be cleaner to just use an array.",
      "range": {
        "startLine": 279,
        "startChar": 29,
        "endLine": 279,
        "endChar": 65
      },
      "revId": "f4318f0cd645d2b341489f531711a2dfbdca42e3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}