{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "b18b4df3_58fd482c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2023-01-11T00:56:09Z",
      "side": 1,
      "message": "fwiw, \"we need to expose _multiple_ low-level functions [that we don\u0027t think anyone else will need]\" is probably the argument for having your ioctl() wrapper in here instead...\n\njstultz: i know you\u0027re not very far on, so you probably don\u0027t know, but do you think anyone else is going to need these functions during the ashmem-\u003ememfd transition?",
      "revId": "720fda1507cd88b9f43d934a8aa09ac13c250d3a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "26fe40a9_870ef677",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1965080
      },
      "writtenOn": "2023-01-11T01:14:10Z",
      "side": 1,
      "message": "Right, that\u0027s why I commented as such on the Bitmap.java review before I pushed this patch :) Also, the `libcutil wrapper for ASHMEM_GET_FILE_ID ioctl` change had precisely this logic already implemented into `ashmem-dev.cpp` and *you told me* to push it into a local Bitmap.cpp function.",
      "parentUuid": "b18b4df3_58fd482c",
      "revId": "720fda1507cd88b9f43d934a8aa09ac13c250d3a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3c7f901f_0e307cd7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1965080
      },
      "writtenOn": "2023-01-11T01:32:31Z",
      "side": 1,
      "message": "Actually, exporting these functions we discussed twice:\n\nOn the original ashmem-dev.cpp review:\n\nhttps://android-review.git.corp.google.com/c/platform/system/core/+/2241636/comments/a23dad63_cb534634\n\n\n\u0027Hmm, if I want to keep the ability to seamlessly handled memfd vs ashmem while also inlining this function at it\u0027s call sites, I\u0027d need to export has_memfd_support() and memfd_is_ashmem(). Are we ok with that?\u0027\n\n\n\nAnd more recently, here in the Bitmap.java review:\n\nhttps://android-review.git.corp.google.com/c/platform/frameworks/base/+/2239343/comment/f7d8ab27_69f5305c/\n\n\u0027I can pull in the libcutil function, it will require exporting of has_memfd_support and memfd_is_ashmem for a single caller. Please let me know if that\u0027s not OK for any reason as I\u0027d like to avoid moving this code around any more :) :)`\n\n\nSo, we need to choose:\n\n- do we have only the bare ioctl in Bitmap.cpp\n\n- do we have the memfd/ashmem combined logic in Bitmap.cpp, which requires export of multiple low level functions\n\n- or lastly do we keep the logic centralized in ashmem-dev.cpp and handle both ashmem and memfd.\n\nMy vote, is to centralize this whole thing in ashmem-dev.cpp. One way or the other though, can we come to a final decision please? Thanks!",
      "parentUuid": "26fe40a9_870ef677",
      "revId": "720fda1507cd88b9f43d934a8aa09ac13c250d3a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "66ff05bf_989fde89",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2023-01-11T01:34:25Z",
      "side": 1,
      "message": "yeah, i know --- that\u0027s why i\u0027m telling you what you should have said to persuade me first time round :-)\n\n(because, yes, unless jstultz has other uses for these, going back to your original ps seems like the lesser evil.)\n\nalthough, to be fair to both of us, i think \"jstultz is actually working on making the ashmem -\u003e memfd transition happen\" is the really persuasive new thing that came to light here. that changes lots :-)",
      "parentUuid": "26fe40a9_870ef677",
      "revId": "720fda1507cd88b9f43d934a8aa09ac13c250d3a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8177df4b_06f465ba",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2023-01-11T01:35:59Z",
      "side": 1,
      "message": "\u003e My vote, is to centralize this whole thing in ashmem-dev.cpp. One way or the other though, can we come to a final decision please? Thanks!\n\nyeah, mine too... let\u0027s do that.\n\n(i think last time you talked about the memfd functions i was unconvinced because i didn\u0027t think memfd was actually going to happen, and we\u0027d just avoid that completely.)",
      "parentUuid": "66ff05bf_989fde89",
      "revId": "720fda1507cd88b9f43d934a8aa09ac13c250d3a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a32e9b8a_bdfaf0a1",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1965080
      },
      "writtenOn": "2023-01-11T01:39:47Z",
      "side": 1,
      "message": "Lol! :)\n\nCool so I think let\u0027s wait to hear back from John - if he doesn\u0027t need the low level functions then I can push this all back into ashmem-dev.cpp, otherwise if he\u0027s going to use them we\u0027ll leave it it Bitmap.cpp. I take it that sounds reasonable to you?\n\nThanks!",
      "parentUuid": "66ff05bf_989fde89",
      "revId": "720fda1507cd88b9f43d934a8aa09ac13c250d3a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8115a52a_72ad7aba",
        "filename": "libcutils/ashmem-dev.cpp",
        "patchSetId": 1
      },
      "lineNbr": 183,
      "author": {
        "id": 1019050
      },
      "writtenOn": "2023-01-10T23:34:11Z",
      "side": 1,
      "message": "Is this because all of the other functions return int? I think it makes more sense to return a bool anyway. Especially since it seems like at some point a compiler is going to complain about returning boolean values when the return value is still int.",
      "range": {
        "startLine": 183,
        "startChar": 0,
        "endLine": 183,
        "endChar": 3
      },
      "revId": "720fda1507cd88b9f43d934a8aa09ac13c250d3a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4180990a_95405f00",
        "filename": "libcutils/ashmem-dev.cpp",
        "patchSetId": 1
      },
      "lineNbr": 183,
      "author": {
        "id": 1965080
      },
      "writtenOn": "2023-01-10T23:57:58Z",
      "side": 1,
      "message": "Sorry for the basic question but can we do bool with C in android? I turned the return codes into ints because I wasn\u0027t sure about that. I\u0027ll try a compile with bool as the return code because I totally agree that we should keep it if possible.",
      "parentUuid": "8115a52a_72ad7aba",
      "range": {
        "startLine": 183,
        "startChar": 0,
        "endLine": 183,
        "endChar": 3
      },
      "revId": "720fda1507cd88b9f43d934a8aa09ac13c250d3a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a496ed1c_a3061aa7",
        "filename": "libcutils/ashmem-dev.cpp",
        "patchSetId": 1
      },
      "lineNbr": 183,
      "author": {
        "id": 1965080
      },
      "writtenOn": "2023-01-10T23:59:52Z",
      "side": 1,
      "message": "Oh I am a silly person and didn\u0027t realize this was a cpp file. I\u0027ll get the return code fixed up for us.",
      "parentUuid": "4180990a_95405f00",
      "range": {
        "startLine": 183,
        "startChar": 0,
        "endLine": 183,
        "endChar": 3
      },
      "revId": "720fda1507cd88b9f43d934a8aa09ac13c250d3a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4b4e53fc_c9ab3279",
        "filename": "libcutils/ashmem-dev.cpp",
        "patchSetId": 1
      },
      "lineNbr": 183,
      "author": {
        "id": 1965080
      },
      "writtenOn": "2023-01-11T00:18:07Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a496ed1c_a3061aa7",
      "range": {
        "startLine": 183,
        "startChar": 0,
        "endLine": 183,
        "endChar": 3
      },
      "revId": "720fda1507cd88b9f43d934a8aa09ac13c250d3a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "eafe509a_bf9ad397",
        "filename": "libcutils/ashmem-dev.cpp",
        "patchSetId": 1
      },
      "lineNbr": 183,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2023-01-11T00:56:09Z",
      "side": 1,
      "message": "(note that if you _are_ in C, or you\u0027re in a header that might be used in either context, `#include \u003cstdbool.h\u003e` is your friend.)",
      "parentUuid": "a496ed1c_a3061aa7",
      "range": {
        "startLine": 183,
        "startChar": 0,
        "endLine": 183,
        "endChar": 3
      },
      "revId": "720fda1507cd88b9f43d934a8aa09ac13c250d3a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}