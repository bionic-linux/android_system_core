{
  "comments": [
    {
      "key": {
        "uuid": "5a983c34_12e4896c",
        "filename": "adb/apex/ld.config.txt",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1079148
      },
      "writtenOn": "2020-01-29T22:16:29Z",
      "side": 1,
      "message": "Jiyong/Kiyoung: it seems like this is necessary because the libcrypto.so in the apex is a symlink to /system/lib64/libcrypto.so, and we resolve via realpath.\nIs it expected that libcrypto.so in the apex is a symlink? AFAIK boringssl doesn\u0027t have ABI stability guarantees, which makes me think no.",
      "range": {
        "startLine": 13,
        "startChar": 43,
        "endLine": 14,
        "endChar": 54
      },
      "revId": "6a3fc646f901166b352bcd1fd64869169c6b8a3b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d55febde_58887874",
        "filename": "adb/apex/ld.config.txt",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2020-01-30T00:47:51Z",
      "side": 1,
      "message": "The symlink exists only when the APEX is built **with** the platform (i.e. bundled). That is to save storage space. If an APEX is built as unbundled (to be uploaded for Play), it doesn\u0027t have the symlink.\n\n\u0027namespace.default.permitted.paths +\u003d /system/${LIB}\u0027 is enough to allow the linker to load libcrypto.so via the symlink.\n\n\nFor libadbd_auth.so, you just need to add it to \u0027namespace.default.link.platform.shared_libs\u0027.",
      "parentUuid": "5a983c34_12e4896c",
      "range": {
        "startLine": 13,
        "startChar": 43,
        "endLine": 14,
        "endChar": 54
      },
      "revId": "6a3fc646f901166b352bcd1fd64869169c6b8a3b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0c359e32_ffecf24a",
        "filename": "adb/apex/ld.config.txt",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1413436
      },
      "writtenOn": "2020-01-30T04:36:04Z",
      "side": 1,
      "message": "As Jiyong said, you can just link it from platform namespace as libadbd_auth has stubs. Please ensure that adbd APEX manifest marks libadbd_auth.so as required library, and also libadbd_auth.so exists within stub library list from https://source.corp.google.com/android/system/linkerconfig/generator/variableloader.cc;cl\u003dmaster;l\u003d42 so linkerconfig can auto-generate link from the manifest.",
      "parentUuid": "d55febde_58887874",
      "range": {
        "startLine": 13,
        "startChar": 43,
        "endLine": 14,
        "endChar": 54
      },
      "revId": "6a3fc646f901166b352bcd1fd64869169c6b8a3b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "77964081_399cd243",
        "filename": "adb/apex/ld.config.txt",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1079148
      },
      "writtenOn": "2020-01-31T00:18:18Z",
      "side": 1,
      "message": "\u003e The symlink exists only when the APEX is built **with** the platform (i.e. bundled). That is to save storage space. If an APEX is built as unbundled (to be uploaded for Play), it doesn\u0027t have the symlink.\n\nAh, okay, that makes sense.\n\n\u003e \u0027namespace.default.permitted.paths +\u003d /system/${LIB}\u0027 is enough to allow the linker to load libcrypto.so via the symlink.\n\nWon\u0027t that make it easier to accidentally load libraries from the system image, though? It seems like we should be explicit about where every library in the APEX is coming from.\n\n\u003e  Please ensure that adbd APEX manifest marks libadbd_auth.so as required library\n\nDo you mean to mark it as required in Android.bp? I don\u0027t see any mention of required libraries in the apex_manifest.json documentation, or in any existing apex_manifest.json files.",
      "parentUuid": "0c359e32_ffecf24a",
      "range": {
        "startLine": 13,
        "startChar": 43,
        "endLine": 14,
        "endChar": 54
      },
      "revId": "6a3fc646f901166b352bcd1fd64869169c6b8a3b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3a371817_5f32626f",
        "filename": "adb/apex/ld.config.txt",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2020-01-31T00:22:46Z",
      "side": 1,
      "message": "\u003e Won\u0027t that make it easier to accidentally load libraries from the system image, though? It seems like we should be explicit about where every library in the APEX is coming from.\n\n\nWell, this is fine unless you explicitly try to dlopen(\"/system/lib/libfoo.so\"). dlopen(\"libfoo.so\") will still be unsuccessful.",
      "parentUuid": "77964081_399cd243",
      "range": {
        "startLine": 13,
        "startChar": 43,
        "endLine": 14,
        "endChar": 54
      },
      "revId": "6a3fc646f901166b352bcd1fd64869169c6b8a3b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "58f53fed_eedc1026",
        "filename": "adb/apex/ld.config.txt",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1413436
      },
      "writtenOn": "2020-01-31T06:16:20Z",
      "side": 1,
      "message": "I think current configuration cannot block such case neither. I still failed to understand the benefit of the new configuration.\n\n\u003e Do you mean to mark it as required in Android.bp? I don\u0027t see any mention of required libraries in the apex_manifest.json documentation, or in any existing apex_manifest.json files.\n\nI checked with Jooyung and as long as you have specified libadbd_auth as shared library and also it has stub then it should be fine. You can just verify it from apex_manifest.pb if it specifies libadbd_auth.so",
      "parentUuid": "3a371817_5f32626f",
      "range": {
        "startLine": 13,
        "startChar": 43,
        "endLine": 14,
        "endChar": 54
      },
      "revId": "6a3fc646f901166b352bcd1fd64869169c6b8a3b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}