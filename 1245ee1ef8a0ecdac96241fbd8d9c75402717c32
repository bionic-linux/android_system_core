{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "dd849fcc_1bb441d7",
        "filename": "fs_mgr/libsnapshot/snapuserd/user-space-merge/read_worker.cpp",
        "patchSetId": 30
      },
      "lineNbr": 290,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2024-01-29T21:57:37Z",
      "side": 1,
      "message": "When would max compression be zero?\n\n(Also, this function is close to 200 lines now - maybe some of the longer if conditions can be split into helpers? Only if it would help readability.)",
      "revId": "1245ee1ef8a0ecdac96241fbd8d9c75402717c32",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "de258f9a_7cf39f7b",
        "filename": "fs_mgr/libsnapshot/snapuserd/user-space-merge/read_worker.cpp",
        "patchSetId": 30
      },
      "lineNbr": 290,
      "author": {
        "id": 1964171
      },
      "writtenOn": "2024-01-29T22:10:29Z",
      "side": 1,
      "message": "when it\u0027s not set in the header. (we ran into the issue of forgetting to set max compression and then trying to debug a reader that was trying to read into an empty buffer here.",
      "parentUuid": "dd849fcc_1bb441d7",
      "revId": "1245ee1ef8a0ecdac96241fbd8d9c75402717c32",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1b542c0f_0562a10d",
        "filename": "fs_mgr/libsnapshot/snapuserd/user-space-merge/read_worker.cpp",
        "patchSetId": 30
      },
      "lineNbr": 290,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2024-01-29T22:15:16Z",
      "side": 1,
      "message": "Okay, this should be validated in cow_writer then (and if really needed, reader). In general we shouldn\u0027t have to re-validate downstream.",
      "parentUuid": "de258f9a_7cf39f7b",
      "revId": "1245ee1ef8a0ecdac96241fbd8d9c75402717c32",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2964be04_1d50dc59",
        "filename": "fs_mgr/libsnapshot/snapuserd/user-space-merge/read_worker.cpp",
        "patchSetId": 30
      },
      "lineNbr": 290,
      "author": {
        "id": 1724998
      },
      "writtenOn": "2024-01-31T20:32:06Z",
      "side": 1,
      "message": "I have kept the check here because, daemon shouldn\u0027t crash if we end up with a bad value. The check will gracefully fail the I/O. \n\n(In fact we should remove all assertions and convert them into an error; but that is for a different CL. @zhengdaniel@google.com)\n\nv3 writer does the validation and errors out if it\u0027s not set.",
      "parentUuid": "1b542c0f_0562a10d",
      "revId": "1245ee1ef8a0ecdac96241fbd8d9c75402717c32",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2e9f3bd5_059e26cf",
        "filename": "fs_mgr/libsnapshot/snapuserd/user-space-merge/read_worker.cpp",
        "patchSetId": 30
      },
      "lineNbr": 290,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2024-01-31T20:33:25Z",
      "side": 1,
      "message": "There are lots of places where the COW could be corrupted though. snapuserd core logic isn\u0027t the right place to catch that.",
      "parentUuid": "2964be04_1d50dc59",
      "revId": "1245ee1ef8a0ecdac96241fbd8d9c75402717c32",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6baed239_8181db05",
        "filename": "fs_mgr/libsnapshot/snapuserd/user-space-merge/read_worker.cpp",
        "patchSetId": 30
      },
      "lineNbr": 290,
      "author": {
        "id": 1724998
      },
      "writtenOn": "2024-01-31T20:37:19Z",
      "side": 1,
      "message": "The problem here is that if the daemon crashes, then device will fail to boot and dm-user will start sending EIO. Eventually, device will rollback.\n\nHowever, if we gracefully fail the I/O, device will immediately rollback. We saw this in CF test as well.",
      "parentUuid": "2e9f3bd5_059e26cf",
      "revId": "1245ee1ef8a0ecdac96241fbd8d9c75402717c32",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}