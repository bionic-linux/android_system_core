{
  "comments": [
    {
      "key": {
        "uuid": "d7f6229d_65edead4",
        "filename": "adb/sockets.cpp",
        "patchSetId": 4
      },
      "lineNbr": 44,
      "author": {
        "id": 1056364
      },
      "writtenOn": "2016-05-18T19:16:38Z",
      "side": 1,
      "message": "Just remembered that as all asockets are used only in main thread, the lock actually doesn\u0027t take effect. And if we really need to operate asockets in different threads, only local_socket_list_lock might not be enough. I thought of removing the lock, but didn\u0027t take action as having the lock doesn\u0027t hurt anything. maybe we can remove it when totally refactored asocket into a c++ class (so we have better control of its use). However, I think it is an improvement to change the lock into recursive mutex, as we can remove code like L236.",
      "range": {
        "startLine": 44,
        "startChar": 29,
        "endLine": 44,
        "endChar": 51
      },
      "revId": "4dac2fc188de40d53e00808e2933ea65a0b8936a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d7f6229d_4528aedf",
        "filename": "adb/sockets.cpp",
        "patchSetId": 4
      },
      "lineNbr": 44,
      "author": {
        "id": 1079148
      },
      "writtenOn": "2016-05-18T19:23:06Z",
      "side": 1,
      "message": "Yeah, I\u0027m planning on doing a big refactor of asocket soon, it can probably wait until then.",
      "parentUuid": "d7f6229d_65edead4",
      "range": {
        "startLine": 44,
        "startChar": 29,
        "endLine": 44,
        "endChar": 51
      },
      "revId": "4dac2fc188de40d53e00808e2933ea65a0b8936a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d7f6229d_fa785519",
        "filename": "adb/sockets.cpp",
        "patchSetId": 4
      },
      "lineNbr": 94,
      "author": {
        "id": 1056364
      },
      "writtenOn": "2016-05-18T19:16:38Z",
      "side": 1,
      "message": "I think it might overflow, like when you have created (1\u003c\u003c32) sockets.",
      "range": {
        "startLine": 94,
        "startChar": 8,
        "endLine": 94,
        "endChar": 42
      },
      "revId": "4dac2fc188de40d53e00808e2933ea65a0b8936a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d7f6229d_4511ce9d",
        "filename": "adb/sockets.cpp",
        "patchSetId": 4
      },
      "lineNbr": 94,
      "author": {
        "id": 1079148
      },
      "writtenOn": "2016-05-18T19:23:06Z",
      "side": 1,
      "message": "Right, but the previous behavior is broken, because it\u0027ll allocate that socket id without checking if it\u0027s still in use.",
      "parentUuid": "d7f6229d_fa785519",
      "range": {
        "startLine": 94,
        "startChar": 8,
        "endLine": 94,
        "endChar": 42
      },
      "revId": "4dac2fc188de40d53e00808e2933ea65a0b8936a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d7f6229d_054ce660",
        "filename": "adb/sockets.cpp",
        "patchSetId": 4
      },
      "lineNbr": 94,
      "author": {
        "id": 1056364
      },
      "writtenOn": "2016-05-18T20:25:14Z",
      "side": 1,
      "message": "yes, we don\u0027t record which id is used. but letting it abort seems not very proper (especially on device aborts are treated as bugs). How about leaving this until refactoring local_socket_list into a map?",
      "parentUuid": "d7f6229d_4511ce9d",
      "range": {
        "startLine": 94,
        "startChar": 8,
        "endLine": 94,
        "endChar": 42
      },
      "revId": "4dac2fc188de40d53e00808e2933ea65a0b8936a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d7f6229d_e0f1c8a4",
        "filename": "adb/sockets.cpp",
        "patchSetId": 4
      },
      "lineNbr": 94,
      "author": {
        "id": 1079148
      },
      "writtenOn": "2016-05-18T21:32:58Z",
      "side": 1,
      "message": "A guaranteed abort for something that is highly unlikely seems a lot better than the alternative of getting the wrong socket and completely mangling the state machine.",
      "parentUuid": "d7f6229d_054ce660",
      "range": {
        "startLine": 94,
        "startChar": 8,
        "endLine": 94,
        "endChar": 42
      },
      "revId": "4dac2fc188de40d53e00808e2933ea65a0b8936a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}