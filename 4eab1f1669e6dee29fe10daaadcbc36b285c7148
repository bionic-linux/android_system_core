{
  "comments": [
    {
      "key": {
        "uuid": "7b9779ad_42f93816",
        "filename": "adb/daemon/file_sync_service.cpp",
        "patchSetId": 4
      },
      "lineNbr": 58,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2019-01-15T15:53:38Z",
      "side": 1,
      "message": "If /system (or /vendor or ...) is an overlayfs mount, return false as overlayfs will look after it for you?",
      "range": {
        "startLine": 58,
        "startChar": 12,
        "endLine": 58,
        "endChar": 25
      },
      "revId": "4eab1f1669e6dee29fe10daaadcbc36b285c7148",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ba300a9e_9e8cc296",
        "filename": "adb/daemon/file_sync_service.cpp",
        "patchSetId": 4
      },
      "lineNbr": 58,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2019-01-15T17:15:14Z",
      "side": 1,
      "message": "I think we shouldn\u0027t delete these files even when overlayfs is used. In my understanding, \n\n1) / (ext4): is at the bottom\n2) at /system, an overlayfs is mounted where lowerfs is set to /system, while upperfs is set to somewhere writable.\n3) at /system/bin/libc.so, /system/bin/libc.so is bind-mounted. (for pre-apexd processes)\n4) at /system/bin/libc.so, /apex/com.android.runtine/lib/libc.so is bind-mounted. (for post-apexd processes)\n\nSo if we bind-mount /system non-recursively to /system as in #604, then we are seeing 2), effectively hiding 3) and 4). However, for other mount namespaces, 3) and 4) are still alive. If we delete the inode for /system/lib/libc.so on the overlayfs, then the bind-mount 3) will be destroyed as its source path has gone.",
      "parentUuid": "7b9779ad_42f93816",
      "range": {
        "startLine": 58,
        "startChar": 12,
        "endLine": 58,
        "endChar": 25
      },
      "revId": "4eab1f1669e6dee29fe10daaadcbc36b285c7148",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "60baef8a_5778ff38",
        "filename": "adb/daemon/file_sync_service.cpp",
        "patchSetId": 4
      },
      "lineNbr": 58,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2019-01-15T18:22:34Z",
      "side": 1,
      "message": "Ok, got it, preservation of the bind-mount detail. If one overrides the content, overlayfs will preserve it for pre-apexd processes (I believe) which is the intent. Will we have the need to override the post-apexd process content; (I believe) this happens when the apex package is updated. A reboot brings everything into line.\n\nQ: so for example, if logd restarts (a pre-apex executable), which libc.so does it use ... I have distrust in the namespace ...",
      "parentUuid": "ba300a9e_9e8cc296",
      "range": {
        "startLine": 58,
        "startChar": 12,
        "endLine": 58,
        "endChar": 25
      },
      "revId": "4eab1f1669e6dee29fe10daaadcbc36b285c7148",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f81933c2_df1bf13b",
        "filename": "adb/daemon/file_sync_service.cpp",
        "patchSetId": 4
      },
      "lineNbr": 58,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2019-01-15T19:19:32Z",
      "side": 1,
      "message": "When a pre-apexd process is restarted, it will still use the bootstrap libc. init recognizes whether a service is pre-apexd or not and in case of pre-apexd, it uses a separate mount namespace where bionic libs from the runtime APEX are not mounted.",
      "parentUuid": "60baef8a_5778ff38",
      "range": {
        "startLine": 58,
        "startChar": 12,
        "endLine": 58,
        "endChar": 25
      },
      "revId": "4eab1f1669e6dee29fe10daaadcbc36b285c7148",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "689f42fb_9eed42a8",
        "filename": "adb/daemon/file_sync_service.cpp",
        "patchSetId": 4
      },
      "lineNbr": 68,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2019-01-15T15:53:38Z",
      "side": 1,
      "message": "check to make sure tokens size is 4 or greater, otherwise this is an illegal access.",
      "range": {
        "startLine": 68,
        "startChar": 41,
        "endLine": 68,
        "endChar": 51
      },
      "revId": "4eab1f1669e6dee29fe10daaadcbc36b285c7148",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0d7253ea_3833ea78",
        "filename": "adb/daemon/file_sync_service.cpp",
        "patchSetId": 4
      },
      "lineNbr": 68,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2019-01-15T17:15:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "689f42fb_9eed42a8",
      "range": {
        "startLine": 68,
        "startChar": 41,
        "endLine": 68,
        "endChar": 51
      },
      "revId": "4eab1f1669e6dee29fe10daaadcbc36b285c7148",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1ea1d97e_480fcfda",
        "filename": "adb/daemon/file_sync_service.cpp",
        "patchSetId": 4
      },
      "lineNbr": 73,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2019-01-15T15:53:38Z",
      "side": 1,
      "message": "nit: why not use std::find_if?\n\nreturn std::find_if(lines.begin(), lines.end(), [\u0026path] (const auto\u0026 line) {\n    auto tokens \u003d android::base::Split(line, \" \");\n    if (tokens.size() \u003c 4) return false;\n    return tokens[4] \u003d\u003d path;\n});",
      "range": {
        "startLine": 65,
        "startChar": 0,
        "endLine": 73,
        "endChar": 17
      },
      "revId": "4eab1f1669e6dee29fe10daaadcbc36b285c7148",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bb8c2e5e_afe976ba",
        "filename": "adb/daemon/file_sync_service.cpp",
        "patchSetId": 4
      },
      "lineNbr": 73,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2019-01-15T17:15:14Z",
      "side": 1,
      "message": "Thanks for the suggestion. Much nicer. Done with the addition of !\u003d lines.end() because we are not interested in the line\u0027s content, but the existence of the line satisfying the condition.",
      "parentUuid": "1ea1d97e_480fcfda",
      "range": {
        "startLine": 65,
        "startChar": 0,
        "endLine": 73,
        "endChar": 17
      },
      "revId": "4eab1f1669e6dee29fe10daaadcbc36b285c7148",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "353e83b1_31003b8f",
        "filename": "adb/daemon/file_sync_service.cpp",
        "patchSetId": 4
      },
      "lineNbr": 579,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2019-01-15T18:22:34Z",
      "side": 1,
      "message": "This check should not be required, sync is blocked AFAIK. Or w/o this test, do we get logspam?",
      "range": {
        "startLine": 575,
        "startChar": 0,
        "endLine": 579,
        "endChar": 9
      },
      "revId": "4eab1f1669e6dee29fe10daaadcbc36b285c7148",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9655151a_b16e2c55",
        "filename": "adb/daemon/file_sync_service.cpp",
        "patchSetId": 4
      },
      "lineNbr": 579,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2019-01-15T19:19:32Z",
      "side": 1,
      "message": "we will do this for pull as well.",
      "parentUuid": "353e83b1_31003b8f",
      "range": {
        "startLine": 575,
        "startChar": 0,
        "endLine": 579,
        "endChar": 9
      },
      "revId": "4eab1f1669e6dee29fe10daaadcbc36b285c7148",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "130edcdc_91d483a9",
        "filename": "adb/daemon/file_sync_service.cpp",
        "patchSetId": 4
      },
      "lineNbr": 584,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2019-01-15T18:22:34Z",
      "side": 1,
      "message": "stutter.",
      "range": {
        "startLine": 584,
        "startChar": 61,
        "endLine": 584,
        "endChar": 81
      },
      "revId": "4eab1f1669e6dee29fe10daaadcbc36b285c7148",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5ba29ab5_8c7970eb",
        "filename": "adb/daemon/file_sync_service.cpp",
        "patchSetId": 4
      },
      "lineNbr": 584,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2019-01-15T19:19:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "130edcdc_91d483a9",
      "range": {
        "startLine": 584,
        "startChar": 61,
        "endLine": 584,
        "endChar": 81
      },
      "revId": "4eab1f1669e6dee29fe10daaadcbc36b285c7148",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5fac7a0a_e5ff55d4",
        "filename": "adb/daemon/file_sync_service.cpp",
        "patchSetId": 4
      },
      "lineNbr": 590,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2019-01-15T18:22:34Z",
      "side": 1,
      "message": "stutter.",
      "range": {
        "startLine": 590,
        "startChar": 62,
        "endLine": 590,
        "endChar": 82
      },
      "revId": "4eab1f1669e6dee29fe10daaadcbc36b285c7148",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6c40c4c7_6514c7c7",
        "filename": "adb/daemon/file_sync_service.cpp",
        "patchSetId": 4
      },
      "lineNbr": 590,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2019-01-15T19:19:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "5fac7a0a_e5ff55d4",
      "range": {
        "startLine": 590,
        "startChar": 62,
        "endLine": 590,
        "endChar": 82
      },
      "revId": "4eab1f1669e6dee29fe10daaadcbc36b285c7148",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "eb2660d6_af552435",
        "filename": "adb/daemon/file_sync_service.cpp",
        "patchSetId": 4
      },
      "lineNbr": 597,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2019-01-15T18:22:34Z",
      "side": 1,
      "message": "nit: ( ) is unnecessary",
      "range": {
        "startLine": 597,
        "startChar": 41,
        "endLine": 597,
        "endChar": 62
      },
      "revId": "4eab1f1669e6dee29fe10daaadcbc36b285c7148",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "38516dcf_e74fc1c4",
        "filename": "adb/daemon/file_sync_service.cpp",
        "patchSetId": 4
      },
      "lineNbr": 597,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2019-01-15T19:19:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "eb2660d6_af552435",
      "range": {
        "startLine": 597,
        "startChar": 41,
        "endLine": 597,
        "endChar": 62
      },
      "revId": "4eab1f1669e6dee29fe10daaadcbc36b285c7148",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9636ab97_84496059",
        "filename": "adb/daemon/file_sync_service.cpp",
        "patchSetId": 4
      },
      "lineNbr": 605,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2019-01-15T18:22:34Z",
      "side": 1,
      "message": "log stutter, PLOG already report strerror.",
      "range": {
        "startLine": 605,
        "startChar": 70,
        "endLine": 605,
        "endChar": 90
      },
      "revId": "4eab1f1669e6dee29fe10daaadcbc36b285c7148",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1bb96c05_daa58743",
        "filename": "adb/daemon/file_sync_service.cpp",
        "patchSetId": 4
      },
      "lineNbr": 605,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2019-01-15T19:19:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9636ab97_84496059",
      "range": {
        "startLine": 605,
        "startChar": 70,
        "endLine": 605,
        "endChar": 90
      },
      "revId": "4eab1f1669e6dee29fe10daaadcbc36b285c7148",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ea27bf82_e354b58d",
        "filename": "adb/daemon/file_sync_service.cpp",
        "patchSetId": 4
      },
      "lineNbr": 616,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2019-01-15T18:22:34Z",
      "side": 1,
      "message": "log stutter, PLOG already prints errno string.",
      "range": {
        "startLine": 616,
        "startChar": 74,
        "endLine": 616,
        "endChar": 94
      },
      "revId": "4eab1f1669e6dee29fe10daaadcbc36b285c7148",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "43e6a2af_6d2ab851",
        "filename": "adb/daemon/file_sync_service.cpp",
        "patchSetId": 4
      },
      "lineNbr": 616,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2019-01-15T19:19:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ea27bf82_e354b58d",
      "range": {
        "startLine": 616,
        "startChar": 74,
        "endLine": 616,
        "endChar": 94
      },
      "revId": "4eab1f1669e6dee29fe10daaadcbc36b285c7148",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "84f3e026_3fa5be07",
        "filename": "adb/daemon/file_sync_service.cpp",
        "patchSetId": 4
      },
      "lineNbr": 622,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2019-01-15T18:22:34Z",
      "side": 1,
      "message": "Our C++ standard requires saved_ns_fs_",
      "range": {
        "startLine": 622,
        "startChar": 14,
        "endLine": 622,
        "endChar": 26
      },
      "revId": "4eab1f1669e6dee29fe10daaadcbc36b285c7148",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5179f3bc_708e92cc",
        "filename": "adb/daemon/file_sync_service.cpp",
        "patchSetId": 4
      },
      "lineNbr": 622,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2019-01-15T19:19:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "84f3e026_3fa5be07",
      "range": {
        "startLine": 622,
        "startChar": 14,
        "endLine": 622,
        "endChar": 26
      },
      "revId": "4eab1f1669e6dee29fe10daaadcbc36b285c7148",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}