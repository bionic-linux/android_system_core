{
  "comments": [
    {
      "key": {
        "uuid": "4eddd632_b893cf51",
        "filename": "init/devices.cpp",
        "patchSetId": 6
      },
      "lineNbr": 358,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2018-04-30T17:49:01Z",
      "side": 1,
      "message": "This would detect both of the by-name symlinks, not just the one you\u0027re adding.\n\nI think we can drop this check in any case.  Honestly, the check for EEXIST seems a bit inappropriate.  We shouldn\u0027t have ever failed such a check before and if we did, reporting an error seems to make sense.",
      "range": {
        "startLine": 358,
        "startChar": 27,
        "endLine": 358,
        "endChar": 86
      },
      "revId": "fe9889814627b511e5b34dcc86fe8f8e5816959a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "16abee82_28ec7b08",
        "filename": "init/devices.cpp",
        "patchSetId": 6
      },
      "lineNbr": 358,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2018-05-01T07:48:46Z",
      "side": 1,
      "message": "The following check should exclude other by-name symlinks.\n  pos \u003c\u003d std::string(\"/dev/block/platform/\").size()\n\nAnyway, I was thinking about the same thing:\nJust reporting LOG(ERROR) seems enough to me.",
      "parentUuid": "4eddd632_b893cf51",
      "range": {
        "startLine": 358,
        "startChar": 27,
        "endLine": 358,
        "endChar": 86
      },
      "revId": "fe9889814627b511e5b34dcc86fe8f8e5816959a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7db6f636_226c3056",
        "filename": "init/devices.cpp",
        "patchSetId": 6
      },
      "lineNbr": 362,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2018-04-30T17:49:01Z",
      "side": 1,
      "message": "Same with this check, I\u0027d just report all of these as errors.\n\nI wouldn\u0027t make this FATAL though.  We\u0027ve never had the restriction that people cannot have the same partition name on multiple devices.  If anything, I\u0027d probably remove the existing link when this happens, so people don\u0027t depend on it being there when some other device may provide it.\n\nAlso, how does this interact with removable storage?  USB storage gets handled at a higher level, right?  The PCI storage is really just built in storage; we don\u0027t support PCIe hotswap, right?  I just want to make sure there\u0027s nothing a user can do to trigger this and that only built-in storage devices would go through this code path.",
      "range": {
        "startLine": 362,
        "startChar": 24,
        "endLine": 362,
        "endChar": 76
      },
      "revId": "fe9889814627b511e5b34dcc86fe8f8e5816959a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6f6d07e7_bd7f9b78",
        "filename": "init/devices.cpp",
        "patchSetId": 6
      },
      "lineNbr": 362,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2018-05-01T07:48:46Z",
      "side": 1,
      "message": "OK, +1\n\nI\u0027m not sure about the case of removable, USB or PCI.\nI agree that we should only add the new by-name symlinks for \"built-in\" storage. Will check how to do this. (at least, only apply to type \u003d\u003d \"platform\").",
      "parentUuid": "7db6f636_226c3056",
      "range": {
        "startLine": 362,
        "startChar": 24,
        "endLine": 362,
        "endChar": 76
      },
      "revId": "fe9889814627b511e5b34dcc86fe8f8e5816959a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0cf1863b_9adf5a81",
        "filename": "init/devices.cpp",
        "patchSetId": 6
      },
      "lineNbr": 362,
      "author": {
        "id": 1315132
      },
      "writtenOn": "2018-05-02T13:47:34Z",
      "side": 1,
      "message": "For A/B devices, e.g. \"system_a\" and \"system_b\", here it will links to /dev/block/platform/system_a and /dev/block/platform/system_b?\nThen, how to config the device-tree string of system for early mount?",
      "parentUuid": "6f6d07e7_bd7f9b78",
      "range": {
        "startLine": 362,
        "startChar": 24,
        "endLine": 362,
        "endChar": 76
      },
      "revId": "fe9889814627b511e5b34dcc86fe8f8e5816959a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d033b095_cbb9383c",
        "filename": "init/devices.cpp",
        "patchSetId": 6
      },
      "lineNbr": 362,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2018-05-02T14:29:19Z",
      "side": 1,
      "message": "Hi,\nThat\u0027s already the case today.\n\ne.g., in Taimen\n/dev/block/platform/soc/1da4000.ufshc/by-name/system_a\n/dev/block/platform/soc/1da4000.ufshc/by-name/system_b\n\nThis CL just adds another symlinks by removing the \"platform/soc/1da4......\" part from above. So it becomes \"generic\" across devices.\n\n/dev/block/by-name/system_a\n/dev/block/by-name/system_b\n\nJust add \u0027slotselect\u0027 fsmgr_flags in the fstab.\n\n/ {\n  firmware {\n    android {\n      compatible \u003d \"android,firmware\";\n      fstab {\n        compatible \u003d \"android,fstab\";\n        vendor {\n          compatible \u003d \"android,vendor\";\n          dev \u003d \"/dev/block/platform/soc/624000.ufshc/by-name/vendor\";\n          type \u003d \"ext4\";\n          mnt_flags \u003d \"ro,barrier\u003d1,discard\";\n          fsmgr_flags \u003d \"wait,slotselect,verify\"; \u003c--\n        };\n      };\n    };\n  };\n};\n\n\nThen fs_mgr_update_for_slotselect() will append ab_suffix to the device path.\nhttps://android.googlesource.com/platform/system/core/+/master/fs_mgr/fs_mgr_slotselect.cpp#34",
      "parentUuid": "0cf1863b_9adf5a81",
      "range": {
        "startLine": 362,
        "startChar": 24,
        "endLine": 362,
        "endChar": 76
      },
      "revId": "fe9889814627b511e5b34dcc86fe8f8e5816959a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}