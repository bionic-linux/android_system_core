{
  "comments": [
    {
      "key": {
        "uuid": "11aed700_b54528ea",
        "filename": "fs_mgr/fs_mgr.cpp",
        "patchSetId": 12
      },
      "lineNbr": 584,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2020-02-14T17:57:01Z",
      "side": 1,
      "message": "It looks like this moves and resizes metadata. If the device loses power during the operation, is the partition recoverable?",
      "revId": "78f040c6d6f15b6008f6da600a5262c6a6224d68",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "31bf2d00_09117bf6",
        "filename": "fs_mgr/fs_mgr.cpp",
        "patchSetId": 12
      },
      "lineNbr": 584,
      "author": {
        "id": 1176763
      },
      "writtenOn": "2020-02-14T18:11:43Z",
      "side": 1,
      "message": "I guess no. Actually, tune2fs has more chance to be corrupted, since it\u0027ll overwrite some blocks with checksum. But, it seems /metadata is small enough which takes 70ms for both of runs. I think the risk hitting power cut during 70ms only from single transition should be pretty low.\n\n221024 [   10.284476] c7      1 tune2fs: tune2fs 1.45.4 (23-Sep-2019)\n221025 [   10.284476] c7      1\n221026 [   10.292600] c7      1 tune2fs: Setting time filesystem last checked to Mon Apr  1 00:00:00 8278\n221027 [   10.292600] c7      1\n221028 [   10.303940] c7      1 tune2fs:\n221029 [   10.303940] c7      1\n221030 [   10.309570] c7      1 tune2fs: Please run `resize2fs -b /dev/block/by-name/metadata\u0027 to enable 64-bit mode.\n221031 [   10.309570] c7      1\n221032 [   10.328038] c7      1 resize2fs: resize2fs 1.45.4 (23-Sep-2019)\n221033 [   10.328038] c7      1\n221034 [   10.336535] c7      1 resize2fs: Converting the filesystem to 64-bit.\n221035 [   10.336535] c7      1\n221036 [   10.345568] c7      1 resize2fs: The filesystem on /dev/block/by-name/metadata is now 4096 (4k) blocks long.\n221037 [   10.345568] c7      1\n221038 [   10.358070] c7      1 resize2fs:\n221039 [   10.358070] c7      1",
      "parentUuid": "11aed700_b54528ea",
      "revId": "78f040c6d6f15b6008f6da600a5262c6a6224d68",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7f4e1f11_17d8ca27",
        "filename": "fs_mgr/fs_mgr.cpp",
        "patchSetId": 12
      },
      "lineNbr": 584,
      "author": {
        "id": 1010465
      },
      "writtenOn": "2020-02-14T20:24:09Z",
      "side": 1,
      "message": "The situation is similar for other update that can happen inside fs_mgr. So that is not an issue only for this CL.",
      "parentUuid": "31bf2d00_09117bf6",
      "revId": "78f040c6d6f15b6008f6da600a5262c6a6224d68",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "820aa653_0e310081",
        "filename": "fs_mgr/fs_mgr.cpp",
        "patchSetId": 12
      },
      "lineNbr": 584,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2020-02-14T20:41:42Z",
      "side": 1,
      "message": "What kind of other updates are you thinking of, that change the filesystem outside of the journal?",
      "parentUuid": "7f4e1f11_17d8ca27",
      "revId": "78f040c6d6f15b6008f6da600a5262c6a6224d68",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c222b689_cc5dfa96",
        "filename": "fs_mgr/fs_mgr.cpp",
        "patchSetId": 12
      },
      "lineNbr": 584,
      "author": {
        "id": 1010465
      },
      "writtenOn": "2020-02-14T21:07:19Z",
      "side": 1,
      "message": "I meant existing one. For example, as simple thing as adding quota (L348) can also have issue if power goes not in the middle.",
      "parentUuid": "820aa653_0e310081",
      "revId": "78f040c6d6f15b6008f6da600a5262c6a6224d68",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "89ce6c5e_59334ce0",
        "filename": "fs_mgr/fs_mgr.cpp",
        "patchSetId": 12
      },
      "lineNbr": 584,
      "author": {
        "id": 1176763
      },
      "writtenOn": "2020-02-18T22:29:08Z",
      "side": 1,
      "message": "I think it\u0027d be great to add a journalling feature in filesystem tools. The pain point would sit on who is willing to implement such the huge/complicated modification, since it looks a bit lower priority by the fact that we\u0027ve been using many tools w/o serious problem so far.\n\nActually, fsck on /data is the most risky part, since it can touch all the filesystem metadata and dentries with longer duration occasionally.\n\nPlease let me know, if there is other concerns. I hope to enhance /metadata for Pixel 4 asap.",
      "parentUuid": "c222b689_cc5dfa96",
      "revId": "78f040c6d6f15b6008f6da600a5262c6a6224d68",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}