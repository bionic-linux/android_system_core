{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "eba963ed_574455a8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2022-11-09T03:49:13Z",
      "side": 1,
      "message": "This looks to fix the race, though I think something important is missing in the retrospective, and leading up to this re-landing: how can we improve testing? If there\u0027s another regression in this code it\u0027ll lead to more lab issues and another revert, and it\u0027s pretty tricky code to get right.",
      "revId": "6486a28d611e5a27bcc514eac4fd43b84a616828",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bde5306d_bb8662bd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1869780
      },
      "writtenOn": "2022-11-09T18:11:30Z",
      "side": 1,
      "message": "The best way to prevent lab issues is to modify the test setups in the lab. Test setups should not require manual intervention to recover from a software failure. Hardware that supports automatic recovery from boot failures already exist, namely the Pixel development boards. The physical buttons on these boards support rebooting the board at any time, booting into the bootloader and also ROM recovery. A connector could be added to these boards to make it easy to control these recovery facilities from another system.\n\nTesting of the platform code can be improved by adding support for mocking the interaction with the Linux kernel (system calls, ioctls, netlink, procfs, sysfs and cgroups). Once that infrastructure is in place it will become possible to write unit tests that simulate failures of any interaction with the operating system. Building that infrastructure is something that I consider as out of scope for this CL.",
      "parentUuid": "eba963ed_574455a8",
      "revId": "6486a28d611e5a27bcc514eac4fd43b84a616828",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d4f7f9f3_4ab2bf9d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2022-11-09T19:22:43Z",
      "side": 1,
      "message": "I didn\u0027t mean that we needed rigorous, automated mocks of this - but we do need due diligence. Eg there\u0027s nothing in the \"Test:\" stanza to indicate that the setpgid regression was explicitly tested, manually or otherwise. If it was, that\u0027s great - let\u0027s record how it was verified. If not, it risks breaking the lab again.",
      "parentUuid": "bde5306d_bb8662bd",
      "revId": "6486a28d611e5a27bcc514eac4fd43b84a616828",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a8d29b2a_b9737ef3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1869780
      },
      "writtenOn": "2022-11-09T19:34:05Z",
      "side": 1,
      "message": "The regression triggered by the previous version of this patch was the result of the following:\n* Parent process calls setpgid() after child called execve().\n* Parent process converts the setpgid() failure into a Service::Start() failure.\n\nThis can\u0027t happen anymore since failures of the setpgid() call by the parent process no longer cause Service::Start() to fail. The worst that could happen with the current CL related to calling setpgid() is that the setpgid() call by the parent process fails for an unknown reason, that Service::Start() returns before the child process has called setpgid() and hence that the race mentioned in the CL description has not been fixed.\n\nThe race between setpgid() and execve() has been simulated by inserting a sleep_for() call in the parent process. I have verified that this error injection approach causes setpgid() to set errno to EACCES.",
      "parentUuid": "d4f7f9f3_4ab2bf9d",
      "revId": "6486a28d611e5a27bcc514eac4fd43b84a616828",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e3145704_8fe5a31e",
        "filename": "init/service.cpp",
        "patchSetId": 2
      },
      "lineNbr": 560,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2022-11-09T03:49:13Z",
      "side": 1,
      "message": "In case there is ever divergence here, I think this check should be a helper function (like ShouldCallSetSid) and the same helper check should get called in SetProcessAttributesAndCaps.",
      "revId": "6486a28d611e5a27bcc514eac4fd43b84a616828",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7214ae48_77a54c07",
        "filename": "init/service.cpp",
        "patchSetId": 2
      },
      "lineNbr": 560,
      "author": {
        "id": 1869780
      },
      "writtenOn": "2022-11-09T19:08:15Z",
      "side": 1,
      "message": "A new function \u0027RequiresConsole()\u0027 has been introduced.",
      "parentUuid": "e3145704_8fe5a31e",
      "revId": "6486a28d611e5a27bcc514eac4fd43b84a616828",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}