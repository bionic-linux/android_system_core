{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "2b55826a_e9433fc4",
        "filename": "trusty/keymaster/ipc/trusty_keymaster_ipc.cpp",
        "patchSetId": 5
      },
      "lineNbr": 94,
      "author": {
        "id": 1856745
      },
      "writtenOn": "2021-09-21T15:25:44Z",
      "side": 1,
      "message": "is the timeout in ms, so it is right now set to 30sec?\nwas there a specific rationale for choosing 30sec?\nwould be good to check with Janis to gauge what is a good number.",
      "revId": "55e5714c64e279ad3d10eb292950934d3ad78ad0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dc351e11_c40e6852",
        "filename": "trusty/keymaster/ipc/trusty_keymaster_ipc.cpp",
        "patchSetId": 5
      },
      "lineNbr": 94,
      "author": {
        "id": 1001525
      },
      "writtenOn": "2021-09-21T17:56:39Z",
      "side": 1,
      "message": "Yes, it\u0027s 30 seconds, and I just picked that arbitrarily. It seems like something we shouldn\u0027t hit under normal circumstances (and in my testing we don\u0027t), and a decent indicator of whether something is stuck.",
      "parentUuid": "2b55826a_e9433fc4",
      "revId": "55e5714c64e279ad3d10eb292950934d3ad78ad0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1611955f_4078a378",
        "filename": "trusty/keymaster/ipc/trusty_keymaster_ipc.cpp",
        "patchSetId": 5
      },
      "lineNbr": 94,
      "author": {
        "id": 1092085
      },
      "writtenOn": "2021-09-23T17:24:26Z",
      "side": 1,
      "message": "I would suggest using a much shorter timeout after which we start getting noisy without actually causing an error. You could error out after all of the tries add up to 30 seconds. (I don\u0027t think there is ever a good argument to make for any timeout other then 0 or infinity).",
      "parentUuid": "dc351e11_c40e6852",
      "revId": "55e5714c64e279ad3d10eb292950934d3ad78ad0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e4e25565_64f38c8b",
        "filename": "trusty/keymaster/ipc/trusty_keymaster_ipc.cpp",
        "patchSetId": 5
      },
      "lineNbr": 94,
      "author": {
        "id": 1001525
      },
      "writtenOn": "2021-09-23T17:29:45Z",
      "side": 1,
      "message": "It was my understanding that at this point we don\u0027t want to error out, because that path hasn\u0027t been tested. That\u0027s why this change just logs if the fd is not ready to read/write within the given interval, but then continues on to the read/write calls anyway, allowing those calls to potentially still complete eventually.",
      "parentUuid": "1611955f_4078a378",
      "revId": "55e5714c64e279ad3d10eb292950934d3ad78ad0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a83d186c_7682baba",
        "filename": "trusty/keymaster/ipc/trusty_keymaster_ipc.cpp",
        "patchSetId": 5
      },
      "lineNbr": 94,
      "author": {
        "id": 1092085
      },
      "writtenOn": "2021-09-23T20:23:50Z",
      "side": 1,
      "message": "I missed that we are actually waiting indefinitely on the following wait. In that case I would suggest the following behavior: Wait for 10 seconds on the first poll. even a 4K RSA key generation should finish in 10 seconds normally. If that times out, keep polling in a loop with 1s timeout and log on any time out. This way we would see if it stalls forever or recovers. Another option would be to save the fact that we logged a timeout and if we recover, we log that we did. Something like:\n\n ssize_t rc \u003d write() ...\n if (timeout_logged \u0026\u0026 is_success(rc)) {\n     ALOGI(\"yay, we recovered after %u ms\", ...)\n }",
      "parentUuid": "e4e25565_64f38c8b",
      "revId": "55e5714c64e279ad3d10eb292950934d3ad78ad0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "506c3168_fd91aae1",
        "filename": "trusty/keymaster/ipc/trusty_keymaster_ipc.cpp",
        "patchSetId": 5
      },
      "lineNbr": 94,
      "author": {
        "id": 1856745
      },
      "writtenOn": "2021-09-24T14:11:15Z",
      "side": 1,
      "message": "like the idea of the \"recovered\" log!",
      "parentUuid": "a83d186c_7682baba",
      "revId": "55e5714c64e279ad3d10eb292950934d3ad78ad0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b0853aca_19bb9dd2",
        "filename": "trusty/keymaster/ipc/trusty_keymaster_ipc.cpp",
        "patchSetId": 5
      },
      "lineNbr": 94,
      "author": {
        "id": 1001525
      },
      "writtenOn": "2021-10-19T00:15:42Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "506c3168_fd91aae1",
      "revId": "55e5714c64e279ad3d10eb292950934d3ad78ad0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}