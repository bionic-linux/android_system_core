{
  "comments": [
    {
      "key": {
        "uuid": "a2995248_c3087f39",
        "filename": "bootstat/bootstat.rc",
        "patchSetId": 3
      },
      "lineNbr": 72,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2020-01-17T19:25:41Z",
      "side": 1,
      "message": "Too early IMHO, we want them enabled _after_ /data is mounted and after persistent properties have been read in. What about firmware_mounts_complete? other? (below)\n\n[TL;DR]\n\nWe (royal we, before I even got involved in bootstat) used \u0027boot\u0027 originally as you know.\n\nWe could use any of zygote-start, firmware_mount_complete, early-boot or boot to be valid as far as our /data and persistent properties are concerned, but only firmware_mounts_complete is not redone in userspace-reboot-resume or vold decrypt so it seems to be the best gate for this:\n\non late-init:\n    . . .\n    # Now we can mount /data. File encryption requires keymaster to decrypt\n    # /data, which in turn can only be loaded when system properties are present.\n    trigger post-fs-data\n\n    # Load persist properties and override properties (if enabled) from /data.\n    trigger load_persist_props_action\n\n    # Now we can start zygote for devices with file based encryption\n    trigger zygote-start\n\n    # Remove a file to wake up anything waiting for firmware.\n    trigger firmware_mounts_complete\n\n    trigger early-boot\n    trigger boot\n\nProblem with that is what-if firmware_mounts_complete get (over-)used too in the future, we will be back here again.\n\nAnother possibility is invent a one-time \u0027trigger load_persist_props_action_ready\u0027 in rootdir/init.rc that bootstat.rc can just use, and add a comment ahead of the trigger to make sure it is a known one-time event, and no one else calls it? Someone else may use it in the future, so not just for bootstat is the point.",
      "range": {
        "startLine": 72,
        "startChar": 3,
        "endLine": 72,
        "endChar": 7
      },
      "revId": "21b6a24b8e66c8683ba87c77c736af6ed6e046b9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c407917f_9f0c66cb",
        "filename": "bootstat/bootstat.rc",
        "patchSetId": 3
      },
      "lineNbr": 72,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2020-01-17T20:50:03Z",
      "side": 1,
      "message": "Will `on property:ro.persistent_properties.ready\u003dtrue` be good enough?\n\nro.persistent_properties.ready is set by init after persistent properties are loaded.",
      "parentUuid": "a2995248_c3087f39",
      "range": {
        "startLine": 72,
        "startChar": 3,
        "endLine": 72,
        "endChar": 7
      },
      "revId": "21b6a24b8e66c8683ba87c77c736af6ed6e046b9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "16b11849_6aca7668",
        "filename": "bootstat/bootstat.rc",
        "patchSetId": 3
      },
      "lineNbr": 72,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2020-01-17T21:07:18Z",
      "side": 1,
      "message": "Wait, why would this be too early?  Isn\u0027t the point that we want bootstat to run exactly once, so setting these very early is beneficial?  I would rather keep them at `on init`.",
      "parentUuid": "c407917f_9f0c66cb",
      "range": {
        "startLine": 72,
        "startChar": 3,
        "endLine": 72,
        "endChar": 7
      },
      "revId": "21b6a24b8e66c8683ba87c77c736af6ed6e046b9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d498e8e0_2b47d74c",
        "filename": "bootstat/bootstat.rc",
        "patchSetId": 3
      },
      "lineNbr": 72,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2020-01-18T00:09:31Z",
      "side": 1,
      "message": "So far, left `on init`. Happy to change when we reach consensus",
      "parentUuid": "16b11849_6aca7668",
      "range": {
        "startLine": 72,
        "startChar": 3,
        "endLine": 72,
        "endChar": 7
      },
      "revId": "21b6a24b8e66c8683ba87c77c736af6ed6e046b9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "57ac7d29_bced61a4",
        "filename": "bootstat/bootstat.rc",
        "patchSetId": 3
      },
      "lineNbr": 72,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2020-01-21T18:48:12Z",
      "side": 1,
      "message": "bootstat can not run until after /data is mounted, but \u0027enabling\u0027 it early, one removes one of the gates that prevents it from running by false triggering of zygote-start (which I believe happens on FDE, which admittedly we no longer support, but partners continue to use on low end devices) or sys.boot_completed (should not be a problem ... or is it?).",
      "parentUuid": "d498e8e0_2b47d74c",
      "range": {
        "startLine": 72,
        "startChar": 3,
        "endLine": 72,
        "endChar": 7
      },
      "revId": "21b6a24b8e66c8683ba87c77c736af6ed6e046b9",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}