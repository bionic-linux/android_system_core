{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "a47ab607_b3bc48b4",
        "filename": "fs_mgr/fs_mgr_overlayfs.cpp",
        "patchSetId": 1
      },
      "lineNbr": 642,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2022-06-20T14:28:02Z",
      "side": 1,
      "message": "Bo, Could you elaborate on how this error is reproduced? Do you have a sub-mount under /system/.... ?",
      "revId": "bae4e959eedf4b744bbf7f07c3fdba4bdd5d5d12",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "33e1ac25_fa35d0ee",
        "filename": "fs_mgr/fs_mgr_overlayfs.cpp",
        "patchSetId": 1
      },
      "lineNbr": 642,
      "author": {
        "id": 1956079
      },
      "writtenOn": "2022-06-21T04:09:10Z",
      "side": 1,
      "message": "Yes, we have a sub-mount under /system/.\nReproduce steps:\n1. Add a sub-mount under /system/\n2. The run remount to overlay /system\n3. The sub-mount content disappeared",
      "parentUuid": "a47ab607_b3bc48b4",
      "revId": "bae4e959eedf4b744bbf7f07c3fdba4bdd5d5d12",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "93b073d2_3a1f27a8",
        "filename": "fs_mgr/fs_mgr_overlayfs.cpp",
        "patchSetId": 1
      },
      "lineNbr": 642,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2022-06-21T15:08:34Z",
      "side": 1,
      "message": "Can we keep a single mount() call? Eg,\n\n    auto target \u003d (mount_point \u003d\u003d \"/system\") ? \"/\" : mount_point.c_str();",
      "parentUuid": "33e1ac25_fa35d0ee",
      "revId": "bae4e959eedf4b744bbf7f07c3fdba4bdd5d5d12",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "772d379f_e87edf1e",
        "filename": "fs_mgr/fs_mgr_overlayfs.cpp",
        "patchSetId": 1
      },
      "lineNbr": 642,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2022-06-21T15:48:40Z",
      "side": 1,
      "message": "Instead of special casing \"/system\" here, I\u0027m thinking we can bind mount \"/system -\u003e /system\" at the end of TrySwitchSystemAsRoot().\n\nAlthough it have pretty much the same outcome, we can group special logic of \"/system\" in one place instead of scattering around.",
      "parentUuid": "93b073d2_3a1f27a8",
      "revId": "bae4e959eedf4b744bbf7f07c3fdba4bdd5d5d12",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3abd81cb_d852a2c5",
        "filename": "fs_mgr/fs_mgr_overlayfs.cpp",
        "patchSetId": 1
      },
      "lineNbr": 642,
      "author": {
        "id": 1956079
      },
      "writtenOn": "2022-06-22T03:08:39Z",
      "side": 1,
      "message": "You mean to add bind mount \"/system -\u003e /system\" can hide \"/\" when doing remount?",
      "parentUuid": "772d379f_e87edf1e",
      "revId": "bae4e959eedf4b744bbf7f07c3fdba4bdd5d5d12",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "dd242c3a_07b51050",
        "filename": "fs_mgr/fs_mgr_overlayfs.cpp",
        "patchSetId": 1
      },
      "lineNbr": 642,
      "author": {
        "id": 1956079
      },
      "writtenOn": "2022-06-28T07:26:50Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3abd81cb_d852a2c5",
      "revId": "bae4e959eedf4b744bbf7f07c3fdba4bdd5d5d12",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8d0b7b5d_c84afe53",
        "filename": "fs_mgr/fs_mgr_overlayfs.cpp",
        "patchSetId": 1
      },
      "lineNbr": 642,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2022-07-06T13:56:48Z",
      "side": 1,
      "message": "Hi, Could you test if applying r.android.com/2146960 can fix your problem?",
      "parentUuid": "dd242c3a_07b51050",
      "revId": "bae4e959eedf4b744bbf7f07c3fdba4bdd5d5d12",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b7fb3435_ceca361b",
        "filename": "fs_mgr/fs_mgr_overlayfs.cpp",
        "patchSetId": 1
      },
      "lineNbr": 642,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2022-07-06T13:58:11Z",
      "side": 1,
      "message": "Rather than hacking fs_mgr_overlayfs_set_shared_mount like this, I\u0027d prefer r.android.com/2146960 which fixes the precondition of remount.",
      "parentUuid": "8d0b7b5d_c84afe53",
      "revId": "bae4e959eedf4b744bbf7f07c3fdba4bdd5d5d12",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ddc55106_5783f9de",
        "filename": "fs_mgr/fs_mgr_overlayfs.cpp",
        "patchSetId": 1
      },
      "lineNbr": 642,
      "author": {
        "id": 1956079
      },
      "writtenOn": "2022-07-12T02:16:26Z",
      "side": 1,
      "message": "This patch works",
      "parentUuid": "b7fb3435_ceca361b",
      "revId": "bae4e959eedf4b744bbf7f07c3fdba4bdd5d5d12",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dd8f3ebf_b443e1fc",
        "filename": "fs_mgr/fs_mgr_overlayfs.cpp",
        "patchSetId": 1
      },
      "lineNbr": 788,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2022-06-20T14:28:02Z",
      "side": 1,
      "message": "David, Why do we need this MS_SHARED -\u003e MS_PRIVATE -\u003e MS_SHARED shuffling? Just curious.",
      "range": {
        "startLine": 788,
        "startChar": 34,
        "endLine": 788,
        "endChar": 67
      },
      "revId": "bae4e959eedf4b744bbf7f07c3fdba4bdd5d5d12",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "aa72aff3_2f75942f",
        "filename": "fs_mgr/fs_mgr_overlayfs.cpp",
        "patchSetId": 1
      },
      "lineNbr": 788,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2022-06-21T15:06:13Z",
      "side": 1,
      "message": "If I remember correctly, submounts do not work otherwise (they\u0027d get hidden or the parent remount would fail).",
      "parentUuid": "dd8f3ebf_b443e1fc",
      "range": {
        "startLine": 788,
        "startChar": 34,
        "endLine": 788,
        "endChar": 67
      },
      "revId": "bae4e959eedf4b744bbf7f07c3fdba4bdd5d5d12",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bed0492f_7df39485",
        "filename": "fs_mgr/fs_mgr_overlayfs.cpp",
        "patchSetId": 1
      },
      "lineNbr": 788,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2022-06-21T15:48:40Z",
      "side": 1,
      "message": "ah right, thanks for pointing that out, double checking `man mount(2)` shows that MS_MOVE requires the moved mountpoint and parent of moved mountpoint to not be MS_SHARED. This is one of the EINVAL case.",
      "parentUuid": "aa72aff3_2f75942f",
      "range": {
        "startLine": 788,
        "startChar": 34,
        "endLine": 788,
        "endChar": 67
      },
      "revId": "bae4e959eedf4b744bbf7f07c3fdba4bdd5d5d12",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}