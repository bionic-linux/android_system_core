{
  "comments": [
    {
      "key": {
        "uuid": "0aa3d1e7_a6780eec",
        "filename": "libsparse/backed_block.cpp",
        "patchSetId": 3
      },
      "lineNbr": 284,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2020-05-27T23:27:19Z",
      "side": 1,
      "message": "can you factor this out,  so we only have one copy of this loop?\n\n(can it be done as a post-processing phase, so we build everything as normal and then go back and break up too-large chunks? that would minimize disruption to the rest of the code.)",
      "revId": "e9709bfa3cfe0a25866dbb7c6243e6642e6d433f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "14426ad8_6d9908f1",
        "filename": "libsparse/backed_block.cpp",
        "patchSetId": 3
      },
      "lineNbr": 284,
      "author": {
        "id": 1345812
      },
      "writtenOn": "2020-05-28T03:13:15Z",
      "side": 1,
      "message": "Looks like I can move these to main loop of write_all_blocks (https://source.corp.google.com/android/system/core/libsparse/sparse.cpp;l\u003d120?q\u003dwrite_all_blocks\u0026sq\u003dpackage:android), which seems a post-processing phase:\n\n  for (bb \u003d backed_block_iter_new(s-\u003ebacked_block_list); bb; bb \u003d backed_block_iter_next(bb)) {\n    +\n    + split huge backed_block here\n    +\n    if (backed_block_block(bb) \u003e last_block) {\n      unsigned int blocks \u003d backed_block_block(bb) - last_block;\n      write_skip_chunk(out, (int64_t)blocks * s-\u003eblock_size);\n    }\n    ret \u003d sparse_file_write_block(out, bb);\n    if (ret) return ret;\n    last_block \u003d backed_block_block(bb) + DIV_ROUND_UP(backed_block_len(bb), s-\u003eblock_size);\n  }\n\nKindly let me know if there is more feasible option over this.",
      "parentUuid": "0aa3d1e7_a6780eec",
      "revId": "e9709bfa3cfe0a25866dbb7c6243e6642e6d433f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "00058feb_34bd28ce",
        "filename": "libsparse/backed_block.cpp",
        "patchSetId": 3
      },
      "lineNbr": 284,
      "author": {
        "id": 1345812
      },
      "writtenOn": "2020-05-28T05:12:04Z",
      "side": 1,
      "message": "Move to main loop of write_all_blocks and leverage the backed_block_split to split the huge chunk in place.",
      "parentUuid": "14426ad8_6d9908f1",
      "revId": "e9709bfa3cfe0a25866dbb7c6243e6642e6d433f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}