{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "8a4056d7_5cbfa44b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2024-02-07T22:49:25Z",
      "side": 1,
      "message": "this isn\u0027t the right way to do it... take a look at previous changes that added new data to the tombstone (probably easiest to start with the history of system/core/debuggerd/proto/tombstone.proto).",
      "revId": "8bb82880ac9a55aaaa2138e3d8a55d97ff792a83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d6ed5aff_366ec689",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2024-02-09T23:45:01Z",
      "side": 1,
      "message": "oooh - I didn\u0027t realize it got switched to proto (though I should have because I reviewed some of those changes...)\n\nSiim - maybe you can suggest something here as well as help answer how we measure perf overhead here? ðŸ˜„",
      "revId": "8bb82880ac9a55aaaa2138e3d8a55d97ff792a83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "02fa893b_da91e40b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1644679
      },
      "writtenOn": "2024-02-12T20:22:49Z",
      "side": 1,
      "message": "From aosp/1948841, aosp/2025823, and aosp/1612831 it looks like we add a field to `tombstone.proto` which gets filled out in `tombstone_proto.cpp` in `engrave_tombstone_proto`.\n\nBut `engrave_tombstone_proto` never gets called during `adb shell am hang`. Should I be testing the ANR in a different way? Is there some other place I need add this info to in addition to the `engrave_tombstone_proto`?",
      "parentUuid": "8a4056d7_5cbfa44b",
      "revId": "8bb82880ac9a55aaaa2138e3d8a55d97ff792a83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d6a3c357_5b55cdcb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1644679
      },
      "writtenOn": "2024-02-12T21:02:57Z",
      "side": 1,
      "message": "It looks like we could also add text output to `dump_process_header` in `libdebuggerd/backtrace.cpp` for the ANR because `backtrace \u003d\u003d true` [here.](https://source.corp.google.com/h/googleplex-android/platform/superproject/main/+/main:system/core/debuggerd/crash_dump.cpp;drc\u003de8fcfee409a3d23027fefef540155e41f84c98a6;l\u003d652)\n\nBut neither of these cases are hit when `DumpType` is `kDebuggerdJavaBacktrace`. Right now we mostly care about servicemanager, so maybe that\u0027s ok but I\u0027m not sure.",
      "parentUuid": "02fa893b_da91e40b",
      "revId": "8bb82880ac9a55aaaa2138e3d8a55d97ff792a83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "97cfd76d_e62e1431",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2024-02-12T22:38:17Z",
      "side": 1,
      "message": "Can you confirm with Siim? I\u0027m not familiar with this, and it seems he changed things recently.",
      "parentUuid": "d6a3c357_5b55cdcb",
      "revId": "8bb82880ac9a55aaaa2138e3d8a55d97ff792a83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d86a5fcc_d7d3dbcc",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1872107
      },
      "writtenOn": "2024-02-13T16:44:22Z",
      "side": 1,
      "message": "Hey, I\u0027m not actually sure what the best way to measure perf here is, added gaillard@ aswell, maybe he can help",
      "parentUuid": "d6ed5aff_366ec689",
      "revId": "8bb82880ac9a55aaaa2138e3d8a55d97ff792a83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c8a9eebe_1b8df5b6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1337780
      },
      "writtenOn": "2024-02-13T16:49:40Z",
      "side": 1,
      "message": "This is probably the right location for ANRs to write the data for the ART dump and the native dump.\n\nHow big is this data and what does it look like? The data is going to be uploaded for all users as part of the ANR dump.\n\nIs it going to add any latency to the process dump?",
      "parentUuid": "97cfd76d_e62e1431",
      "revId": "8bb82880ac9a55aaaa2138e3d8a55d97ff792a83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "36d5f346_e3830b9b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1644679
      },
      "writtenOn": "2024-02-13T17:01:29Z",
      "side": 1,
      "message": "Thanks Olivier! I\u0027ve got some before/after numbers with a snippet of the data in https://b.corp.google.com/issues/316970771#comment4\n\ntl;dr it increases the size of the ANR file generated with `adb shell am hang` by ~20%. If this is too much, we can reduce it to only what we know we want right now.\n\u003e Is it going to add any latency to the process dump?\n\nYes, it parses the `/dev/binderfs/binder_logs/state` file for each process that we are dumping.\n\nIs there a good way to measure this part to see if it\u0027s acceptable? I can get timestamps and check that way. `debuggerd_benchmark.cpp` seems to be only for debuggerd, not this kind of client call.",
      "parentUuid": "c8a9eebe_1b8df5b6",
      "revId": "8bb82880ac9a55aaaa2138e3d8a55d97ff792a83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2f28601b_7a96f16b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2024-02-13T17:05:38Z",
      "side": 1,
      "message": "is there a reason why you\u0027re trying to put this into debuggerd at all? this seems like something that should be in dumpstate instead?",
      "parentUuid": "36d5f346_e3830b9b",
      "revId": "8bb82880ac9a55aaaa2138e3d8a55d97ff792a83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3e4e4032_f40603b5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1644679
      },
      "writtenOn": "2024-02-13T17:16:57Z",
      "side": 1,
      "message": "Some more context is in the bug in the commit message https://b.corp.google.com/issues/316970771 -\u003e https://b.corp.google.com/issues/315272811#comment3\n\nDuring ANRs we want to know what the binder threads in the interesting processes are to and if there have been any extra long transactions being processed.|",
      "parentUuid": "2f28601b_7a96f16b",
      "revId": "8bb82880ac9a55aaaa2138e3d8a55d97ff792a83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9aceb21a_1d5c306d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2024-02-13T17:28:28Z",
      "side": 1,
      "message": "sure, but why are you trying to shoehorn that into debuggerd, rather than adding that to dumpstate, which would seem more natural? (_especially_ when you\u0027re talking about an extra 20%!)",
      "parentUuid": "3e4e4032_f40603b5",
      "revId": "8bb82880ac9a55aaaa2138e3d8a55d97ff792a83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "38e67af9_1df9d6da",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1644679
      },
      "writtenOn": "2024-02-13T17:33:36Z",
      "side": 1,
      "message": "We want the data when we are getting the backtrace during an ANR.\n\nCan you point me to the more natural location you have in mind to get the data during the ANR? I don\u0027t know how dumpstate is involved in the ANR process.",
      "parentUuid": "9aceb21a_1d5c306d",
      "revId": "8bb82880ac9a55aaaa2138e3d8a55d97ff792a83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2dcdd0aa_46f103a7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1019050
      },
      "writtenOn": "2024-02-13T18:42:28Z",
      "side": 1,
      "message": "ANR data is not generated by debuggerd, it\u0027s generated by ART code. At least the files generated in /data/anr/. Debuggerd generates tombstones, and generates unwind data when asked but not for the process that is ANRing. The unwinds generated for the process that is not happy is generated by ART. If you have an example of the data you want to modify, I can tell you where it\u0027s generated.",
      "parentUuid": "38e67af9_1df9d6da",
      "revId": "8bb82880ac9a55aaaa2138e3d8a55d97ff792a83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f40b9c87_a14fd58a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1644679
      },
      "writtenOn": "2024-02-13T18:55:31Z",
      "side": 1,
      "message": "We are interested in the files generated in `/data/anr/` and show up in APC like b/315272811. Those files don\u0027t currently have enough information to debug the problems with some blocked binder threads and we would like this new binder info for the processes that we are interested in during the ANR.",
      "parentUuid": "2dcdd0aa_46f103a7",
      "revId": "8bb82880ac9a55aaaa2138e3d8a55d97ff792a83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3ab2830d_74c3db5c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2024-02-13T19:17:40Z",
      "side": 1,
      "message": "it\u0027s the \"this is for ANRs, not crashes\" that makes me think you\u0027re in the wrong place... most of the ANR stuff (or bugreport stuff) is not from debuggerd. (a useful \"TL;DR\" is probably \"debuggerd stuff is the stuff that goes to 3p app developers via the Play console\".)\n\ni don\u0027t think there are any dumpstate docs (?), but you can look at the ANR code and frameworks/native/cmds/dumpstate/ --- it basically just runs arbitrary code (or shell commands; that\u0027s often the best way to factor things if your diagnostic is independently useful/interesting).",
      "parentUuid": "38e67af9_1df9d6da",
      "revId": "8bb82880ac9a55aaaa2138e3d8a55d97ff792a83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}