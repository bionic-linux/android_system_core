{
  "comments": [
    {
      "key": {
        "uuid": "ed9fe58f_8e212136",
        "filename": "/COMMIT_MSG",
        "patchSetId": 9
      },
      "lineNbr": 11,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2019-09-11T21:20:59Z",
      "side": 1,
      "message": "nit: s/those/that",
      "revId": "1230343ecacbfc1245ce6b9bc74f8f9c29cb8a46",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "09bbb874_adb13c9c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 9
      },
      "lineNbr": 11,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2019-09-11T23:58:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ed9fe58f_8e212136",
      "revId": "1230343ecacbfc1245ce6b9bc74f8f9c29cb8a46",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5761c0b7_8c65bba9",
        "filename": "/COMMIT_MSG",
        "patchSetId": 9
      },
      "lineNbr": 19,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2019-09-11T21:20:59Z",
      "side": 1,
      "message": "Assuming we never actually need the path for anything (aside from maybe initializing the COW to zero?), device strings should work everywhere.",
      "revId": "1230343ecacbfc1245ce6b9bc74f8f9c29cb8a46",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0642cc36_af7c7d0b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 9
      },
      "lineNbr": 19,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2019-09-11T22:05:17Z",
      "side": 1,
      "message": "Yeah; I want to accentuate that MapCowImage doesn\u0027t fill out both fields (especially it doesn\u0027t give us the major/minor if we call MapDeviceImage)",
      "parentUuid": "5761c0b7_8c65bba9",
      "revId": "1230343ecacbfc1245ce6b9bc74f8f9c29cb8a46",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "defc9dff_b8056bc5",
        "filename": "fs_mgr/libsnapshot/include/libsnapshot/snapshot.h",
        "patchSetId": 9
      },
      "lineNbr": 298,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2019-09-11T21:20:59Z",
      "side": 1,
      "message": "I think we might not need this struct. There are two cases we need a descriptor: (1) as an input to DmTable, and (2) for zeroing the first bytes. In the former case, we can always use DeviceMapper::GetDeviceString. In the latter case, we can always use GetDmDevicePathByName, because the timeout will be non-zero (which guarantees a usable path).\n\nIf this is true, MapCowImage doesn\u0027t even need to return anything, it\u0027d be up to the caller to derive it. (Though I guess it could return the device name for convenience.)",
      "revId": "1230343ecacbfc1245ce6b9bc74f8f9c29cb8a46",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f75e8e1b_92a69147",
        "filename": "fs_mgr/libsnapshot/include/libsnapshot/snapshot.h",
        "patchSetId": 9
      },
      "lineNbr": 298,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2019-09-11T22:05:17Z",
      "side": 1,
      "message": "Good idea. Will do.",
      "parentUuid": "defc9dff_b8056bc5",
      "revId": "1230343ecacbfc1245ce6b9bc74f8f9c29cb8a46",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ffb09ab8_29d935bf",
        "filename": "fs_mgr/libsnapshot/include/libsnapshot/snapshot.h",
        "patchSetId": 9
      },
      "lineNbr": 298,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2019-09-11T23:58:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f75e8e1b_92a69147",
      "revId": "1230343ecacbfc1245ce6b9bc74f8f9c29cb8a46",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "61ef7686_ef845aed",
        "filename": "fs_mgr/libsnapshot/snapshot.cpp",
        "patchSetId": 9
      },
      "lineNbr": 118,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2019-09-11T21:20:59Z",
      "side": 1,
      "message": "bikeshed nit: is there a suffix clearer than \"-lin\"? -pt? -part? no suffix?",
      "revId": "1230343ecacbfc1245ce6b9bc74f8f9c29cb8a46",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "30ae4758_6fa9b46e",
        "filename": "fs_mgr/libsnapshot/snapshot.cpp",
        "patchSetId": 9
      },
      "lineNbr": 118,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2019-09-11T22:05:17Z",
      "side": 1,
      "message": "I can\u0027t do no suffix because it may conflict with the upper level COW device\n\n[       cow       ]\n[cow-lin] [cow-img]\n\nYeah I can\u0027t think of a good name (I took the name from dm-linear). Maybe I\u0027ll use -pt.",
      "parentUuid": "61ef7686_ef845aed",
      "revId": "1230343ecacbfc1245ce6b9bc74f8f9c29cb8a46",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2dfa6a55_fad6a46d",
        "filename": "fs_mgr/libsnapshot/snapshot.cpp",
        "patchSetId": 9
      },
      "lineNbr": 118,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2019-09-11T23:58:49Z",
      "side": 1,
      "message": "I\u0027ve deleted this.",
      "parentUuid": "30ae4758_6fa9b46e",
      "revId": "1230343ecacbfc1245ce6b9bc74f8f9c29cb8a46",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0774ff3e_a0850a96",
        "filename": "fs_mgr/libsnapshot/snapshot.cpp",
        "patchSetId": 9
      },
      "lineNbr": 437,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2019-09-11T21:20:59Z",
      "side": 1,
      "message": "It\u0027s a little confusing to have to delete outer references to the inner device here. Shouldn\u0027t callers of UnmapCowImage have done this already? Do we need to unmap COW components separately, or can there be one UnmapCowDevice method that undoes everything?",
      "revId": "1230343ecacbfc1245ce6b9bc74f8f9c29cb8a46",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bf77a5b2_3908e1a8",
        "filename": "fs_mgr/libsnapshot/snapshot.cpp",
        "patchSetId": 9
      },
      "lineNbr": 437,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2019-09-11T22:05:17Z",
      "side": 1,
      "message": "I agree that this is a bit confusing. Let me create a new UnmapCowDevices function.",
      "parentUuid": "0774ff3e_a0850a96",
      "revId": "1230343ecacbfc1245ce6b9bc74f8f9c29cb8a46",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3771ed77_8b6a4cb2",
        "filename": "fs_mgr/libsnapshot/snapshot.cpp",
        "patchSetId": 9
      },
      "lineNbr": 437,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2019-09-11T23:58:49Z",
      "side": 1,
      "message": "Done, see below.",
      "parentUuid": "bf77a5b2_3908e1a8",
      "revId": "1230343ecacbfc1245ce6b9bc74f8f9c29cb8a46",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "68bf2717_92fc90ff",
        "filename": "fs_mgr/libsnapshot/snapshot.cpp",
        "patchSetId": 9
      },
      "lineNbr": 455,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2019-09-11T21:20:59Z",
      "side": 1,
      "message": "Might as well store the instance in a local variable since it gets used twice. Maybe same for GetCowPartitionDeviceName.\n\nIIUC, the cow partition is never actually removed from the metadata - we have to wait for update_engine to take another OTA? Do we want the \"cow\" group to be volatile when unused? I.e., should adb remount/fastboot flash be able to throw it away when no snapshot or merge is in progress?",
      "revId": "1230343ecacbfc1245ce6b9bc74f8f9c29cb8a46",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ba9ee5af_443af20f",
        "filename": "fs_mgr/libsnapshot/snapshot.cpp",
        "patchSetId": 9
      },
      "lineNbr": 455,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2019-09-11T22:05:17Z",
      "side": 1,
      "message": "\u003e Might as well store the instance in a local variable since it gets used twice. Maybe same for GetCowPartitionDeviceName.\n\nWill do.\n\n\u003e IIUC, the cow partition is never actually removed from the metadata - we have to wait for update_engine to take another OTA? Do we want the \"cow\" group to be volatile when unused? I.e., should adb remount/fastboot flash be able to throw it away when no snapshot or merge is in progress?\n\nFor adb remount, I am planning to use userdata completely.\nfastboot flash should be able to throw it away in any case (since it flashes the original content).",
      "parentUuid": "68bf2717_92fc90ff",
      "revId": "1230343ecacbfc1245ce6b9bc74f8f9c29cb8a46",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a47da26b_3dd8e628",
        "filename": "fs_mgr/libsnapshot/snapshot.cpp",
        "patchSetId": 9
      },
      "lineNbr": 455,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2019-09-11T23:58:49Z",
      "side": 1,
      "message": "Done. PTAL at my comment as well.",
      "parentUuid": "ba9ee5af_443af20f",
      "revId": "1230343ecacbfc1245ce6b9bc74f8f9c29cb8a46",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "955a7c5d_ee028390",
        "filename": "fs_mgr/libsnapshot/snapshot.cpp",
        "patchSetId": 9
      },
      "lineNbr": 1458,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2019-09-11T21:20:59Z",
      "side": 1,
      "message": "With a little refactoring to fs_mgr_dm_linear (to expose the DmTable for a partition), we have another option: have cow-partition include one big extent covering the cow file device. I don\u0027t know if it\u0027s worth it though.",
      "revId": "1230343ecacbfc1245ce6b9bc74f8f9c29cb8a46",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "913b80dd_27a8356d",
        "filename": "fs_mgr/libsnapshot/snapshot.cpp",
        "patchSetId": 9
      },
      "lineNbr": 1458,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2019-09-11T23:58:49Z",
      "side": 1,
      "message": "Done. In fact, since you exposed CreateDmTable, I don\u0027t need any refactoring there.\n\nI could make CreateDmTable to take a CreateLogicalPartitionParams if you want.",
      "parentUuid": "955a7c5d_ee028390",
      "revId": "1230343ecacbfc1245ce6b9bc74f8f9c29cb8a46",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}