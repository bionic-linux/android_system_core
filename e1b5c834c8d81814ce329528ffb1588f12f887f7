{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "e254d96f_2886d51a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1836235
      },
      "writtenOn": "2023-04-11T10:21:51Z",
      "side": 1,
      "message": "Do you remember why this was 4000 in the first place?",
      "revId": "e1b5c834c8d81814ce329528ffb1588f12f887f7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "396e35a3_5a778cd0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1678423
      },
      "writtenOn": "2023-04-12T14:25:28Z",
      "side": 1,
      "message": "When I was implementing the fix for the issue where the messages were dropped if the size was larger than the buffer size, Tri suggested to use 4000 as the payload size as some number of bytes are used for the tipc headers. I do not have any reference to the discussion as it was on 1:1 chat and the history is deleted. Tri, do you remember that discussion and if so, can you please clarify whether leaving 16 bytes for the tipc header (as per this CL) is sufficient?",
      "parentUuid": "e254d96f_2886d51a",
      "revId": "e1b5c834c8d81814ce329528ffb1588f12f887f7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2dc32217_3a32aea6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1836235
      },
      "writtenOn": "2023-04-12T14:27:45Z",
      "side": 1,
      "message": "BTW, I got the 16 byte value from here: https://cs.android.com/android/platform/superproject/+/master:system/core/trusty/keymaster/include/trusty_keymaster/ipc/trusty_keymaster_ipc.h;l\u003d27",
      "parentUuid": "396e35a3_5a778cd0",
      "revId": "e1b5c834c8d81814ce329528ffb1588f12f887f7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bce89faa_4c385e05",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1678423
      },
      "writtenOn": "2023-04-12T14:40:29Z",
      "side": 1,
      "message": "Ok, then it should be correct (as C++ keymint didn\u0027t have such issues).\nAlso, in the above link I noticed C++ keymint was using two different tipc buffer sizes: \n1. `TRUSTY_KEYMASTER_RECV_BUF_SIZE` (2 * PAGE_SIZE) and \n2. `TRUSTY_KEYMASTER_SEND_BUF_SIZE` (PAGE_SIZE - sizeof(struct keymaster_message) - 16 /* tipc header */)\n\nI wonder what is the reason for the significant difference between the two numbers (2*page size vs ~page size)",
      "parentUuid": "2dc32217_3a32aea6",
      "revId": "e1b5c834c8d81814ce329528ffb1588f12f887f7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a1028d5e_a8b03e62",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1124693
      },
      "writtenOn": "2023-04-12T17:22:39Z",
      "side": 1,
      "message": "TIPC message header size isn\u0027t advertised anywhere. So max TIPC message size is ill defined. IIRC 4000 was cargo culted from somewhere else.",
      "parentUuid": "bce89faa_4c385e05",
      "revId": "e1b5c834c8d81814ce329528ffb1588f12f887f7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c1a27b66_813fedc0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1678423
      },
      "writtenOn": "2023-04-12T23:56:11Z",
      "side": 1,
      "message": "Thanks for clarifying. Since C++ keymint has used the header size as 16 bytes without issue, I think that the change in this CL is fine.\n\nI think this CL needs to be accompanied by another similar change in\nipc_manager.rs in trusty keymint ta, because we define the same constant (`KEYMINT_MAX_MESSAGE_CONTENT_SIZE`) there as well.",
      "parentUuid": "a1028d5e_a8b03e62",
      "revId": "e1b5c834c8d81814ce329528ffb1588f12f887f7",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}