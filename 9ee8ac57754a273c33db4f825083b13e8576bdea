{
  "comments": [
    {
      "key": {
        "uuid": "761c3aa5_66dc776b",
        "filename": "fs_mgr/libdm/dm.cpp",
        "patchSetId": 1
      },
      "lineNbr": 541,
      "author": {
        "id": 1013030
      },
      "writtenOn": "2019-12-03T14:55:46Z",
      "side": 1,
      "message": "as discussed, may break for dm devices that have two or more slaves (eg dm-verity with a different device for data and hash)...but, this may not be of concern for now?",
      "range": {
        "startLine": 538,
        "startChar": 8,
        "endLine": 541,
        "endChar": 9
      },
      "revId": "9ee8ac57754a273c33db4f825083b13e8576bdea",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cdd5e2c4_e9c172cd",
        "filename": "fs_mgr/libdm/dm.cpp",
        "patchSetId": 1
      },
      "lineNbr": 541,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2019-12-03T19:36:41Z",
      "side": 1,
      "message": "For all current use cases, it would be an error to have more than one underlying block device. So it\u0027s probably fine for now.",
      "parentUuid": "761c3aa5_66dc776b",
      "range": {
        "startLine": 538,
        "startChar": 8,
        "endLine": 541,
        "endChar": 9
      },
      "revId": "9ee8ac57754a273c33db4f825083b13e8576bdea",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8752bdc2_cdb568ed",
        "filename": "fs_mgr/libdm/dm.cpp",
        "patchSetId": 1
      },
      "lineNbr": 541,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2019-12-04T12:24:01Z",
      "side": 1,
      "message": "Ack. Will keep it simple for the time being, if needed we can always extend the API to iterate over the dm-stack via DFS or BFS.",
      "parentUuid": "cdd5e2c4_e9c172cd",
      "range": {
        "startLine": 538,
        "startChar": 8,
        "endLine": 541,
        "endChar": 9
      },
      "revId": "9ee8ac57754a273c33db4f825083b13e8576bdea",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7cdd7f79_796991b6",
        "filename": "fs_mgr/libdm/dm.cpp",
        "patchSetId": 1
      },
      "lineNbr": 541,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2019-12-04T19:24:15Z",
      "side": 1,
      "message": "blueline:/sys/block/dm-0 # ls slaves\nsda10 sda6 \n\nI wonder why that\u0027s happening here already.\n\nDoes this work for multiple levels of block devices right now, e.g. /vendor is mounted on  vendor_verity (dm-verity) -\u003e vendor_b (dm-linear) -\u003e sdaXX ?  We would need to loop here and I don\u0027t see that.\n\nIf we do add the loop, it shouldn\u0027t be that difficult to have it done for the multiple slave case as well; we\u0027d just need to add each entry into a vector.",
      "parentUuid": "8752bdc2_cdb568ed",
      "range": {
        "startLine": 538,
        "startChar": 8,
        "endLine": 541,
        "endChar": 9
      },
      "revId": "9ee8ac57754a273c33db4f825083b13e8576bdea",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "659f81ab_53c503f5",
        "filename": "fs_mgr/libdm/dm.cpp",
        "patchSetId": 1
      },
      "lineNbr": 541,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2019-12-04T21:37:39Z",
      "side": 1,
      "message": "It\u0027s a bit more flexible to have callers do the loop, because then we can validate tables along the way. But maybe there should be a helper that just goes right to the bottom of the stack.",
      "parentUuid": "7cdd7f79_796991b6",
      "range": {
        "startLine": 538,
        "startChar": 8,
        "endLine": 541,
        "endChar": 9
      },
      "revId": "9ee8ac57754a273c33db4f825083b13e8576bdea",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3948c474_c947428d",
        "filename": "fs_mgr/libdm/dm.cpp",
        "patchSetId": 1
      },
      "lineNbr": 541,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2019-12-04T21:45:36Z",
      "side": 1,
      "message": "Ack.  The name of this function implies to me that it does the loop and goes to the bottom of the stack though.  I think I remember that that\u0027s what Nikita actually needs for his use too, so I was surprised to see it not loop.  Maybe we call this GetParentBlockDeviceByPath() and have a separate GetUnderlyingBlockDeviceByPath() that does the loop?\n\nThat\u0027s assuming that we think parent means direct parent, which I think is fair.  I\u0027m a bit iffier on \u0027underlying\u0027 implying \u0027bottom of the stack\u0027.  I\u0027m happy with it if you think it\u0027s clear but also open to another term.",
      "parentUuid": "659f81ab_53c503f5",
      "range": {
        "startLine": 538,
        "startChar": 8,
        "endLine": 541,
        "endChar": 9
      },
      "revId": "9ee8ac57754a273c33db4f825083b13e8576bdea",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3c1ef8c2_f47b4505",
        "filename": "fs_mgr/libdm/dm.cpp",
        "patchSetId": 1
      },
      "lineNbr": 541,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2019-12-04T22:01:35Z",
      "side": 1,
      "message": "+1 to GetParentBlockDeviceByPath\n\nFor the bottom of the stack, maybe s/Underlying/Root or s/Underlying/Bottom?",
      "parentUuid": "3948c474_c947428d",
      "range": {
        "startLine": 538,
        "startChar": 8,
        "endLine": 541,
        "endChar": 9
      },
      "revId": "9ee8ac57754a273c33db4f825083b13e8576bdea",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "864f45e0_5543c433",
        "filename": "fs_mgr/libdm/dm.cpp",
        "patchSetId": 1
      },
      "lineNbr": 541,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2019-12-04T22:49:12Z",
      "side": 1,
      "message": "Maybe.  I\u0027m struggling with all of those options.  Checking synonyms for bottom gives me \u0027BottomMost\u0027 which maybe is better?  It\u0027s just not a particularly common word.",
      "parentUuid": "3c1ef8c2_f47b4505",
      "range": {
        "startLine": 538,
        "startChar": 8,
        "endLine": 541,
        "endChar": 9
      },
      "revId": "9ee8ac57754a273c33db4f825083b13e8576bdea",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "673efa0e_e284513b",
        "filename": "fs_mgr/libdm/dm.cpp",
        "patchSetId": 1
      },
      "lineNbr": 541,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2019-12-05T13:51:29Z",
      "side": 1,
      "message": "My idea was that it\u0027s a matter of caller to write a for loop in case it wants to get to the bottom of the dm-stack.\n\nBTW, one of the reasons for introducing this API in libdm was to remove same logic from the libfstab (see comment from David in aosp/1172114), but I\u0027ve realized that libfstab is vendor_available while libdm is not.\n\nShould this API be moved to a separate vendor_available library with stable interface? Or is it fine to make libdm vendor_available static lib? (AFAIU it can\u0027t be shared lib because it doesn\u0027t have a stable interface)",
      "parentUuid": "864f45e0_5543c433",
      "range": {
        "startLine": 538,
        "startChar": 8,
        "endLine": 541,
        "endChar": 9
      },
      "revId": "9ee8ac57754a273c33db4f825083b13e8576bdea",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "af4caaf2_55eff9b3",
        "filename": "fs_mgr/libdm/dm.cpp",
        "patchSetId": 1
      },
      "lineNbr": 541,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2019-12-05T17:18:04Z",
      "side": 1,
      "message": "Ack; my confusion then; for some reason I thought underlying would mean bottom of stack, but if I\u0027m the only one confused here then certainly, let\u0027s leave it as is.\n\nI don\u0027t have a good answer for the vendor API aspect.  I don\u0027t like making a new library just for this one function nor making libraries vendor_available if not strictly needed.",
      "parentUuid": "673efa0e_e284513b",
      "range": {
        "startLine": 538,
        "startChar": 8,
        "endLine": 541,
        "endChar": 9
      },
      "revId": "9ee8ac57754a273c33db4f825083b13e8576bdea",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "62196bbc_f21a3828",
        "filename": "fs_mgr/libdm/dm.cpp",
        "patchSetId": 1
      },
      "lineNbr": 541,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2019-12-06T15:01:43Z",
      "side": 1,
      "message": "Renamed to GetParentBlockDeviceByPath. Since this API will be used in couple of places in fs_mgr, what do you think about leaving it in libdm for the time being? And later we can decide whenever there is a better place to host this api, or if it\u0027s fine to make libdm vendor_available.",
      "parentUuid": "af4caaf2_55eff9b3",
      "range": {
        "startLine": 538,
        "startChar": 8,
        "endLine": 541,
        "endChar": 9
      },
      "revId": "9ee8ac57754a273c33db4f825083b13e8576bdea",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "627dee7a_cd548a33",
        "filename": "fs_mgr/libdm/include/libdm/dm.h",
        "patchSetId": 1
      },
      "lineNbr": 214,
      "author": {
        "id": 1013030
      },
      "writtenOn": "2019-12-03T14:55:46Z",
      "side": 1,
      "message": "presumably this is used, too?",
      "range": {
        "startLine": 214,
        "startChar": 9,
        "endLine": 214,
        "endChar": 24
      },
      "revId": "9ee8ac57754a273c33db4f825083b13e8576bdea",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "47bf81cb_b38bb777",
        "filename": "fs_mgr/libdm/include/libdm/dm.h",
        "patchSetId": 1
      },
      "lineNbr": 214,
      "author": {
        "id": 1432579
      },
      "writtenOn": "2019-12-06T15:01:43Z",
      "side": 1,
      "message": "Yes, this will be used by callers to check whenever they can go deeper into the stack.",
      "parentUuid": "627dee7a_cd548a33",
      "range": {
        "startLine": 214,
        "startChar": 9,
        "endLine": 214,
        "endChar": 24
      },
      "revId": "9ee8ac57754a273c33db4f825083b13e8576bdea",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}