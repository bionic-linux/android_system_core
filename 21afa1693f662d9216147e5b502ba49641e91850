{
  "comments": [
    {
      "key": {
        "uuid": "d4e0a813_3740505e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2018-10-11T21:00:38Z",
      "side": 1,
      "message": "overlayfs is a new feature.  It\u0027s not unreasonable to require that / or /system are in the fstab at this point and not mount the overlay on /system if it isn\u0027t.  That\u0027s the safe fallback.",
      "revId": "21afa1693f662d9216147e5b502ba49641e91850",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d3e3209a_695e25b6",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2018-10-11T21:40:59Z",
      "side": 1,
      "message": "If dt_table had /, we may get \u0027sick\u0027 ... as it already is mounted ...\n\nWe do an overlayfs for /system for /. overlayfs does not provide coverage of any files/dirs in the root directory because if _one_ overlayfs was landed overtop /, it would take _everything_ (ueventd -\u003e /dev/ for example, writes to /proc or /sys etc).\n\nFor system as root, this is the point where we have to manufacture the entry.",
      "parentUuid": "d4e0a813_3740505e",
      "revId": "21afa1693f662d9216147e5b502ba49641e91850",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2a53ef3b_64c1f227",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2018-10-11T21:50:51Z",
      "side": 1,
      "message": "But we will have it in the fstab on vendor.  Instead of faking it, why not just load that fstab and grab it from there?",
      "parentUuid": "d3e3209a_695e25b6",
      "revId": "21afa1693f662d9216147e5b502ba49641e91850",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6c262576_404e555f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2018-10-11T22:07:37Z",
      "side": 1,
      "message": "The thought did occur to me. And yes I prototypes that once and did not like how it shaped.\n\nHowever, I wanted to respect the fstab supplied, save for the small problem that the missing \u0027/\u0027 entry was causing on the system as root devices. A change to only focus on the fstab supplied solved a whole series of other problems (when the fs_mgr_fstab_default() contained entries that were not to be mounted) and thus made the logic of when to overlay and when not to overlay very complicated. So we only enumerate the fstab supplied.\n\n(one of the problems was /product_services would get an overlay _before_ product_services mounted in mount_all --early; /mnt/vendor/firmware would also create a conundrum etc).\n\nIf I play games with supplied fstab and fs_mgr_fstab_default() to pick up \u0027/\u0027 if missing in the supplied fstab, it just gets uglier than if it doesn\u0027t have system (/system or /) and we just add the string if not in verified state.",
      "parentUuid": "2a53ef3b_64c1f227",
      "revId": "21afa1693f662d9216147e5b502ba49641e91850",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bc35f97e_deb0a4a9",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2018-10-11T22:13:31Z",
      "side": 1,
      "message": "I guess moral of the story is we do need to just copy the full fstab in both locations then all this pain goes away, right?",
      "parentUuid": "6c262576_404e555f",
      "revId": "21afa1693f662d9216147e5b502ba49641e91850",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5d97658a_2bfa3359",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2018-10-12T19:51:07Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "bc35f97e_deb0a4a9",
      "revId": "21afa1693f662d9216147e5b502ba49641e91850",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f8e26294_2fb61067",
        "filename": "fs_mgr/fs_mgr_overlayfs.cpp",
        "patchSetId": 1
      },
      "lineNbr": 549,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2018-10-11T21:00:38Z",
      "side": 1,
      "message": "Actually reading this code/comment now: shouldn\u0027t this be \u0027\u003d\u003d\u0027 ?  As in if \u0027system\u0027 isn\u0027t found in the list of verity partitions, return?",
      "range": {
        "startLine": 549,
        "startChar": 58,
        "endLine": 549,
        "endChar": 60
      },
      "revId": "21afa1693f662d9216147e5b502ba49641e91850",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cf77ce98_4b61234f",
        "filename": "fs_mgr/fs_mgr_overlayfs.cpp",
        "patchSetId": 1
      },
      "lineNbr": 549,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2018-10-11T21:40:59Z",
      "side": 1,
      "message": "If \"system\" is found in verity, then we do not overlayfs it. Basically one can only do adb remount on a system that has already gotten adb disable-verity. See line 522 through 525, same operation, just on a manufactured \"system\".",
      "parentUuid": "f8e26294_2fb61067",
      "range": {
        "startLine": 549,
        "startChar": 58,
        "endLine": 549,
        "endChar": 60
      },
      "revId": "21afa1693f662d9216147e5b502ba49641e91850",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b06820d8_c1e57744",
        "filename": "fs_mgr/fs_mgr_overlayfs.cpp",
        "patchSetId": 1
      },
      "lineNbr": 549,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2018-10-11T21:50:51Z",
      "side": 1,
      "message": "Right, nevermind me.",
      "parentUuid": "cf77ce98_4b61234f",
      "range": {
        "startLine": 549,
        "startChar": 58,
        "endLine": 549,
        "endChar": 60
      },
      "revId": "21afa1693f662d9216147e5b502ba49641e91850",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b42b6ecd_bdba347a",
        "filename": "fs_mgr/fs_mgr_overlayfs.cpp",
        "patchSetId": 1
      },
      "lineNbr": 549,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2018-10-11T22:07:37Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b06820d8_c1e57744",
      "range": {
        "startLine": 549,
        "startChar": 58,
        "endLine": 549,
        "endChar": 60
      },
      "revId": "21afa1693f662d9216147e5b502ba49641e91850",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}