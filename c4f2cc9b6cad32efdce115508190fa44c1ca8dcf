{
  "comments": [
    {
      "key": {
        "uuid": "f5411957_5aad7290",
        "filename": "init/property_service.cpp",
        "patchSetId": 3
      },
      "lineNbr": 262,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2017-06-13T00:41:33Z",
      "side": 1,
      "message": "This would still need to be after the fork() otherwise, we\u0027re liable to hit the same problem that this CL is trying to fix if there are two selinux.restorecon_recursive properties set back to back.\n\nIt\u0027d be better with condition variables or some other signaling mechanism too instead of the busy wait.",
      "range": {
        "startLine": 260,
        "startChar": 0,
        "endLine": 262,
        "endChar": 5
      },
      "revId": "c4f2cc9b6cad32efdce115508190fa44c1ca8dcf",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6c9537cc_a1cc11ed",
        "filename": "init/property_service.cpp",
        "patchSetId": 3
      },
      "lineNbr": 262,
      "author": {
        "id": 1037023
      },
      "writtenOn": "2017-06-13T02:27:43Z",
      "side": 1,
      "message": "Oh, right, I wasn\u0027t paying attention to the signal model of init.  This won\u0027t work properly because init uses a signal pipe.\n\n(I was counting on the SIGCHLD handler calling property_child_reaped() and then kicking us out of pause(), which won\u0027t work with a signal pipe)",
      "parentUuid": "f5411957_5aad7290",
      "range": {
        "startLine": 260,
        "startChar": 0,
        "endLine": 262,
        "endChar": 5
      },
      "revId": "c4f2cc9b6cad32efdce115508190fa44c1ca8dcf",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fc73d8cc_65ef424e",
        "filename": "init/property_service.cpp",
        "patchSetId": 3
      },
      "lineNbr": 262,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2017-06-14T00:34:23Z",
      "side": 1,
      "message": "That still wouldn\u0027t solve the issue.  \n\nIf you do:\n\nsetprop selinux.restorecon_recursive /mnt/sdcard1\nsetprop selinux.restorecon_recursive /mnt/sdcard2\n\nWith no delay on the caller side, and assuming that each of those restorecons takes a long time (like the ones that cause the bug we\u0027re trying to fix), there will be an issue.  The second call will block in this while loop until the first finishes, causing the same bad behavior that a single restorecon_recursive call does now.\n\nI\u0027m off tomorrow, but I have some ideas that I\u0027ll push on Thursday for handling this.",
      "parentUuid": "6c9537cc_a1cc11ed",
      "range": {
        "startLine": 260,
        "startChar": 0,
        "endLine": 262,
        "endChar": 5
      },
      "revId": "c4f2cc9b6cad32efdce115508190fa44c1ca8dcf",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}