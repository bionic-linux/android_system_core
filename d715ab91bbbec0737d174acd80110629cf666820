{
  "comments": [
    {
      "key": {
        "uuid": "194fc37f_25568e9a",
        "filename": "init/init_parser.c",
        "patchSetId": 1
      },
      "lineNbr": 662,
      "author": {
        "id": 1002751
      },
      "writtenOn": "2014-03-28T18:05:19Z",
      "side": 1,
      "message": "This will cause every argument to every service to be in memory twice, which doesn\u0027t seem necessary.  Can you find a way to use the original copy if there were no properties in it?  It will probably be ugly, since you can\u0027t free args[i].",
      "revId": "d715ab91bbbec0737d174acd80110629cf666820",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f904af03_85b2e879",
        "filename": "init/init_parser.c",
        "patchSetId": 1
      },
      "lineNbr": 662,
      "author": {
        "id": 1014443
      },
      "writtenOn": "2014-03-28T18:14:03Z",
      "side": 1,
      "message": "If you\u0027re ok with ugliness, then yes it\u0027s definitely possible. I\u0027ll change this.\n\nThere\u0027s also a performance (not memory) optimization I have in mind for expand_props for the case where there isn\u0027t an expansion. I\u0027ll apply that too.",
      "parentUuid": "194fc37f_25568e9a",
      "revId": "d715ab91bbbec0737d174acd80110629cf666820",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f94bcf71_242fb20c",
        "filename": "rootdir/init.rc",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1003723
      },
      "writtenOn": "2014-03-28T18:20:24Z",
      "side": 1,
      "message": "i figured we just have different imports for the different static configuration choices.",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 9,
        "endChar": 30
      },
      "revId": "d715ab91bbbec0737d174acd80110629cf666820",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "19f8a337_26655c2a",
        "filename": "rootdir/init.rc",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1014443
      },
      "writtenOn": "2014-03-28T18:25:17Z",
      "side": 1,
      "message": "You can\u0027t \"override\" default rules with this mechanism so while it\u0027s still possible to to use it, we\u0027ll need to add zygote rules to each init.${ro.hardware}.rc file\n\nWe\u0027ll also need to add a few additional hacks to support testing with 64 only or 32 only if we go down that path.",
      "parentUuid": "f94bcf71_242fb20c",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 9,
        "endChar": 30
      },
      "revId": "d715ab91bbbec0737d174acd80110629cf666820",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d948cb7a_03ef0e6b",
        "filename": "rootdir/init.rc",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1003723
      },
      "writtenOn": "2014-03-28T18:33:12Z",
      "side": 1,
      "message": "sorry, I didn\u0027t mean to use ro.hardware to switch, just this pattern. so for example\n\nimport /init.${ro.zygote}.rc\n\nto select between  /init.zygote32.rc,  /init.zygote64.rc, and possible ones with lazy vs non-lazy secondary startup.",
      "parentUuid": "19f8a337_26655c2a",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 9,
        "endChar": 30
      },
      "revId": "d715ab91bbbec0737d174acd80110629cf666820",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f94bcf71_c7ad8080",
        "filename": "rootdir/init.rc",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1002751
      },
      "writtenOn": "2014-03-28T19:19:53Z",
      "side": 1,
      "message": "It would be nice to keep everything centralized, and not have to edit 4 different zygote rc files to change things, but I\u0027m fine with either.",
      "parentUuid": "d948cb7a_03ef0e6b",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 9,
        "endChar": 30
      },
      "revId": "d715ab91bbbec0737d174acd80110629cf666820",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f904af03_65723cfc",
        "filename": "rootdir/init.rc",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1014443
      },
      "writtenOn": "2014-03-28T21:18:22Z",
      "side": 1,
      "message": "I think Brian\u0027s approach sounds like a good idea.\n\nAfter our discussion yesterday, I started this change with the thought that centralized is better, but at that point I wasn\u0027t aware this would need parser changes. Also, Brian\u0027s suggestion gives us a bit more flexibility with respect to passing different command line arguments to 32 an 64 bit zygote etc.",
      "parentUuid": "f94bcf71_c7ad8080",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 9,
        "endChar": 30
      },
      "revId": "d715ab91bbbec0737d174acd80110629cf666820",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "194fc37f_055b92c0",
        "filename": "rootdir/init.rc",
        "patchSetId": 1
      },
      "lineNbr": 503,
      "author": {
        "id": 1002751
      },
      "writtenOn": "2014-03-28T18:05:19Z",
      "side": 1,
      "message": "What do you expect extra_args to be used for?",
      "range": {
        "startLine": 503,
        "startChar": 88,
        "endLine": 503,
        "endChar": 111
      },
      "revId": "d715ab91bbbec0737d174acd80110629cf666820",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f904af03_45bce04b",
        "filename": "rootdir/init.rc",
        "patchSetId": 1
      },
      "lineNbr": 503,
      "author": {
        "id": 1014443
      },
      "writtenOn": "2014-03-28T18:14:03Z",
      "side": 1,
      "message": "There are at least two things I have in mind :\n\n(i) --start_secondary : exec the secondary zygote as soon as the primary is started.\n(ii) (?) --zygote_abi\u003dabi : Unless there\u0027s a clean way for the zygote to determine what ABI it\u0027s using, it has to be told. That way, the ActivityManager can just say \"startProcess with String abi\u003d\"abi\" and the right zygote will start it.\n\nSo, (i) can be replaced by a system property, and so can (ii) .\n\nIn fact, if we want to be less general, we can assume there will be a maximum of two zygotes and one of them *must* be 64 bits and the other *must be 32*. Then the ActivityManager can say \"startProcess boolean is64\u003dfalse\" on it\u0027s zygote connection.\n\nDepends on how flexible we want to be, and how strong our aversion for additional arguments like this is.",
      "parentUuid": "194fc37f_055b92c0",
      "range": {
        "startLine": 503,
        "startChar": 88,
        "endLine": 503,
        "endChar": 111
      },
      "revId": "d715ab91bbbec0737d174acd80110629cf666820",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "194fc37f_e8edeba0",
        "filename": "rootdir/init.rc",
        "patchSetId": 1
      },
      "lineNbr": 503,
      "author": {
        "id": 1002751
      },
      "writtenOn": "2014-03-28T19:19:53Z",
      "side": 1,
      "message": "That seems like fairly high level policy to cram through init.rc.  Can Zygote just read the properties directly?  Maybe also supporting command line arguments for debugging?",
      "parentUuid": "f904af03_45bce04b",
      "range": {
        "startLine": 503,
        "startChar": 88,
        "endLine": 503,
        "endChar": 111
      },
      "revId": "d715ab91bbbec0737d174acd80110629cf666820",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f904af03_4567403c",
        "filename": "rootdir/init.rc",
        "patchSetId": 1
      },
      "lineNbr": 503,
      "author": {
        "id": 1014443
      },
      "writtenOn": "2014-03-28T21:18:22Z",
      "side": 1,
      "message": "Zygote could read them directly, but we need slightly different behaviour in process launched by init from those started directly from the command line (some of that can be expressed by doing different things in ZygoteInit.java / RuntimeInit.java but it might get messy).",
      "parentUuid": "194fc37f_e8edeba0",
      "range": {
        "startLine": 503,
        "startChar": 88,
        "endLine": 503,
        "endChar": 111
      },
      "revId": "d715ab91bbbec0737d174acd80110629cf666820",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "99157331_889e7f09",
        "filename": "rootdir/init.rc",
        "patchSetId": 1
      },
      "lineNbr": 503,
      "author": {
        "id": 1003723
      },
      "writtenOn": "2014-03-28T21:27:02Z",
      "side": 1,
      "message": "I\u0027m thinking that two files might be enough. I\u0027m not following why the rest can\u0027t be done with system properties inside app_process (since it can be conditional on the --zygote argument)",
      "parentUuid": "f904af03_4567403c",
      "range": {
        "startLine": 503,
        "startChar": 88,
        "endLine": 503,
        "endChar": 111
      },
      "revId": "d715ab91bbbec0737d174acd80110629cf666820",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f904af03_05813870",
        "filename": "rootdir/init.rc",
        "patchSetId": 1
      },
      "lineNbr": 503,
      "author": {
        "id": 1014443
      },
      "writtenOn": "2014-03-28T21:39:32Z",
      "side": 1,
      "message": "Just to be clear, you\u0027re imagining two files whose only difference is the zygote argument ? and you\u0027re saying things like --start_secondary and --abi are expressed as system_properties ? \n\nI guess I have a bit of a google3 mindset here. With this change (and with other command line based argument schemes) I liked the fact that all config switches the zygote needed were provided up front. There are already too many layers of things influencing behaviour (see some of the other changes I sent today to sort that out).\n\nAnyway, I don\u0027t think looking at properties makes things any worse so \u003cshrug\u003e so be it.",
      "parentUuid": "99157331_889e7f09",
      "range": {
        "startLine": 503,
        "startChar": 88,
        "endLine": 503,
        "endChar": 111
      },
      "revId": "d715ab91bbbec0737d174acd80110629cf666820",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "99157331_087b8f03",
        "filename": "rootdir/init.rc",
        "patchSetId": 1
      },
      "lineNbr": 503,
      "author": {
        "id": 1003723
      },
      "writtenOn": "2014-03-28T21:42:47Z",
      "side": 1,
      "message": "right. given that all sorts of things are set via properities, the main place I look is AndroidRuntime\n\nI do agree in general. all of those properties are communicated to libdvm/libart via command line switches effectively (via JNI_CreateJavaVM) but for the rest of the Android world I just try to follow their patterns.",
      "parentUuid": "f904af03_05813870",
      "range": {
        "startLine": 503,
        "startChar": 88,
        "endLine": 503,
        "endChar": 111
      },
      "revId": "d715ab91bbbec0737d174acd80110629cf666820",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "19f8a337_5134a4f4",
        "filename": "rootdir/init.rc",
        "patchSetId": 1
      },
      "lineNbr": 503,
      "author": {
        "id": 1014443
      },
      "writtenOn": "2014-03-28T21:45:03Z",
      "side": 1,
      "message": "SGTM.",
      "parentUuid": "99157331_087b8f03",
      "range": {
        "startLine": 503,
        "startChar": 88,
        "endLine": 503,
        "endChar": 111
      },
      "revId": "d715ab91bbbec0737d174acd80110629cf666820",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}