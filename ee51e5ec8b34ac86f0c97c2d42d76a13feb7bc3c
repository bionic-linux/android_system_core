{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "d45b89d9_e3dd4bb2",
        "filename": "fs_mgr/fs_mgr.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1864,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2021-10-27T18:56:07Z",
      "side": 1,
      "message": "Would it make more sense to instead do this?\n\n    if (android::base::StartsWith(*name, \"userdata_gsi\")) {\n        break;\n    }\n\nI think that as soon as we skip deleting a device, the rest of the stack cannot be deleted.\n\n(Alternately, we could factor this into a separate function, and check IsGsiRunning before calling it.)",
      "revId": "ee51e5ec8b34ac86f0c97c2d42d76a13feb7bc3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "72a0c0d2_7e4bbffa",
        "filename": "fs_mgr/fs_mgr.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1864,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-10-28T09:11:31Z",
      "side": 1,
      "message": "can\u0027t this `StartWith(...)` be just `*name \u003d\u003d \"userdata_gsi\"`?",
      "parentUuid": "d45b89d9_e3dd4bb2",
      "revId": "ee51e5ec8b34ac86f0c97c2d42d76a13feb7bc3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b87d83da_6ca68c6c",
        "filename": "fs_mgr/fs_mgr.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1864,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-10-28T09:21:26Z",
      "side": 1,
      "message": "To David, should this be handled similar to https://source.corp.google.com/android/system/core/fs_mgr/fs_mgr.cpp;l\u003d1774;bpv\u003d0;bpt\u003d1;rcl\u003dHEAD\n\nWe should unwind \u0026 delete the dm-stack until we see the device of \u0027/data\u0027 fstab entry, and if the entry is logical then we don\u0027t delete the /data dm device (ths is the case of userdata_gsi), else we delete the /data dm device because it is backed by physical partition and its dm-node would be recreated later.",
      "parentUuid": "72a0c0d2_7e4bbffa",
      "revId": "ee51e5ec8b34ac86f0c97c2d42d76a13feb7bc3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bd75f6f7_2588931a",
        "filename": "fs_mgr/fs_mgr.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1864,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2021-10-28T16:41:29Z",
      "side": 1,
      "message": "Yeah, that would work as well. I assume here it\u0027s trying to clean up everything intermediate.",
      "parentUuid": "b87d83da_6ca68c6c",
      "revId": "ee51e5ec8b34ac86f0c97c2d42d76a13feb7bc3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "af5af02c_197b34f9",
        "filename": "fs_mgr/fs_mgr.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1864,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-10-29T11:52:08Z",
      "side": 1,
      "message": "So i *guess* this would work:\n\n```\nif (block_device \u003d\u003d fstab_entry.blk_device) {\n  break;\n}\n```\n\nProblem is I cannot verify this locally, I just cannot seem to make a device hit the problematic codes. The `fs_mgr_unmount_all_data_mounts()` as L1852 always fails because the /data block device failed to umount() due to some process still accessing it. I;ve left a comment on bug to see if we can just skip the failing test case",
      "parentUuid": "bd75f6f7_2588931a",
      "revId": "ee51e5ec8b34ac86f0c97c2d42d76a13feb7bc3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e4151fca_a111828f",
        "filename": "fs_mgr/fs_mgr.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1864,
      "author": {
        "id": 1584563
      },
      "writtenOn": "2021-11-08T11:17:52Z",
      "side": 1,
      "message": "1) Updated the patchset with IsGsiRunning check\n2) Added *name \u003d\u003d \"userdata_gsi\" in updated patchset\n3) We are evaluating how to unwind and delete the /data dm-device stack. We are trying to find out the logic to identify physical and logical dm-device",
      "parentUuid": "af5af02c_197b34f9",
      "revId": "ee51e5ec8b34ac86f0c97c2d42d76a13feb7bc3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}