{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "ed70482b_a75d3bd1",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2021-01-11T17:44:15Z",
      "side": 1,
      "message": "I don\u0027t see how granting write to root solves this problem. EntropyMixer runs in the SystemServer which runs as AID_SYSTEM, not AID_ROOT.",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 42
      },
      "revId": "dda3ab1afa40926a0d9ee63bb078b11c51fd0c35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8c71e946_a5871a61",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1830587
      },
      "writtenOn": "2021-01-12T14:14:54Z",
      "side": 1,
      "message": "Exception\n| EntropyMixer:  at libcore.io.IoBridge.open(IoBridge.java:496)\n\nshould be code line \nhttps://android.googlesource.com/platform/libcore/+/master/luni/src/main/java/libcore/io/IoBridge.java\n\n| Libcore.os.open(path, flags, 0666);\n\nAccording to open(2) man\nmy best guess is that flags include O_CREAT and/or O_TMPFILE which trigger kernel to use/apply mode/umask \u00270666\u0027 which fail against existing /dev/hw_random 0440 mode",
      "revId": "dda3ab1afa40926a0d9ee63bb078b11c51fd0c35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "58821d02_a8c74bd0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1319385
      },
      "writtenOn": "2021-01-30T05:19:50Z",
      "side": 1,
      "message": "This warning is actually caused by mis-configured ueventd on device, as I described 3 years ago. This is not fixed on newest Pixels as well, maybe you all can see that warning on boot:\n\nhttps://android-review.googlesource.com/c/device/google/wahoo/+/741043",
      "revId": "dda3ab1afa40926a0d9ee63bb078b11c51fd0c35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5ee04a52_f6f770e2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1319385
      },
      "writtenOn": "2021-01-30T05:26:03Z",
      "side": 1,
      "message": "Considered that EntropyMixer is very old code and no one has touched it for 4 years, would it be good to revert the commit that causes the issue(https://cs.android.com/android/_/android/platform/frameworks/base/+/6ab3d20d3c2de01a342450d83103e9f5e89e670e)?",
      "revId": "dda3ab1afa40926a0d9ee63bb078b11c51fd0c35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5c8b6f1a_48e0bfce",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2021-02-01T19:58:19Z",
      "side": 1,
      "message": "i\u0027m seeing this on my Pixel 4 5G running a dogfood build from last week:\n```\n02-01 11:09:36.832  2073  2287 W EntropyMixer: Failed to add HW RNG output to entropy pool\n02-01 11:09:36.832  2073  2287 W EntropyMixer: java.io.FileNotFoundException: /dev/hw_random: open failed: EACCES (Permission denied)\n02-01 11:09:36.832  2073  2287 W EntropyMixer: \tat libcore.io.IoBridge.open(IoBridge.java:499)\n02-01 11:09:36.832  2073  2287 W EntropyMixer: \tat java.io.FileInputStream.\u003cinit\u003e(FileInputStream.java:160)\n02-01 11:09:36.832  2073  2287 W EntropyMixer: \tat java.io.FileInputStream.\u003cinit\u003e(FileInputStream.java:115)\n02-01 11:09:36.832  2073  2287 W EntropyMixer: \tat com.android.server.RandomBlock.fromFile(RandomBlock.java:45)\n02-01 11:09:36.832  2073  2287 W EntropyMixer: \tat com.android.server.EntropyMixer.addHwRandomEntropy(EntropyMixer.java:205)\n02-01 11:09:36.832  2073  2287 W EntropyMixer: \tat com.android.server.EntropyMixer.access$000(EntropyMixer.java:59)\n02-01 11:09:36.832  2073  2287 W EntropyMixer: \tat com.android.server.EntropyMixer$1.handleMessage(EntropyMixer.java:83)\n02-01 11:09:36.832  2073  2287 W EntropyMixer: \tat android.os.Handler.dispatchMessage(Handler.java:106)\n02-01 11:09:36.832  2073  2287 W EntropyMixer: \tat android.os.Looper.loopOnce(Looper.java:201)\n02-01 11:09:36.832  2073  2287 W EntropyMixer: \tat android.os.Looper.loop(Looper.java:288)\n02-01 11:09:36.832  2073  2287 W EntropyMixer: \tat android.os.HandlerThread.run(HandlerThread.java:67)\n02-01 11:09:36.832  2073  2287 W EntropyMixer: \tat com.android.server.ServiceThread.run(ServiceThread.java:44)\n02-01 11:09:36.832  2073  2287 W EntropyMixer: Caused by: android.system.ErrnoException: open failed: EACCES (Permission denied)\n02-01 11:09:36.832  2073  2287 W EntropyMixer: \tat libcore.io.Linux.open(Native Method)\n02-01 11:09:36.832  2073  2287 W EntropyMixer: \tat libcore.io.ForwardingOs.open(ForwardingOs.java:166)\n02-01 11:09:36.832  2073  2287 W EntropyMixer: \tat libcore.io.BlockGuardOs.open(BlockGuardOs.java:272)\n02-01 11:09:36.832  2073  2287 W EntropyMixer: \tat libcore.io.IoBridge.open(IoBridge.java:485)\n02-01 11:09:36.832  2073  2287 W EntropyMixer: \t... 11 more\n02-01 11:09:36.832  2073  2287 I EntropyMixer: Writing entropy...\n```\nso it does seem like _something\u0027s_ not right here, even if i\u0027m not qualified to say _which_ piece is wrong...",
      "revId": "dda3ab1afa40926a0d9ee63bb078b11c51fd0c35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ec229a5c_f4dde1c9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2021-02-01T20:02:02Z",
      "side": 1,
      "message": "that doesn\u0027t seem to be true though. here\u0027s the caller in FileInputStream:\n```\n        fd \u003d IoBridge.open(name, O_RDONLY);\n```",
      "parentUuid": "8c71e946_a5871a61",
      "revId": "dda3ab1afa40926a0d9ee63bb078b11c51fd0c35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6232e8ff_38f19f11",
        "filename": "rootdir/ueventd.rc",
        "patchSetId": 1
      },
      "lineNbr": 42,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2021-02-01T20:22:15Z",
      "side": 1,
      "message": "also it looks like we\u0027re not getting what we asked for from this file anyway:\n```\ncrw------- 1 root root 10, 183 1970-10-01 03:17 /dev/hw_random\n```\n/dev/random and /dev/urandom look right though, as does /dev/ashmem.\n\n+adelva in case there\u0027s some known issue with /dev/hw_random and ueventd? (i see this on cuttlefish as well as bramble...)",
      "revId": "dda3ab1afa40926a0d9ee63bb078b11c51fd0c35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "301068c4_87b4e4a5",
        "filename": "rootdir/ueventd.rc",
        "patchSetId": 1
      },
      "lineNbr": 42,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2021-02-01T23:25:21Z",
      "side": 1,
      "message": "seems like hw_random arrived *later* than the other two?\n```\n$ adb shell stat /dev/*random*\n  File: /dev/random\n  Size: 0\t Blocks: 0\t IO Blocks: 512\t character device\nDevice: 10h/16d\t Inode: 7\t Links: 1\t Device type: 1,8\nAccess: (0666/crw-rw-rw-)\tUid: (    0/    root)\tGid: (    0/    root)\nAccess: 2021-02-01 23:13:55.167999992 +0000\nModify: 2021-02-01 23:13:55.167999992 +0000\nChange: 2021-02-01 23:13:59.875999939 +0000\n  File: /dev/urandom\n  Size: 0\t Blocks: 0\t IO Blocks: 512\t character device\nDevice: 10h/16d\t Inode: 8\t Links: 1\t Device type: 1,9\nAccess: (0666/crw-rw-rw-)\tUid: (    0/    root)\tGid: (    0/    root)\nAccess: 2021-02-01 23:13:55.167999992 +0000\nModify: 2021-02-01 23:13:55.167999992 +0000\nChange: 2021-02-01 23:13:59.887999939 +0000\n  File: /dev/hw_random\n  Size: 0\t Blocks: 0\t IO Blocks: 512\t character device\nDevice: 10h/16d\t Inode: 366\t Links: 1\t Device type: a,b7\nAccess: (0600/crw-------)\tUid: (    0/    root)\tGid: (    0/    root)\nAccess: 2021-02-01 23:13:59.879999939 +0000\nModify: 2021-02-01 23:13:59.879999939 +0000\nChange: 2021-02-01 23:13:59.879999939 +0000\n$ \n```\ni\u0027d have thought that would make it more likely that ueventd would correctly set the permissions, though, not less likely.",
      "parentUuid": "6232e8ff_38f19f11",
      "revId": "dda3ab1afa40926a0d9ee63bb078b11c51fd0c35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "24fd426f_115970ef",
        "filename": "rootdir/ueventd.rc",
        "patchSetId": 1
      },
      "lineNbr": 42,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2021-02-01T23:26:44Z",
      "side": 1,
      "message": "device/google/cuttlefish/shared/config/ueventd.rc:\n```\n# android.permission.cts.FileSystemPermissionTest#testDevHwRandomLockedDown\n/dev/hw_random 0600 root root\n```",
      "parentUuid": "301068c4_87b4e4a5",
      "revId": "dda3ab1afa40926a0d9ee63bb078b11c51fd0c35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "789c98b3_8a27aca4",
        "filename": "rootdir/ueventd.rc",
        "patchSetId": 1
      },
      "lineNbr": 42,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2021-02-01T23:28:18Z",
      "side": 1,
      "message": "but that test is just this:\n```\n    @Test\n    public void testDevHwRandomLockedDown() throws Exception {\n        File f \u003d new File(\"/dev/hw_random\");\n        if (!f.exists()) {\n            // HW RNG is not required to be exposed on all devices.\n            return;\n        }\n\n        assertFalse(f + \" can be opened for reading\", canOpenForReading(f));\n        assertFalse(f + \" can be opened for writing\", canOpenForWriting(f));\n\n        FileUtils.FileStatus status \u003d new FileUtils.FileStatus();\n        assertFalse(\"stat permitted on \" + f,\n                FileUtils.getFileStatus(f.getPath(), status, false));\n    }\n```\nfor which 0660 system:system should be fine?",
      "parentUuid": "24fd426f_115970ef",
      "revId": "dda3ab1afa40926a0d9ee63bb078b11c51fd0c35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8c5e9ad3_1057208d",
        "filename": "rootdir/ueventd.rc",
        "patchSetId": 1
      },
      "lineNbr": 42,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2021-02-01T23:36:34Z",
      "side": 1,
      "message": "commenting out that line from device/google/cuttlefish/shared/config/ueventd.rc fixes /dev/hw_random\u0027s permissions for me and lets EntropyMixer work again:\n```\n02-01 23:35:07.572   552   552 I SystemServerTiming: StartEntropyMixer\n02-01 23:35:07.576   552   552 I EntropyMixer: Added HW RNG output to entropy pool\n02-01 23:35:07.576   552   552 I EntropyMixer: Writing entropy...\n```\n\nlet me try the CTS test that inspired this change...",
      "parentUuid": "789c98b3_8a27aca4",
      "revId": "dda3ab1afa40926a0d9ee63bb078b11c51fd0c35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fae51913_122435db",
        "filename": "rootdir/ueventd.rc",
        "patchSetId": 1
      },
      "lineNbr": 42,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2021-02-01T23:42:30Z",
      "side": 1,
      "message": "hmm... works for me...\n```\n[23/50] android.permission.cts.FileSystemPermissionTest#testDevHwRandomLockedDown: PASSED (1ms)\n```\ni\u0027ll upload the device/google/cuttlefish/shared/config/ueventd.rc fix...",
      "parentUuid": "8c5e9ad3_1057208d",
      "revId": "dda3ab1afa40926a0d9ee63bb078b11c51fd0c35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "087d3908_ca22046e",
        "filename": "rootdir/ueventd.rc",
        "patchSetId": 1
      },
      "lineNbr": 42,
      "author": {
        "id": 1319385
      },
      "writtenOn": "2021-02-02T00:59:45Z",
      "side": 1,
      "message": "Not sure if you see my comment before, or you would just save more time:P\n\nOne thing I am considering is that the device ueventd part is from qualcomm, back to this commit: https://source.codeaurora.org/quic/la/device/qcom/common/commit/rootdir/etc/ueventd.qcom.rc?h\u003dLF.UM.8.7-11500-8x09.0\u0026id\u003d2ce3aeea0e243062c8e9246cfe493887b48c441b\n\nNot sure if this will change something related to security...",
      "parentUuid": "fae51913_122435db",
      "revId": "dda3ab1afa40926a0d9ee63bb078b11c51fd0c35",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}