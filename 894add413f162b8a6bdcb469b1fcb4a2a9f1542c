{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "36172acd_90fa5215",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 7,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2022-05-18T09:56:36Z",
      "side": 1,
      "message": "How bad is this? Any user-visible side effect? I guess not.",
      "range": {
        "startLine": 7,
        "startChar": 31,
        "endLine": 7,
        "endChar": 36
      },
      "revId": "894add413f162b8a6bdcb469b1fcb4a2a9f1542c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "05835c53_0eb0f333",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 7,
      "author": {
        "id": 1400304
      },
      "writtenOn": "2022-05-18T10:29:08Z",
      "side": 1,
      "message": "Yes for the cases you don\u0027t suppose to be start even blank_screen for Set Top Box a.k.a. Android TV in shutdown Flow.\n\nReason is blank_screen will turn off the LED and then You are killing the services with SIGTERM and then you are sending SIGKILL if processes are not terminated by SIGTERM. This takes ~10-20 sec in worst cases. You are turning OFF the LED even device is not Fully shutdown.",
      "parentUuid": "36172acd_90fa5215",
      "range": {
        "startLine": 7,
        "startChar": 31,
        "endLine": 7,
        "endChar": 36
      },
      "revId": "894add413f162b8a6bdcb469b1fcb4a2a9f1542c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c9273ae8_dcde704c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 9,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2022-05-18T09:56:36Z",
      "side": 1,
      "message": "Is it guaranteed that the blank_screen has ran when the shutdown sequence hits here? If so, how? Could you elaborate?\n\nEven if it is the case as of today, I think the assumption could easily be broken unless it is asserted somehow. Doesn\u0027t it sound like running the service here again is a safer bet?",
      "range": {
        "startLine": 9,
        "startChar": 25,
        "endLine": 9,
        "endChar": 32
      },
      "revId": "894add413f162b8a6bdcb469b1fcb4a2a9f1542c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9fe46cb7_5953ed2d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 9,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2022-05-18T09:56:36Z",
      "side": 1,
      "message": "Could you let me know where in the code the blank_screen is started?",
      "range": {
        "startLine": 9,
        "startChar": 33,
        "endLine": 9,
        "endChar": 75
      },
      "revId": "894add413f162b8a6bdcb469b1fcb4a2a9f1542c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a7e084ce_2cf21846",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 9,
      "author": {
        "id": 1400304
      },
      "writtenOn": "2022-05-18T10:29:08Z",
      "side": 1,
      "message": "Is it guaranteed that the blank_screen has ran when the shutdown sequence hits here? If so, how? Could you elaborate?\n\n\u003e\u003e Yes, Above Comments cover here\n\nDoesn\u0027t it sound like running the service here again is a safer bet?\n\u003e\u003e we can run , but Is it covers any usecase ?",
      "parentUuid": "c9273ae8_dcde704c",
      "range": {
        "startLine": 9,
        "startChar": 25,
        "endLine": 9,
        "endChar": 32
      },
      "revId": "894add413f162b8a6bdcb469b1fcb4a2a9f1542c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "cd11d736_284a9d9d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 9,
      "author": {
        "id": 1400304
      },
      "writtenOn": "2022-05-18T10:29:08Z",
      "side": 1,
      "message": "} else if (s-\u003eIsShutdownCritical()) {\n            // Start shutdown critical service if not started.\n            if (auto result \u003d s-\u003eStart(); !result.ok()) {\n                LOG(ERROR) \u003c\u003c \"Could not start shutdown critical service \u0027\" \u003c\u003c s-\u003ename()\n                           \u003c\u003c \"\u0027: \" \u003c\u003c result.error();\n            }\n        } else {\n            stop_first.insert(s-\u003ename());\n        }\n    }\n\n    // remaining operations (specifically fsck) may take a substantial duration\n    \n    \n \u003e\u003e Above else if will start the blank_screen due to service marked as shutdown critical\n \n hardware/interfaces/light/utils/blank_screen.rc\n service blank_screen /system/bin/blank_screen\n    user system\n    oneshot\n    group system\n    shutdown critical",
      "parentUuid": "9fe46cb7_5953ed2d",
      "range": {
        "startLine": 9,
        "startChar": 33,
        "endLine": 9,
        "endChar": 75
      },
      "revId": "894add413f162b8a6bdcb469b1fcb4a2a9f1542c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4be85191_ba53a6fd",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 9,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2022-05-18T13:33:15Z",
      "side": 1,
      "message": "Got it. Thanks for the pointers.\n\nI think aosp/594443 which introduced blank_screen and made it a shutdown critical service, and aosp/594444 which tries *not* to start it when the reboot takes long (e.g. due to fsck) don\u0027t agree with each other. By being a shutdown critical service, it is started \"always\", even when we want to keep the screen on.\n\nI think the correct fix is to keep the code fragment that this CL removes, and instead drop \"shutdown critical\" from the rc file. That way we blank the screen only when we want to.",
      "parentUuid": "cd11d736_284a9d9d",
      "range": {
        "startLine": 9,
        "startChar": 33,
        "endLine": 9,
        "endChar": 75
      },
      "revId": "894add413f162b8a6bdcb469b1fcb4a2a9f1542c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "79b28697_1614ed1b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1400304
      },
      "writtenOn": "2022-05-18T09:37:43Z",
      "side": 1,
      "message": "} else if (s-\u003eIsShutdownCritical()) {\n            // Start shutdown critical service if not started.\n            if (auto result \u003d s-\u003eStart(); !result.ok()) {\n                LOG(ERROR) \u003c\u003c \"Could not start shutdown critical service \u0027\" \u003c\u003c s-\u003ename()\n                           \u003c\u003c \"\u0027: \" \u003c\u003c result.error();\n            }\n        }\n        \n        \nblank_screen service marked as shutdown critical",
      "revId": "894add413f162b8a6bdcb469b1fcb4a2a9f1542c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8bbe6d9a_5e017511",
        "filename": "init/reboot.cpp",
        "patchSetId": 3
      },
      "lineNbr": 670,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2022-05-18T09:56:36Z",
      "side": 1,
      "message": "This comment was explaining the reason for the blank_screen below. If the below code is removed, the comment should gone as well.",
      "revId": "894add413f162b8a6bdcb469b1fcb4a2a9f1542c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fa810216_8274034f",
        "filename": "init/reboot.cpp",
        "patchSetId": 3
      },
      "lineNbr": 670,
      "author": {
        "id": 1400304
      },
      "writtenOn": "2022-05-18T10:29:08Z",
      "side": 1,
      "message": "Not sure whether the code which has been here and comments doesn\u0027t match. So, may be this comment points below operation. So, not removed.",
      "parentUuid": "8bbe6d9a_5e017511",
      "revId": "894add413f162b8a6bdcb469b1fcb4a2a9f1542c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b089dc41_ce55e6f0",
        "filename": "init/reboot.cpp",
        "patchSetId": 3
      },
      "lineNbr": 670,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2022-05-18T13:33:15Z",
      "side": 1,
      "message": "The code and the comment were introduced together. See https://android-review.googlesource.com/c/platform/system/core/+/594444/2/init/reboot.cpp#385",
      "parentUuid": "fa810216_8274034f",
      "revId": "894add413f162b8a6bdcb469b1fcb4a2a9f1542c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}