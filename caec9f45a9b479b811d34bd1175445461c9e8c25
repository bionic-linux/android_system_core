{
  "comments": [
    {
      "key": {
        "uuid": "51ede6f7_088d72a9",
        "filename": "fs_mgr/fs_mgr_fstab.cpp",
        "patchSetId": 5
      },
      "lineNbr": 318,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2017-07-27T06:08:40Z",
      "side": 1,
      "message": "Yup, we will need to fix this separately in long term.\n  \nMaybe we can consider s/get_android_dt_dir/fs_mgr_get_android_dt_dir.\nAnd init/util also invokes fs_mgr_get_android_dt_dir().\nSo we can keep the logic in one place.\n  \nBut having init/util needs to use fs_mgr is weird, too.\nSo I\u0027m ok with current structure in this CL.",
      "range": {
        "startLine": 318,
        "startChar": 3,
        "endLine": 318,
        "endChar": 59
      },
      "revId": "caec9f45a9b479b811d34bd1175445461c9e8c25",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "227491e1_0564cf77",
        "filename": "fs_mgr/fs_mgr_fstab.cpp",
        "patchSetId": 5
      },
      "lineNbr": 318,
      "author": {
        "id": 1057369
      },
      "writtenOn": "2017-07-27T06:31:26Z",
      "side": 1,
      "message": "Good point, thanks. Given the dilemma, I\u0027ll just keep the FIXMEs for now.",
      "parentUuid": "51ede6f7_088d72a9",
      "range": {
        "startLine": 318,
        "startChar": 3,
        "endLine": 318,
        "endChar": 59
      },
      "revId": "caec9f45a9b479b811d34bd1175445461c9e8c25",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "51d88bf6_f5be1951",
        "filename": "fs_mgr/fs_mgr_fstab.cpp",
        "patchSetId": 5
      },
      "lineNbr": 321,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2017-07-27T06:08:40Z",
      "side": 1,
      "message": "Is android_dt_dir thread safe?\nSeems need to move it inside the call_once() as well.\n  \nBtw, maybe we can just use initialization of function-local statics?\n\nconst std::string init_android_dt_dir() {\n    std::string android_dt_dir;\n    if (fs_mgr_get_boot_config_from_kernel_cmdline(\"android_dt_dir\", \u0026android_dt_dir)) {         \n        return android_dt_dir;\n    }\n    return kAndroidDtDir;\n}\n\nconst std::string\u0026 get_android_dt_dir() {\n    static std::string android_dt_dir \u003d init_android_dt_dir();\n    return android_dt_dir;\n}",
      "range": {
        "startLine": 321,
        "startChar": 23,
        "endLine": 321,
        "endChar": 37
      },
      "revId": "caec9f45a9b479b811d34bd1175445461c9e8c25",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1d7f3900_5ec99eb6",
        "filename": "fs_mgr/fs_mgr_fstab.cpp",
        "patchSetId": 5
      },
      "lineNbr": 321,
      "author": {
        "id": 1057369
      },
      "writtenOn": "2017-07-27T06:31:26Z",
      "side": 1,
      "message": "I\u0027m not sure what could go wrong if we left android_dt_dir outside call_once(), since all writes to it are inside call_once(). Are you talking about the empty() check?\n\nBut the static initializer solution looks neat! I don\u0027t know if the compiler guarantees the initializer function is only executed once, but at least it makes sure android_dt_dir is set only once.",
      "parentUuid": "51d88bf6_f5be1951",
      "range": {
        "startLine": 321,
        "startChar": 23,
        "endLine": 321,
        "endChar": 37
      },
      "revId": "caec9f45a9b479b811d34bd1175445461c9e8c25",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}