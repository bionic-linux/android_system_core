{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "165ccc9a_f22ae1db",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 1970665
      },
      "writtenOn": "2023-02-08T17:07:46Z",
      "side": 1,
      "message": "First part of go/fastboot-line-length\nAndroid First to update trusty-ut-ctrl in particular. Then trusty/abl.\n\nThanks for the review ðŸ˜Š",
      "revId": "99f4f63db43b7798823a057ea26eb357c7513f26",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a321be26_1665ccc5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2023-02-08T17:47:13Z",
      "side": 1,
      "message": "Did increasing the line length not work?",
      "revId": "99f4f63db43b7798823a057ea26eb357c7513f26",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "19d6ad6f_5bb512b1",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 1970665
      },
      "writtenOn": "2023-02-08T18:27:30Z",
      "side": 1,
      "message": "It is not enough for me, because every call to printf in a test sends an IPC message. Then Every message is printed on its own line.",
      "parentUuid": "a321be26_1665ccc5",
      "revId": "99f4f63db43b7798823a057ea26eb357c7513f26",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "db56f466_00d1e7c7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 1970665
      },
      "writtenOn": "2023-02-08T18:27:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "19d6ad6f_5bb512b1",
      "revId": "99f4f63db43b7798823a057ea26eb357c7513f26",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b27e4446_fdf462ce",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2023-02-08T18:52:45Z",
      "side": 1,
      "message": "Could you clarify this more? If no lines are longer than 256 characters, it\u0027s not clear to me why it wouldn\u0027t work (or why we couldn\u0027t increase the response length which would be much easier).",
      "parentUuid": "db56f466_00d1e7c7",
      "revId": "99f4f63db43b7798823a057ea26eb357c7513f26",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0c0625aa_ead7d5d6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 1952791
      },
      "writtenOn": "2023-02-08T19:12:05Z",
      "side": 1,
      "message": "+1\nI was slightly surprised to see this CL, rather than just allowing longer line output up to the current protocol.  \nPlease can you update the existing design doc with a section to clarify why longer lines is not preferred?\nThat said, this implementation is quite small and neat.",
      "parentUuid": "b27e4446_fdf462ce",
      "revId": "99f4f63db43b7798823a057ea26eb357c7513f26",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5593a786_ef2266ad",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 1970665
      },
      "writtenOn": "2023-02-09T08:49:34Z",
      "side": 1,
      "message": "The original problem came from running crypto hardware benchmarks in fastboot/abl because this is a much more controlled environment than linux.\n\nFrom there once benchmark run is initiated, what happens is a three entity communication. Trusty (Device) --\u003e ABL(Device) --\u003e Fastboot(Host). For every call to trusty_unittest_printf, an IPC message is sent to ABL. ABL then forwards it to the host over USB. Fastboot then prints one line \"(bootloader) INFO: [...]\\n\". \n\nWhile I could perform buffering on trusty side. Only sending line by line, it is not very convenient. For example, when printing columns, Each column gets its own call to printf, with appropriated sizing and formatting.\n\nAlso, there are different formatting options: Horizontal Table, Vertical Table (those are just pivoted tables from one another), JSON, and more may come. Both trusty IPC and Fastboot on the hosts use a 256 Bytes buffer, Few characters of which are used for other things, such as message types in the first byte(s). ABL fastboot implementation uses a 64 Bytes Buffer, the 4 first bytes being used for the type header. It is hard for me to guarantee that 250+ bytes will be enough to hold any full line. In fact it is pretty much guaranteed that horizontal printing will nearly always go beyond that.\n\nSo if on Fastboot/ABL side, I only pop up buffer size and nothing else, I need to:\n - Perform buffering on trusty side to only send line by line irrespective of printing logic and buffer sizes.\n - Make sure that no lines ever goes over 252 BYTES (due to 4bytes header size).",
      "parentUuid": "0c0625aa_ead7d5d6",
      "revId": "99f4f63db43b7798823a057ea26eb357c7513f26",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c11318b2_009d2d5e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2023-02-09T19:20:54Z",
      "side": 1,
      "message": "After talking to mwills some more about this, we think there needs to be a really high bar for fastboot protocol changes, given the age and prevalence of the tooling, and the difficulty of detecting host tool compatibility. I don\u0027t think this clears the bar since the use case is very specific.\n\nI\u0027m not super convinced of the difficulty of resolving these issues in ABL, either. If we\u0027re adding code to pivot/re-render data, is that any less complex than buffering? If complexity in ABL is an issue, wouldn\u0027t it be better to send this data in a concise, parseable format, and have the host decide how to render it?\n\nI\u0027d say these are my preferences for moving forward, in order:\n\n1) Change the fastboot host tool, so that if an INFO message ends in a backslash (\u0027\\\\\u0027), it will append the next INFO message into that line. That roughly aligns with how other line-based processors work, and doesn\u0027t risk any serious compatibility issues.\n\n2) Change the maximum fastboot response size from 256 to 4096 or something. mwills@ should sign off on that too though, since it is a subtle compatibility change.",
      "parentUuid": "5593a786_ef2266ad",
      "revId": "99f4f63db43b7798823a057ea26eb357c7513f26",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "47cdf332_abe947e5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 1970665
      },
      "writtenOn": "2023-02-09T20:45:13Z",
      "side": 1,
      "message": "You preference (1) was my initial implementation that sparked the whole discussion, Mike Specs and then this implementation. You can see it in Patchset 1 with \u0027@\u0027 rather than \u0027\\\u0027... So there is no particular difficulty as it was what was initially done. \n\nAlso backward \"host tool compatibility\" was given as the main reason not to change the INFO message.",
      "parentUuid": "c11318b2_009d2d5e",
      "revId": "99f4f63db43b7798823a057ea26eb357c7513f26",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e0b05d5f_70dc5bcc",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2023-02-09T21:41:23Z",
      "side": 1,
      "message": "In retrospect, I think it\u0027s the least painful option, and tools that don\u0027t support the continuation marker will still work, just suboptimally.",
      "parentUuid": "47cdf332_abe947e5",
      "revId": "99f4f63db43b7798823a057ea26eb357c7513f26",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c3aee913_b0d5e40f",
        "filename": "trusty/libtrusty/tipc-test/tipc_test.c",
        "patchSetId": 9
      },
      "lineNbr": 631,
      "author": {
        "id": 1952791
      },
      "writtenOn": "2023-02-08T17:37:12Z",
      "side": 1,
      "message": "Can this check be combined with the one on line :629?",
      "range": {
        "startLine": 631,
        "startChar": 8,
        "endLine": 631,
        "endChar": 44
      },
      "revId": "99f4f63db43b7798823a057ea26eb357c7513f26",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "abfb2e18_3dcc1abf",
        "filename": "trusty/libtrusty/tipc-test/tipc_test.c",
        "patchSetId": 9
      },
      "lineNbr": 631,
      "author": {
        "id": 1970665
      },
      "writtenOn": "2023-02-09T09:08:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c3aee913_b0d5e40f",
      "range": {
        "startLine": 631,
        "startChar": 8,
        "endLine": 631,
        "endChar": 44
      },
      "revId": "99f4f63db43b7798823a057ea26eb357c7513f26",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ea0821a4_a96f5276",
        "filename": "trusty/utils/trusty-ut-ctrl/ut-ctrl.c",
        "patchSetId": 9
      },
      "lineNbr": 127,
      "author": {
        "id": 1952791
      },
      "writtenOn": "2023-02-08T17:37:12Z",
      "side": 1,
      "message": "This can be combined with line 125.",
      "range": {
        "startLine": 127,
        "startChar": 8,
        "endLine": 127,
        "endChar": 44
      },
      "revId": "99f4f63db43b7798823a057ea26eb357c7513f26",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c9160bab_57260a9c",
        "filename": "trusty/utils/trusty-ut-ctrl/ut-ctrl.c",
        "patchSetId": 9
      },
      "lineNbr": 127,
      "author": {
        "id": 1970665
      },
      "writtenOn": "2023-02-09T09:08:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ea0821a4_a96f5276",
      "range": {
        "startLine": 127,
        "startChar": 8,
        "endLine": 127,
        "endChar": 44
      },
      "revId": "99f4f63db43b7798823a057ea26eb357c7513f26",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}