{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "aaec9d99_1a4e49a9",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2021-06-02T21:30:33Z",
      "side": 1,
      "message": "shouldn\u0027t we be using the Android prebuilt one-true-awk from prebuilts/build-tools/ so we\u0027re immune from issues like this?",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 13,
        "endChar": 23
      },
      "revId": "ad3a57bdbaa05fd531a05373a07f0435a9d5dc33",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fe247ac2_235ba721",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-06-03T07:20:15Z",
      "side": 1,
      "message": "I recall Mark said this script should accommodate for various host runtime environments and also partner devices. we should be able to invoke this script out-of-tree, that is without a lunch-ed environment, or without a platform tree at all.\n\nI tried not to add dependencies like `${TOP}/prebuilts/build-tools/`, as I want to keep the dependencies to be \"standard\" shell utilities like grep, sed, awk, sh ...\n\nBTW, neither the in tree one-true-awk can parse `[/]`.\nThis seems to be an ambiguous expression for one-true-awk. Quoting the book \"The AWK Programming Language\" page 29 (yes I happen to have the actual book...), \"Inside a character class, all characters have their literal meaning, except for the quoting character \u0027\\\u0027, \u0027^\u0027 at the beginning, and \u0027-\u0027 between two characters.\"; page 31, \"awk uses escape sequences to specify characters for which there may be no other notation.\" without giving a definition of \"no other notation\".\n \nPage 29 sounds to me that `[/]` is a valid expression, but in reality one-true-awk treats \u0027/\u0027 as end of regex marker even within a character class, thus slash \"has no other notation in one-true-awk\u0027s implementation\", thus needs to be escaped.\n\nAnyway, rewriting `[/]` to `[\\/]` or `\\/` seems to be more \"parser-friendly\", regardless of awk implementations (I tested on gawk, mawk-v1.3.3, mawk-v1.3.4, in-tree one-true-awk)",
      "parentUuid": "aaec9d99_1a4e49a9",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 13,
        "endChar": 23
      },
      "revId": "ad3a57bdbaa05fd531a05373a07f0435a9d5dc33",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1262d632_faae5f10",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2021-06-08T00:24:08Z",
      "side": 1,
      "message": "\u003e I recall Mark said this script should accommodate for various host runtime environments and also partner devices.\n\nthat\u0027s a good goal, but that\u0027s _why_ we have the hermetic one true awk --- so you can know exactly what version you\u0027re using. and don\u0027t have to fix things for every single possible combination of implementation and version out there. (at some point we plan on preventing CI from \"accidentally\" picking up its own versions of things.)\n\n\u003e I tried not to add dependencies like `${TOP}/prebuilts/build-tools/`, as I want to keep the dependencies to be \"standard\" shell utilities like grep, sed, awk, sh ...\n\nthey\u0027re in prebuilts/build-tools/ too. and since you have to be compatible with those during the build, it\u0027s reasonable that the same should apply during tests. (again, one of the things on the build team\u0027s to-do list is to _remove_ differences between CI and local runs, and the way to do that is again to enforce running a _known_ version of everything.)\n\n\u003e yes I happen to have the actual book\n\n(heh. that was my favorite CS book as a kid. i learned so much from that book, and to this day i don\u0027t think i\u0027ve read a better programming language manual. i don\u0027t know why people speak so highly of K\u0026R when A\u0026W\u0026K is so much better.)\n\n\u003e BTW, neither the in tree one-true-awk can parse `[/]`.\n\nthat would probably have been a better title for this CL then --- i\u0027m definitely not going to argue with that change :-)\n\nif you decide to report that upstream to https://github.com/onetrueawk/awk/issues i\u0027d be curious to know whether they think it\u0027s a bug or WAI.",
      "parentUuid": "fe247ac2_235ba721",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 13,
        "endChar": 23
      },
      "revId": "ad3a57bdbaa05fd531a05373a07f0435a9d5dc33",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3e7aa09f_61d37d0e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-06-16T17:55:13Z",
      "side": 1,
      "message": "What I had in mind when I said \"various host runtime environments\" is actually non-Google developers. Hypothetically there could be some partner that set up there CI without hermetic environment, and might be downloading and running the test script bare: ./adb-remount-test.sh. So I was trying to make the code here as compatible as possible (if sh works then don\u0027t use bash ... etc) But you\u0027ve made your point clear and it\u0027s a whack on my head. What I was doing is really just making the script *debian* and hermetic-environment compatible, and who knows if there are some distro out there with even weirder awk or sed implementations!\n\nTell you what, since it\u0027s working now I won\u0027t change it, but the next time this script had problems I\u0027ll make the change to use prebuilts/build-tools/...\n\n\u003e i don\u0027t know why people speak so highly of K\u0026R when A\u0026W\u0026K is so much better.)\n\nProbably because students usually don\u0027t learn AWK as there first programming language (or even learn AWK at all...), plus I believe the book is not being printed anymore.\nI only bought the book as a joke (cause I was pissed the only good quality spec I can find on the web is gawk), but I was pleasantly surprised by how well written and useful this manual is.\n\nI\u0027ll file a bug to upstream when I had the free time",
      "parentUuid": "1262d632_faae5f10",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 13,
        "endChar": 23
      },
      "revId": "ad3a57bdbaa05fd531a05373a07f0435a9d5dc33",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d093c9b3_9f515438",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2021-06-17T00:35:40Z",
      "side": 1,
      "message": "\u003e What I was doing is really just making the script *debian* and hermetic-environment compatible\n\nexactly :-)\n\n\u003e and who knows if there are some distro out there with even weirder awk or sed implementations\n\nit\u0027s funny you should ask that, because that\u0027s one of the reasons i\u0027m so sold on the whole prebuilts thing --- having found that the alternative always ends with someone with a big-endian host from the 1990s running an OS you haven\u0027t even heard of wanting you to take their patches too. at which point it\u0027s pretty hard not to be an enthusiastic convert to the idea of \"please just use ours\".\n\n(this is one reason why i want to get us off glibc and onto musl, so we can start shipping static prebuilts, increasing the \"just works\" to more systems. although likely never to anything big-endian :-) )\n\n\u003e Tell you what, since it\u0027s working now I won\u0027t change it, but the next time this script had problems I\u0027ll make the change to use prebuilts/build-tools/...\n\nsgtm, thanks!",
      "parentUuid": "3e7aa09f_61d37d0e",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 13,
        "endChar": 23
      },
      "revId": "ad3a57bdbaa05fd531a05373a07f0435a9d5dc33",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}