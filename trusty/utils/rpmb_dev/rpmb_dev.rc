# RPMB Mock
on post-fs-data
    mkdir /data/vendor/ss 0770 root system
    # create fake persist storage
    mkdir /data/vendor/ss/persist 0770 root system

    rm -f /data/vendor/ss/rpmb_sock
    start rpmb_mock_init
    wait /data/vendor/ss/RPMB_DATA 1
    start rpmb_mock

    # Storage proxy
    wait /data/vendor/ss/rpmb_sock 1
    start storageproxyd

service storageproxyd /vendor/bin/storageproxyd -d /dev/trusty-ipc-dev0 \
        -r /data/vendor/ss/rpmb_sock -p /data/vendor/ss -t sock
    class main
    disabled
    user root

service rpmb_mock_init /vendor/bin/rpmb_dev --dev /data/vendor/ss/RPMB_DATA --init --size 2048
    disabled
    user system
    group system
    oneshot

service rpmb_mock /vendor/bin/rpmb_dev --dev /data/vendor/ss/RPMB_DATA --sock /data/vendor/ss/rpmb_sock
    class main
    disabled
    user system
    group system
