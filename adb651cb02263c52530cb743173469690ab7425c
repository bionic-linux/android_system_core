{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "7eb5fca3_de7b7e4f",
        "filename": "init/service.cpp",
        "patchSetId": 3
      },
      "lineNbr": 358,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2024-04-03T10:58:22Z",
      "side": 1,
      "message": "the number of crashes counted here is not exclusive for system_server. so there\u0027s chance that the device goes to bootloader before the 15 system_server restarts if there was 5 more crashes in other processes.\n\nyou may want to have another counter for system_server (for that you will have to teach the name of the service to init), or you may want to extend the *.rc language so that system_server can specify its crash count threshold in the rc file.",
      "range": {
        "startLine": 358,
        "startChar": 20,
        "endLine": 358,
        "endChar": 80
      },
      "revId": "adb651cb02263c52530cb743173469690ab7425c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "299c08f9_5838bfbc",
        "filename": "init/service.cpp",
        "patchSetId": 3
      },
      "lineNbr": 358,
      "author": {
        "id": 1060436
      },
      "writtenOn": "2024-04-03T11:57:23Z",
      "side": 1,
      "message": "I\u0027m not sure what the odds are that we\u0027d be crashing in both system server and another process this watchdog is monitoring at the same time, and that PackageWatchdog could do anything to help. So probably for now we don\u0027t have to worry about this.\n\nThere is a risk that this watchdog is monitoring another package that starts crashing but where recovery is possible via other mechanisms, and they never run because this watchdog triggers bootlooping. That would be an issue independent of this change... the best way to avoid that would be to either not monitor such a package or have the throttling mentioned previously so that you only reboot the device once per day or something.",
      "parentUuid": "7eb5fca3_de7b7e4f",
      "range": {
        "startLine": 358,
        "startChar": 20,
        "endLine": 358,
        "endChar": 80
      },
      "revId": "adb651cb02263c52530cb743173469690ab7425c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c310da2a_61d47c45",
        "filename": "init/service.cpp",
        "patchSetId": 3
      },
      "lineNbr": 358,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2024-04-03T15:19:22Z",
      "side": 1,
      "message": "Let\u0027s assume that there\u0027s a service added by a partner. It is marked as \u0027critical\u0027 thus monitored by init. If it crashes many times (5+) while rescue party is in action, it will interfere you. Right?",
      "parentUuid": "299c08f9_5838bfbc",
      "range": {
        "startLine": 358,
        "startChar": 20,
        "endLine": 358,
        "endChar": 80
      },
      "revId": "adb651cb02263c52530cb743173469690ab7425c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5bf2c58f_cc8a2b00",
        "filename": "init/service.cpp",
        "patchSetId": 3
      },
      "lineNbr": 358,
      "author": {
        "id": 1060436
      },
      "writtenOn": "2024-04-03T15:46:13Z",
      "side": 1,
      "message": "I think at this point it would need to crash \u003e 20 times, unless there\u0027s some other logic checking for that. \n\nBut yes, it could interfere with PackageWatchdog, if it turns out that this service and system server are both crashing. \n\nI\u0027m not clear on what\u0027s being proposed -- would this watchdog stop paying attention to these other critical services? Still reboot after 5 crashes in those? Or 20?\n\nAs long as you are rebooting the device after enough crashes in another service (not system server) without throttling, there\u0027s the chance this watchdog will cause the device to bootloop and PackageWatchdog mitigations will never get to run... so I guess this is another reason for there to be some throttling here.",
      "parentUuid": "c310da2a_61d47c45",
      "range": {
        "startLine": 358,
        "startChar": 20,
        "endLine": 358,
        "endChar": 80
      },
      "revId": "adb651cb02263c52530cb743173469690ab7425c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "612b33a9_9f7e7e27",
        "filename": "init/service.cpp",
        "patchSetId": 3
      },
      "lineNbr": 358,
      "author": {
        "id": 1060436
      },
      "writtenOn": "2024-04-03T16:20:34Z",
      "side": 1,
      "message": "For now, I think we\u0027d rather have the limit of 20 without worrying about distinguishing between crashes in system server vs. other services so that in cases where only system server is crashing we get the correct behavior.\n\nWe could use your help or Woody\u0027s help in implementing throttling or any logic to distinguish between system server and other crashes; as this isn\u0027t our code we\u0027re not sure how to make the changes in question.",
      "parentUuid": "5bf2c58f_cc8a2b00",
      "range": {
        "startLine": 358,
        "startChar": 20,
        "endLine": 358,
        "endChar": 80
      },
      "revId": "adb651cb02263c52530cb743173469690ab7425c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "05b7b282_d7e2f6a0",
        "filename": "init/service.cpp",
        "patchSetId": 3
      },
      "lineNbr": 360,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2024-04-03T10:58:22Z",
      "side": 1,
      "message": "nit: into\n```suggestion\n    // reboot into bootloader.\n```",
      "range": {
        "startLine": 360,
        "startChar": 14,
        "endLine": 360,
        "endChar": 19
      },
      "revId": "adb651cb02263c52530cb743173469690ab7425c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "24e738e8_d2cf61ef",
        "filename": "init/service.cpp",
        "patchSetId": 3
      },
      "lineNbr": 360,
      "author": {
        "id": 1977615
      },
      "writtenOn": "2024-04-03T13:06:35Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "05b7b282_d7e2f6a0",
      "range": {
        "startLine": 360,
        "startChar": 14,
        "endLine": 360,
        "endChar": 19
      },
      "revId": "adb651cb02263c52530cb743173469690ab7425c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}