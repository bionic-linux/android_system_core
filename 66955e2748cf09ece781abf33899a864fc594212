{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "cc1060c2_00869a35",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1414712
      },
      "writtenOn": "2022-06-13T07:28:28Z",
      "side": 1,
      "message": "Hi Kalesh\nWe are doing android12 + kernel 5.15 release.\nWe found several xTS cases(vts_core_meminfo_test/CtsSimpleperfTestCases) fail and your patches can fix this. Thanks for your work.\nI just cherry-pick your several patches from android12L-gsi to android12-gsi.\nWould you please have a check? Thanks for your time.\nThanks",
      "revId": "66955e2748cf09ece781abf33899a864fc594212",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ac4f9c4a_788c6d82",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1499410
      },
      "writtenOn": "2022-06-14T00:17:03Z",
      "side": 1,
      "message": "Hi Jessie. Which ACK branch is your kernel based on? We ended up reverting the kernel change in android13* kernels, due to some other user space breakage with the traceur app (which wouldn\u0027t be fixed on S). So I think you should cherry-pick the kernel revert from https://android-review.googlesource.com/c/kernel/common/+/1985929",
      "parentUuid": "cc1060c2_00869a35",
      "revId": "66955e2748cf09ece781abf33899a864fc594212",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8ac9b4b0_00d60a8d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1414712
      },
      "writtenOn": "2022-06-14T04:06:05Z",
      "side": 1,
      "message": "Hi Kalesh,\nThanks for your comments.\n\nWe are using android13-5.15. \nI checked we already picked the below patch you mentioned in android13-5.15.\nhttps://android-review.googlesource.com/c/kernel/common/+/1985929\n\nWe are doing the below release at the same time.\n1. Android12L(SP2A)(android-12.1.0_r5)  + android13-5.15\n2. Android12 (SQ1A)(android-12.0.0_r28) + android13-5.15\n\nThe case I mentioned can pass in Android12L, but fail in Android12.\nAs you mentioned in the commit message: \"On Android T and S (QPR2) this is fixed by adding a gid mount option in userspace.\", to fix the issue, we still need to pick the userspace patch.\nYour patch in android12L-gsi userspace can fix this, so I pick them back to android12-gsi.\n\nPlease help review this series patch at:\nhttps://android-review.googlesource.com/q/topic:tracefs-access-android12-gsi\n\nThanks again for your time.",
      "parentUuid": "ac4f9c4a_788c6d82",
      "revId": "66955e2748cf09ece781abf33899a864fc594212",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bb26f1f2_1eb48046",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1414712
      },
      "writtenOn": "2022-06-14T04:06:05Z",
      "side": 1,
      "message": "Hi Kalesh,\nThanks for your comments.\n\nWe are using android13-5.15. \n\nWe are doing the below release at the same time.\n1. Android12L(SP2A)(android-12.1.0_r5)  + android13-5.15\n2. Android12 (SQ1A)(android-12.0.0_r28) + android13-5.15\n\nThe case I mentioned can pass in Android12L, but fail in Android12.\n\nI checked we already picked the below patch you mentioned in android13-5.15.\nhttps://android-review.googlesource.com/c/kernel/common/+/1985929\n\nI found your patch in Android12L can fix this, so I pick them back to android12-gsi.\n\nAs you mentioned in the commit message:\nOn Android T and S (QPR2) this is fixed by adding a gid mount option in userspace.",
      "revId": "66955e2748cf09ece781abf33899a864fc594212",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "96dc8c84_d7f1f40c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1499410
      },
      "writtenOn": "2022-06-14T04:44:59Z",
      "side": 1,
      "message": "Hi Jessie. Looking back my commit message was poorly worded. If you have the kernel revert, the user space changes aren\u0027t needed.\n\nCould you double check that the device kernel has this revert applied:\n\n$adb shell ls -l /sys/kernel/tracing/events\n\nIf the directory permissions are \"drwxr-x---\", then your kernel likely doesn\u0027t have the revert.",
      "parentUuid": "8ac9b4b0_00d60a8d",
      "revId": "66955e2748cf09ece781abf33899a864fc594212",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3fa91a68_7a634c86",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1414712
      },
      "writtenOn": "2022-06-14T04:54:29Z",
      "side": 1,
      "message": "Hi Kalesh,\nThanks for your quick reply.\nActually, it shows as the below with the kernel has this revert.\ndrwxr-xr-x 109 root root 0 1970-01-01 00:00 /sys/kernel/tracing/events\nThe patch is reverted and take effect.\nHowever, the case still fails and we meet the below error message:\nE GpuMem : Failed to attach bpf program to gpu_mem/gpu_mem_total tracepoint [13(Permission denied)]\n\nAnd when apply the userspace patch,it shows as the below:\ndrwxr-xr-x 109 root readtracefs 0 1970-01-01 00:00 /sys/kernel/tracing/events\nAnd no Permission denied error log.",
      "parentUuid": "96dc8c84_d7f1f40c",
      "revId": "66955e2748cf09ece781abf33899a864fc594212",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a565c066_996443ba",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1499410
      },
      "writtenOn": "2022-06-14T05:56:08Z",
      "side": 1,
      "message": "The file that bpf program needs to be able to read is /sys/kernel/tracing/events/gpu_mem/gpu_mem_total/format. It should be world readable by default and if the directory entries have the other bits restored, you shouldn\u0027t get the permission error. Can you check the access on this path?\n\nIt would be good if you can open a bug with an attached bugreport for the issue",
      "parentUuid": "3fa91a68_7a634c86",
      "revId": "66955e2748cf09ece781abf33899a864fc594212",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6629d9f0_af072136",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1414712
      },
      "writtenOn": "2022-06-14T07:24:58Z",
      "side": 1,
      "message": "Hi Kalesh,\nI open a bug,please check the detail info.\nhttps://issuetracker.google.com/issues/235862484\n\nThe gpuservice need to read /sys/kernel/tracing/events/gpu_mem/gpu_mem_total/id.\n-r--r----- 1 root root 0 1970-01-01 00:00 /sys/kernel/tracing/events/gpu_mem/gpu_mem_total/id\nAs there is no read permission for OTH, it is reasonable it get Permission denied error.\n\nAfter you add readtracefs group,and add gpu service to readtracefs group, then it can access this path.\nhttps://android-review.googlesource.com/c/platform/system/core/+/2121295\nhttps://android-review.googlesource.com/c/platform/frameworks/native/+/2121517\n-r--r----- 1 root readtracefs 0 1970-01-01 00:00 /sys/kernel/tracing/events/gpu_mem/gpu_mem_total/id\n\nSo I think we need pick these user space patches.",
      "parentUuid": "a565c066_996443ba",
      "revId": "66955e2748cf09ece781abf33899a864fc594212",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "23d4bdc2_2193f648",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1414712
      },
      "writtenOn": "2022-06-14T07:29:43Z",
      "side": 1,
      "message": "FYI.\nThe related path permission:\nandroid 12:\ndrwxr-xr-x 2 root root 0 1970-01-01 00:00 /sys/kernel/tracing/events/gpu_mem/gpu_mem_total/\n\n$ ls -l /sys/kernel/tracing/events/gpu_mem/gpu_mem_total/            \ntotal 0\n-rw-rw-rw- 1 root root 0 1970-01-01 00:00 enable\n-rw-r----- 1 root root 0 1970-01-01 00:00 filter\n-r--r----- 1 root root 0 1970-01-01 00:00 format\n-r--r----- 1 root root 0 1970-01-01 00:00 hist\n-r--r----- 1 root root 0 1970-01-01 00:00 id\n-rw-r----- 1 root root 0 1970-01-01 00:00 trigger\n\nandroid 12L:\ndrwxr-xr-x 2 root readtracefs 0 1970-01-01 00:00 /sys/kernel/tracing/events/gpu_mem/gpu_mem_total/\n\n$ ls -l /sys/kernel/tracing/events/gpu_mem/gpu_mem_total/            \ntotal 0\n-rw-rw-rw- 1 root readtracefs 0 1970-01-01 00:00 enable\n-rw-r----- 1 root readtracefs 0 1970-01-01 00:00 filter\n-r--r----- 1 root readtracefs 0 1970-01-01 00:00 format\n-r--r----- 1 root readtracefs 0 1970-01-01 00:00 hist\n-r--r----- 1 root readtracefs 0 1970-01-01 00:00 id\n-rw-r----- 1 root readtracefs 0 1970-01-01 00:00 trigger",
      "parentUuid": "6629d9f0_af072136",
      "revId": "66955e2748cf09ece781abf33899a864fc594212",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4313ce83_8f570256",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1499410
      },
      "writtenOn": "2022-06-14T16:09:18Z",
      "side": 1,
      "message": "Hi Jessie. The GID fix-ups here, didn\u0027t solve all the user space breakages we encountered with the permission changes from the kernel. So we decided to go with the kernel reverts instead for android13. I think in your kernel it looks like you also have this change:\n\ngit log 4e4f6e33d6f22b073697098ef6fa0f33e44c391c\n\n4e4f6e33d6f2 tracing: Disable \"other\" permission bits in the tracefs files\n\nCan you revert that commit also?\n\nThanks,\nKalesh",
      "parentUuid": "23d4bdc2_2193f648",
      "revId": "66955e2748cf09ece781abf33899a864fc594212",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2230f089_1351e357",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1414712
      },
      "writtenOn": "2022-06-15T02:27:15Z",
      "side": 1,
      "message": "Hi Kalesh,\n\nYes you are right.\nRevert the below patch in kernel can also fix this issue.\n4e4f6e33d6f2 tracing: Disable \"other\" permission bits in the tracefs files\n\nHowever,our android12(L) + L5.15 releases will use the L5.15 GKI provided by Google (the first version will be ready on Jun 30th), so just reverting the patch in our native kernel won\u0027t fix the problem. \nNot sure if there is still a chance to revert the patches on the AOSP android13-5.15 kernel branch, if not, picking these user space patches might be the best option.\n\nThanks\nJessie",
      "parentUuid": "4313ce83_8f570256",
      "revId": "66955e2748cf09ece781abf33899a864fc594212",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f0acaba4_ce396513",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1499410
      },
      "writtenOn": "2022-06-15T03:43:07Z",
      "side": 1,
      "message": "Hi Jessie. I think we can still get this in since it doesn\u0027t affect the kernel ABI. Could you please file a bug to that effective -- we need some justification for the change. I will get the patch ready",
      "parentUuid": "2230f089_1351e357",
      "revId": "66955e2748cf09ece781abf33899a864fc594212",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}