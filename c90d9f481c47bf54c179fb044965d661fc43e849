{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "9b351b56_118925db",
        "filename": "libprocessgroup/setup/cgroup_map_write.cpp",
        "patchSetId": 6
      },
      "lineNbr": 285,
      "author": {
        "id": 1157738
      },
      "writtenOn": "2023-02-10T20:13:47Z",
      "side": 1,
      "message": "Here we should do:\n\n```\nif (!IsOpionalController(controller))\n   return false;\nLOG(INFO) \u003c\u003c \"Failed to activate optional controller \" \u003c\u003c controller-\u003ename();\n```",
      "range": {
        "startLine": 285,
        "startChar": 8,
        "endLine": 285,
        "endChar": 21
      },
      "revId": "c90d9f481c47bf54c179fb044965d661fc43e849",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c7d3492f_39d138e0",
        "filename": "libprocessgroup/setup/cgroup_map_write.cpp",
        "patchSetId": 6
      },
      "lineNbr": 285,
      "author": {
        "id": 1869780
      },
      "writtenOn": "2023-02-10T21:29:44Z",
      "side": 1,
      "message": "That sounds like a security risk to me. Why should failure to change the ownership and/or mode only be treated as an error if the cgroupv2 controller is not optional?",
      "parentUuid": "9b351b56_118925db",
      "range": {
        "startLine": 285,
        "startChar": 8,
        "endLine": 285,
        "endChar": 21
      },
      "revId": "c90d9f481c47bf54c179fb044965d661fc43e849",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "61e45e53_063de1c1",
        "filename": "libprocessgroup/setup/cgroup_map_write.cpp",
        "patchSetId": 6
      },
      "lineNbr": 285,
      "author": {
        "id": 1157738
      },
      "writtenOn": "2023-02-10T21:58:22Z",
      "side": 1,
      "message": "Ah, I missed this comment. The idea of optional controller is that designers consider failure to bring it up as non-critical, therefore we do not fail if that happens. That\u0027s what the original code is doing and I\u0027m trying to preserve that behavior.\nHowever now I realize that `MountV2CgroupController` should also not fail if the controller is optional to be consistent with that logic. Original version was just issuing `PLOG(ERROR) \u003c\u003c \"Failed to mount cgroup v2\"` and not failing  but that should also be wrong. I think we need the same check for `IsOpionalController` in `MountV2CgroupController`.",
      "parentUuid": "c7d3492f_39d138e0",
      "range": {
        "startLine": 285,
        "startChar": 8,
        "endLine": 285,
        "endChar": 21
      },
      "revId": "c90d9f481c47bf54c179fb044965d661fc43e849",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ddebf007_522a2112",
        "filename": "libprocessgroup/setup/cgroup_map_write.cpp",
        "patchSetId": 6
      },
      "lineNbr": 285,
      "author": {
        "id": 1157738
      },
      "writtenOn": "2023-02-10T22:01:37Z",
      "side": 1,
      "message": "Ah, I see you added that check in `MountV2CgroupController` already ðŸ˜Š\n\nTo answer your original concern about security, if we fail to change the ownership, that means that controller will not be usable by the system. But since the controller is optional, it should not be treated as a critical error. So, I think having an `IsOptionalController` here would be consistent with that logic.",
      "parentUuid": "61e45e53_063de1c1",
      "range": {
        "startLine": 285,
        "startChar": 8,
        "endLine": 285,
        "endChar": 21
      },
      "revId": "c90d9f481c47bf54c179fb044965d661fc43e849",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e147ee8c_43716835",
        "filename": "libprocessgroup/setup/cgroup_map_write.cpp",
        "patchSetId": 6
      },
      "lineNbr": 285,
      "author": {
        "id": 1869780
      },
      "writtenOn": "2023-02-10T22:21:40Z",
      "side": 1,
      "message": "\"return false\" has been changed into \"return IsOptionalController(controller)\".",
      "parentUuid": "ddebf007_522a2112",
      "range": {
        "startLine": 285,
        "startChar": 8,
        "endLine": 285,
        "endChar": 21
      },
      "revId": "c90d9f481c47bf54c179fb044965d661fc43e849",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "25fb0bba_7d08fbb9",
        "filename": "libprocessgroup/setup/cgroup_map_write.cpp",
        "patchSetId": 6
      },
      "lineNbr": 338,
      "author": {
        "id": 1157738
      },
      "writtenOn": "2023-02-10T20:13:47Z",
      "side": 1,
      "message": "same here:\n```\nif (res !\u003d 0) {\n    if (!IsOpionalController(controller))\n        return false;\n    LOG(INFO) \u003c\u003c \"Failed to mount optional controller \" \u003c\u003c controller-\u003ename();\n}\nreturn true;\n```",
      "range": {
        "startLine": 338,
        "startChar": 4,
        "endLine": 338,
        "endChar": 19
      },
      "revId": "c90d9f481c47bf54c179fb044965d661fc43e849",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b5134184_3e391ff0",
        "filename": "libprocessgroup/setup/cgroup_map_write.cpp",
        "patchSetId": 6
      },
      "lineNbr": 338,
      "author": {
        "id": 1869780
      },
      "writtenOn": "2023-02-10T21:34:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "25fb0bba_7d08fbb9",
      "range": {
        "startLine": 338,
        "startChar": 4,
        "endLine": 338,
        "endChar": 19
      },
      "revId": "c90d9f481c47bf54c179fb044965d661fc43e849",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "52f683b1_7295c1a2",
        "filename": "libprocessgroup/setup/cgroup_map_write.cpp",
        "patchSetId": 6
      },
      "lineNbr": 361,
      "author": {
        "id": 1157738
      },
      "writtenOn": "2023-02-10T20:13:47Z",
      "side": 1,
      "message": "with proposed changes this becomes simply `return success;`",
      "range": {
        "startLine": 355,
        "startChar": 4,
        "endLine": 361,
        "endChar": 17
      },
      "revId": "c90d9f481c47bf54c179fb044965d661fc43e849",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "aa5a8587_d4d3e4e8",
        "filename": "libprocessgroup/setup/cgroup_map_write.cpp",
        "patchSetId": 6
      },
      "lineNbr": 361,
      "author": {
        "id": 1869780
      },
      "writtenOn": "2023-02-10T21:34:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "52f683b1_7295c1a2",
      "range": {
        "startLine": 355,
        "startChar": 4,
        "endLine": 361,
        "endChar": 17
      },
      "revId": "c90d9f481c47bf54c179fb044965d661fc43e849",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}