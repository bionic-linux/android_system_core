{
  "comments": [
    {
      "key": {
        "uuid": "c17cc9aa_49708505",
        "filename": "adb/fastdeploy/deployagent/src/com/android/fastdeploy/DeployAgent.java",
        "patchSetId": 1
      },
      "lineNbr": 56,
      "author": {
        "id": 1079148
      },
      "writtenOn": "2018-01-11T22:33:06Z",
      "side": 1,
      "message": "Any reason these aren\u0027t just all static methods? There doesn\u0027t seem to be any state in DeployAgent.",
      "range": {
        "startLine": 56,
        "startChar": 23,
        "endLine": 56,
        "endChar": 40
      },
      "revId": "8528cd7fc4a60aa61f2bcfa82051bbd841386cfa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3cd49ef5_8c683c9e",
        "filename": "adb/fastdeploy/deployagent/src/com/android/fastdeploy/DeployAgent.java",
        "patchSetId": 1
      },
      "lineNbr": 56,
      "author": {
        "id": 1269249
      },
      "writtenOn": "2018-01-12T16:31:27Z",
      "side": 1,
      "message": "Agreed. This is a hangover from a previous approach. I\u0027m making it entirely static.",
      "parentUuid": "c17cc9aa_49708505",
      "range": {
        "startLine": 56,
        "startChar": 23,
        "endLine": 56,
        "endChar": 40
      },
      "revId": "8528cd7fc4a60aa61f2bcfa82051bbd841386cfa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "796a235e_f8b4c67c",
        "filename": "adb/fastdeploy/deployagent/src/com/android/fastdeploy/DeployAgent.java",
        "patchSetId": 1
      },
      "lineNbr": 70,
      "author": {
        "id": 1079148
      },
      "writtenOn": "2018-01-11T22:33:06Z",
      "side": 1,
      "message": "There\u0027s a few whitespace inconsistencies throughout, there\u0027s probably a tool to autoformat everything? (I\u0027ve seen some mention of using clang-format on java, but no idea whether that actually works or not)",
      "range": {
        "startLine": 69,
        "startChar": 33,
        "endLine": 70,
        "endChar": 5
      },
      "revId": "8528cd7fc4a60aa61f2bcfa82051bbd841386cfa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "efc6011a_6c8568dd",
        "filename": "adb/fastdeploy/deployagent/src/com/android/fastdeploy/DeployAgent.java",
        "patchSetId": 1
      },
      "lineNbr": 70,
      "author": {
        "id": 1269249
      },
      "writtenOn": "2018-01-12T16:31:27Z",
      "side": 1,
      "message": "For reference, I was able to do this by running:\n\n../../../../prebuilts/clang/host/linux-x86/clang-stable/bin/clang-format -i `find . -name *.java | sed \u0027:begin;$!N;s/\\n/ /;tbegin\u0027`",
      "parentUuid": "796a235e_f8b4c67c",
      "range": {
        "startLine": 69,
        "startChar": 33,
        "endLine": 70,
        "endChar": 5
      },
      "revId": "8528cd7fc4a60aa61f2bcfa82051bbd841386cfa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "71594e59_ac4cfc9c",
        "filename": "adb/fastdeploy/deployagent/src/com/android/fastdeploy/DeployAgent.java",
        "patchSetId": 1
      },
      "lineNbr": 153,
      "author": {
        "id": 1079148
      },
      "writtenOn": "2018-01-11T22:33:06Z",
      "side": 1,
      "message": "Presumably this should be a ProcessBuilder, not a StringBuilder that gets dumped into Runtime.exec?\n\nActually, shouldn\u0027t this just talk to PackageManager directly instead of execing pm? You should be able to just get the answer you want directly, instead of doing string parsing.",
      "range": {
        "startLine": 152,
        "startChar": 0,
        "endLine": 153,
        "endChar": 68
      },
      "revId": "8528cd7fc4a60aa61f2bcfa82051bbd841386cfa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "51735b9f_dd3a3e4c",
        "filename": "adb/fastdeploy/deployagent/src/com/android/fastdeploy/DeployAgent.java",
        "patchSetId": 1
      },
      "lineNbr": 153,
      "author": {
        "id": 1269249
      },
      "writtenOn": "2018-01-12T16:31:27Z",
      "side": 1,
      "message": "I am unfamiliar with ProcessBuilder but it is certainly an improvement over what I have. Before I add that though I\u0027d like input from toddke@ about whether calling pm or using PackageManager directly is the better approach here so I will add him as a reviewer.",
      "parentUuid": "71594e59_ac4cfc9c",
      "range": {
        "startLine": 152,
        "startChar": 0,
        "endLine": 153,
        "endChar": 68
      },
      "revId": "8528cd7fc4a60aa61f2bcfa82051bbd841386cfa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "832a63a9_c4c963c1",
        "filename": "adb/fastdeploy/deployagent/src/com/android/fastdeploy/DeployAgent.java",
        "patchSetId": 1
      },
      "lineNbr": 153,
      "author": {
        "id": 1060678
      },
      "writtenOn": "2018-01-17T18:38:22Z",
      "side": 1,
      "message": "It\u0027s far, far better to access the PacakgeManager APIs directly. Relying on the output of the \u0027pm\u0027 command is going to be a challenge and you\u0027ll likely curse the package manager gods for upsetting your parse logic.\n\nAs long as your code is running on device, you should be able to get to the public API.\n\n[BTW, this is essentially what you\u0027re doing when you launch the \"pm\" process; though you\u0027re doing it through the filter of the \"pm\" application]",
      "parentUuid": "51735b9f_dd3a3e4c",
      "range": {
        "startLine": 152,
        "startChar": 0,
        "endLine": 153,
        "endChar": 68
      },
      "revId": "8528cd7fc4a60aa61f2bcfa82051bbd841386cfa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d8948801_8ca65239",
        "filename": "adb/fastdeploy/deployagent/src/com/android/fastdeploy/DeployAgent.java",
        "patchSetId": 1
      },
      "lineNbr": 153,
      "author": {
        "id": 1269249
      },
      "writtenOn": "2018-01-18T15:20:03Z",
      "side": 1,
      "message": "Ok. Thanks for the clarification - not parsing output SGTM :)\n\nHowever, looking at frameworks/base/cmds/pm/src/com/android/commands/pm/Pm.java it doesn\u0027t appear to call into PackageManager directly either. It looks like it runs a \"package\" shell command which I assume ends up running the code in frameworks/base/services/core/java/com/android/server/pm/PackageManagerShellCommand.java. \n\nIs this the pattern you are suggesting? It sounds like you\u0027re suggesting I can just call PackageManager.getPackageInfo() directly but all the examples of this I can see require a Context to get a reference to PackageManager. Running as a .jar means I don\u0027t have a Context, is there another way to get a reference to the PackageManager?",
      "parentUuid": "832a63a9_c4c963c1",
      "range": {
        "startLine": 152,
        "startChar": 0,
        "endLine": 153,
        "endChar": 68
      },
      "revId": "8528cd7fc4a60aa61f2bcfa82051bbd841386cfa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5ed29ca5_7465c684",
        "filename": "adb/fastdeploy/deployagent/src/com/android/fastdeploy/DeployAgent.java",
        "patchSetId": 1
      },
      "lineNbr": 153,
      "author": {
        "id": 1060678
      },
      "writtenOn": "2018-01-18T18:07:12Z",
      "side": 1,
      "message": "Looking at the current state of master isn\u0027t very instructional. Take a look at, say, the O release -- http://go/tcoxu.\n\nYou should be able to retrieve the service directly from the ServiceManager object.",
      "parentUuid": "d8948801_8ca65239",
      "range": {
        "startLine": 152,
        "startChar": 0,
        "endLine": 153,
        "endChar": 68
      },
      "revId": "8528cd7fc4a60aa61f2bcfa82051bbd841386cfa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4ead283b_b6af6550",
        "filename": "adb/fastdeploy/deployagent/src/com/android/fastdeploy/DeployAgent.java",
        "patchSetId": 1
      },
      "lineNbr": 153,
      "author": {
        "id": 1269249
      },
      "writtenOn": "2018-01-22T18:28:33Z",
      "side": 1,
      "message": "This version uses the same approach as the pm tool in O.",
      "parentUuid": "5ed29ca5_7465c684",
      "range": {
        "startLine": 152,
        "startChar": 0,
        "endLine": 153,
        "endChar": 68
      },
      "revId": "8528cd7fc4a60aa61f2bcfa82051bbd841386cfa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c32213ee_df3c9b88",
        "filename": "adb/fastdeploy/deployagent/src/com/android/fastdeploy/DeployAgent.java",
        "patchSetId": 1
      },
      "lineNbr": 181,
      "author": {
        "id": 1079148
      },
      "writtenOn": "2018-01-11T22:33:06Z",
      "side": 1,
      "message": "It\u0027s a bit cleaner to make this return a File instead of having the caller do it, IMO",
      "range": {
        "startLine": 181,
        "startChar": 25,
        "endLine": 181,
        "endChar": 47
      },
      "revId": "8528cd7fc4a60aa61f2bcfa82051bbd841386cfa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b5f160df_2942b89f",
        "filename": "adb/fastdeploy/deployagent/src/com/android/fastdeploy/DeployAgent.java",
        "patchSetId": 1
      },
      "lineNbr": 181,
      "author": {
        "id": 1269249
      },
      "writtenOn": "2018-01-12T16:31:27Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "c32213ee_df3c9b88",
      "range": {
        "startLine": 181,
        "startChar": 25,
        "endLine": 181,
        "endChar": 47
      },
      "revId": "8528cd7fc4a60aa61f2bcfa82051bbd841386cfa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "34bf9a60_ee0627c9",
        "filename": "adb/fastdeploy/deploylib/src/com/android/fastdeploy/PatchUtils.java",
        "patchSetId": 1
      },
      "lineNbr": 26,
      "author": {
        "id": 1079148
      },
      "writtenOn": "2018-01-11T22:33:06Z",
      "side": 1,
      "message": "apkEntriesBuilder, I assume",
      "range": {
        "startLine": 26,
        "startChar": 28,
        "endLine": 26,
        "endChar": 45
      },
      "revId": "8528cd7fc4a60aa61f2bcfa82051bbd841386cfa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8731bd17_3832796e",
        "filename": "adb/fastdeploy/deploylib/src/com/android/fastdeploy/PatchUtils.java",
        "patchSetId": 1
      },
      "lineNbr": 26,
      "author": {
        "id": 1269249
      },
      "writtenOn": "2018-01-12T16:31:27Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "34bf9a60_ee0627c9",
      "range": {
        "startLine": 26,
        "startChar": 28,
        "endLine": 26,
        "endChar": 45
      },
      "revId": "8528cd7fc4a60aa61f2bcfa82051bbd841386cfa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fc15d09d_88696204",
        "filename": "adb/fastdeploy/deploylib/src/com/android/fastdeploy/PatchUtils.java",
        "patchSetId": 1
      },
      "lineNbr": 118,
      "author": {
        "id": 1079148
      },
      "writtenOn": "2018-01-11T22:33:06Z",
      "side": 1,
      "message": "Does accepting the buffer from the caller have any real performance benefit?",
      "range": {
        "startLine": 118,
        "startChar": 54,
        "endLine": 118,
        "endChar": 73
      },
      "revId": "8528cd7fc4a60aa61f2bcfa82051bbd841386cfa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "50532287_c33fa956",
        "filename": "adb/fastdeploy/deploylib/src/com/android/fastdeploy/PatchUtils.java",
        "patchSetId": 1
      },
      "lineNbr": 118,
      "author": {
        "id": 1269249
      },
      "writtenOn": "2018-01-12T16:31:27Z",
      "side": 1,
      "message": "I based this code on the bsdiff implementation here:\n\nhttps://cs.corp.google.com/piper///depot/google3/third_party/java_src/archive_patcher/applier/src/main/java/com/google/archivepatcher/applier/bsdiff/BsPatch.java?l\u003d323\n\nThat\u0027s had a lot of eyeballs on it and been used in a number of performance sensitive situations, but I don\u0027t know if there\u0027s any specific benefit to this approach. \n\nDo you have a preference for another approach (presumably passing an InputBuffer or something)? If so I can involve the original author(s).",
      "parentUuid": "fc15d09d_88696204",
      "range": {
        "startLine": 118,
        "startChar": 54,
        "endLine": 118,
        "endChar": 73
      },
      "revId": "8528cd7fc4a60aa61f2bcfa82051bbd841386cfa",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}