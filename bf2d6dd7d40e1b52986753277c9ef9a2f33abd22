{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "1674402f_7d4e8c60",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1019050
      },
      "writtenOn": "2024-02-06T21:47:50Z",
      "side": 1,
      "message": "Have you tried running debuggerd on a MTE enabled device that has a media.swcodec process? I ask because that process doesn\u0027t use the crash_dump policy for an unknown reason. I tried fixing it (include the debuggerd policy directly), so I should get back to that at some point.",
      "revId": "bf2d6dd7d40e1b52986753277c9ef9a2f33abd22",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b4c279ff_f493d0e5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1005967
      },
      "writtenOn": "2024-02-06T23:43:58Z",
      "side": 1,
      "message": "Indeed, that does not work.\n```\n5291  socket(AF_UNIX, SOCK_SEQPACKET|SOCK_CLOEXEC, 0) \u003d 14\n5291  setsockopt(14, SOL_SOCKET, SO_SNDTIMEO, \"\\5\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\", 16) \u003d 0\n5291  setsockopt(14, SOL_SOCKET, SO_RCVTIMEO, \"\\5\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\", 16) \u003d 0\n5291  connect(14, {sa_family\u003dAF_UNIX, sun_path\u003d\"/dev/socket/logdr\"}, 110) \u003d 0\n5291  write(14, \"dumpAndClose lids\u003d3 tail\u003d500 pid\"..., 37) \u003d 37\n5291  recvfrom(14, \"\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\", 5120, 0, NULL, NULL) \u003d 14\n5291  --- SIGSYS {si_signo\u003dSIGSYS, si_code\u003dSYS_SECCOMP, si_call_addr\u003d0x76fbcaaac8, si_syscall\u003d__NR_recvfrom, si_arch\u003dAUDIT_ARCH_AARCH64} ---\n5295  \u003c... ioctl resumed\u003e \u003cunfinished ...\u003e) \u003d ?\n5294  \u003c... ioctl resumed\u003e \u003cunfinished ...\u003e) \u003d ?\n5293  \u003c... ioctl resumed\u003e \u003cunfinished ...\u003e) \u003d ?\n5292  \u003c... ioctl resumed\u003e \u003cunfinished ...\u003e) \u003d ?\n5295  +++ killed by SIGSYS +++\n5294  +++ killed by SIGSYS +++\n5293  +++ killed by SIGSYS +++\n5292  +++ killed by SIGSYS +++\n5291  +++ killed by SIGSYS +++\n```",
      "parentUuid": "1674402f_7d4e8c60",
      "revId": "bf2d6dd7d40e1b52986753277c9ef9a2f33abd22",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b9d8050e_ece11ef8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1453063
      },
      "writtenOn": "2024-02-09T16:46:31Z",
      "side": 1,
      "message": "Is this what you\u0027re talking about? Seems to work for me (w/ stack MTE) on a synced build from yesterday.\n\nEither way, is that relevant to this patch and blocking, or is that unrelated?\n\n```\n$ adb shell debuggerd `adb shell pidof media.swcodec` | head -n30 | clip\n*** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***\nBuild fingerprint: \u0027google/husky_fullmte/husky:VanillaIceCream/MAIN/eng.mitchp.20240208.170118:eng/dev-keys\u0027\nRevision: \u0027PROTO1.1\u0027\nABI: \u0027arm64\u0027\nTimestamp: 2024-02-09 17:51:27.086598318+0100\nProcess uptime: 3729s\nCmdline: media.swcodec oid.media.swcodec/bin/mediaswcodec\npid: 1577, tid: 1577, name: binder:1577_2  \u003e\u003e\u003e media.swcodec \u003c\u003c\u003c\nuid: 1046\ntagged_addr_ctrl: 000000000007fff3 (PR_TAGGED_ADDR_ENABLE, PR_MTE_TCF_SYNC, mask 0xfffe)\npac_enabled_keys: 000000000000000f (PR_PAC_APIAKEY, PR_PAC_APIBKEY, PR_PAC_APDAKEY, PR_PAC_APDBKEY)\nsignal 0 (\u003cdebuggerd signal\u003e), code -1 (SI_QUEUE from pid 11336, uid 0), fault addr --------\n    x0  fffffffffffffffc  x1  00000000c0306201  x2  0d00007fed97b530  x3  0400007fed97b400\n    x4  0400007fed97b470  x5  0000000000000004  x6  2e00000000000000  x7  000000000000002e\n    x8  000000000000001d  x9  0000007fed97b4e8  x10 0000007fed97b4b0  x11 0000007fed97b4e8\n    x12 0000007fed97b510  x13 0000000000000030  x14 05000072a1b26f50  x15 0000000078ae5f39\n    x16 00000074a65792d0  x17 00000074adce6ad0  x18 00000074b096c000  x19 00000074afe21f80\n    x20 0c000073a1b2fa28  x21 0c00007fed97b560  x22 0b00007fed97b510  x23 0d00007fed97b530\n    x24 0c000073a1b2faa0  x25 00000000fffffffc  x26 00000000fffffff7  x27 00000074afe21f80\n    x28 0000000000000000  x29 0000007fed97b4f0\n    lr  00000074adce6b70  sp  0000007fed97b410  pc  00000074add38018  pst 0000000080001000\n\n8 total frames\nbacktrace:\n      #00 pc 00000000000c2018  /apex/com.android.runtime/lib64/bionic/libc.so (__ioctl+8) (BuildId: 8fff6fac238bdf311b14e03a5f38d3f3)\n      #01 pc 0000000000070b6c  /apex/com.android.runtime/lib64/bionic/libc.so (ioctl+156) (BuildId: 8fff6fac238bdf311b14e03a5f38d3f3)\n      #02 pc 00000000000574f8  /system/lib64/libbinder.so (android::IPCThreadState::talkWithDriver(bool)+312) (BuildId: f372032bf005d6b01b7805c3a8353263)\n      #03 pc 0000000000057858  /system/lib64/libbinder.so (android::IPCThreadState::getAndExecuteCommand()+24) (BuildId: f372032bf005d6b01b7805c3a8353263)\n      #04 pc 00000000000582d0  /system/lib64/libbinder.so (android::IPCThreadState::joinThreadPool(bool)+112) (BuildId: f372032bf005d6b01b7805c3a8353263)\n      #05 pc 0000000000007b18  /apex/com.android.media.swcodec/lib64/libmedia_codecserviceregistrant.so (RegisterCodecServices.cfi+4808) (BuildId: d6991a4278a659f355c1f33e6475cef5)\n```",
      "parentUuid": "b4c279ff_f493d0e5",
      "revId": "bf2d6dd7d40e1b52986753277c9ef9a2f33abd22",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "291cc82e_7ae5efab",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1019050
      },
      "writtenOn": "2024-02-09T20:04:47Z",
      "side": 1,
      "message": "Sorry, I should have indicate how to fix this. You have to modify:\n\n  frameworks/av/services/mediacodec/seccomp_policy/mediaswcodec-arm64.policy\n\nTo add the policy changes because it does not include the debuggerd policy directly.\n\nI\u0027m not why it worked in one case and not the other though.",
      "parentUuid": "b9d8050e_ece11ef8",
      "revId": "bf2d6dd7d40e1b52986753277c9ef9a2f33abd22",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4e570b11_dacfae06",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2024-02-09T20:13:00Z",
      "side": 1,
      "message": "is there a reason for that, or can we just move them over to @include?",
      "tag": "mailMessageId\u003d\u003cCAJgzZor2_LA0eACQozguRdPkothzw1L2bWW_Vjx9SSR6wznHGg@mail.gmail.com\u003e",
      "revId": "bf2d6dd7d40e1b52986753277c9ef9a2f33abd22",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "01a79452_1417faf4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2024-02-09T21:18:08Z",
      "side": 1,
      "message": "i see they already @include the _coverage_ stuff, so it seems like we ought to be able to fix this once and for all? (but then i could have sworn we already had!)",
      "parentUuid": "4e570b11_dacfae06",
      "revId": "bf2d6dd7d40e1b52986753277c9ef9a2f33abd22",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "18eafa70_8bc8bf9e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1019050
      },
      "writtenOn": "2024-02-09T21:21:11Z",
      "side": 1,
      "message": "I do have a cl up for it, but it was hard to fight the number of comments I got.\n\nThe main problem is that sepolicy parsing isn\u0027t the best, so you have to remove things that should be present because it can only exist in one place (mostly the mmap rules). But that leads to issues because it looks like the media policy is wrong.\n\nSee cl:\n\nhttps://android-review.git.corp.google.com/c/platform/frameworks/av/+/2588005\n\nI\u0027ll revive it and push to get it submitted.",
      "parentUuid": "01a79452_1417faf4",
      "revId": "bf2d6dd7d40e1b52986753277c9ef9a2f33abd22",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e8db4880_c1dcf315",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1453063
      },
      "writtenOn": "2024-02-12T15:23:29Z",
      "side": 1,
      "message": "mprotect/mmap in that sepolicy is different: `mprotect: arg2 in ~PROT_EXEC || arg2 in ~PROT_WRITE`.\n\nThat doesn\u0027t need touching by us, `PROT_MTE | PROT_WRITE | PROT_READ` fulfills that condition (`arg2 in ~PROT_EXEC`). We should never map the stack as executable :).",
      "parentUuid": "291cc82e_7ae5efab",
      "revId": "bf2d6dd7d40e1b52986753277c9ef9a2f33abd22",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1f6af44f_dedd2a8a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1453063
      },
      "writtenOn": "2024-02-14T20:12:00Z",
      "side": 1,
      "message": "@cferris - just wanted to check you\u0027re okay with this and I can submit?",
      "parentUuid": "e8db4880_c1dcf315",
      "revId": "bf2d6dd7d40e1b52986753277c9ef9a2f33abd22",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "079e3fcd_b4b8e14b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1019050
      },
      "writtenOn": "2024-02-15T19:12:27Z",
      "side": 1,
      "message": "Sorry, I didn\u0027t see an explanation for the crash Evgenii saw, but I agree that the rules as states in that policy file should not prevent PROT_MTE.\n\nI\u0027ll mark this as resolved and +2 this.",
      "parentUuid": "1f6af44f_dedd2a8a",
      "revId": "bf2d6dd7d40e1b52986753277c9ef9a2f33abd22",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1bf2c731_8acd099f",
        "filename": "debuggerd/libdebuggerd/tombstone_proto.cpp",
        "patchSetId": 1
      },
      "lineNbr": 99,
      "author": {
        "id": 1005967
      },
      "writtenOn": "2024-02-06T23:43:58Z",
      "side": 1,
      "message": "This comment is kind of obvious (\"we untag these pointers because they might be tagged :)\"), but I\u0027ll leave it up to the maintainers",
      "revId": "bf2d6dd7d40e1b52986753277c9ef9a2f33abd22",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6e794367_5a8ba658",
        "filename": "debuggerd/libdebuggerd/tombstone_proto.cpp",
        "patchSetId": 1
      },
      "lineNbr": 99,
      "author": {
        "id": 1453063
      },
      "writtenOn": "2024-02-12T15:23:29Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "1bf2c731_8acd099f",
      "revId": "bf2d6dd7d40e1b52986753277c9ef9a2f33abd22",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}