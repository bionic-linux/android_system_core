{
  "comments": [
    {
      "key": {
        "uuid": "c15d7378_1edf5a48",
        "filename": "logwrapper/logwrap.c",
        "patchSetId": 1
      },
      "lineNbr": 499,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2019-09-18T22:21:43Z",
      "side": 1,
      "message": "Is all of this fixed if we or in O_NOCTTY to this list of flags?  I\u0027ve been looking this up a bit and it seems that it should fix it too.\n\nFigure that the process doesn\u0027t have any controlling terminal in the case of `adb remount` so if we don\u0027t specify O_NOCTTY, then this terminal becomes the controlling one and we get SIGHUP when we close it().  If we set O_NOCTTY, it shouldn\u0027t become the controlling terminal, so no SIGHUP will be generated.",
      "revId": "d865fe078c9b451fc7ffe1efcc6e9bd356405d1a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c3195cb3_c554769c",
        "filename": "logwrapper/logwrap.c",
        "patchSetId": 1
      },
      "lineNbr": 499,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2019-09-19T14:52:14Z",
      "side": 1,
      "message": "I tried O_NOCTTY as one of the first things I tried :-( I even tried it on _both_ sides even for good measure.\n\n_this_ is why it does not make sense.\n\nI also tried seeing if unique_fd was affecting things (as a source of holding a file descriptor that could have been closed out-of-band, leading to a double close) by instrumenting the fd set at every phase and found _nothing_ surprising with respect to the list of open fd\u0027s. I was at one point so sure that the socket pair was getting the close (adb then turns that into an unexpected hup), but its fd was up in the 60s.\n\nAFAIK the only things I did _not_ check was setting the line discipline to raw (b/c it would be complicated, only do it for ignore_int_quit) and for a kernel bug (this problem has been tested _only_ on blueline).\n\nI will respin with O_NOCTTY set _if_ ignore_int_quit on parent ptty only as a self-documentation.",
      "parentUuid": "c15d7378_1edf5a48",
      "revId": "d865fe078c9b451fc7ffe1efcc6e9bd356405d1a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "765f2933_cc90b4cd",
        "filename": "logwrapper/logwrap.c",
        "patchSetId": 1
      },
      "lineNbr": 514,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2019-09-21T00:45:39Z",
      "side": 1,
      "message": "We need O_NOCTTY here instead.",
      "revId": "d865fe078c9b451fc7ffe1efcc6e9bd356405d1a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "eeb6bd73_ffbca658",
        "filename": "logwrapper/logwrap.c",
        "patchSetId": 1
      },
      "lineNbr": 564,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2019-09-19T15:57:55Z",
      "side": 1,
      "message": "FWIW, this is uninitialized if ignore_int_quit isn\u0027t set.  Probably better to move the variables back into the if blocks, or if we do need to make big changes, reworking this all with C++ to avoid the goto\u0027s and having real scope for the variables.",
      "range": {
        "startLine": 564,
        "startChar": 27,
        "endLine": 564,
        "endChar": 33
      },
      "revId": "d865fe078c9b451fc7ffe1efcc6e9bd356405d1a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "caafa16d_6b23118f",
        "filename": "logwrapper/logwrap.c",
        "patchSetId": 1
      },
      "lineNbr": 564,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2019-09-19T16:52:12Z",
      "side": 1,
      "message": "SideEffect: I own this ... ;-/ this is going to be _fun_",
      "parentUuid": "eeb6bd73_ffbca658",
      "range": {
        "startLine": 564,
        "startChar": 27,
        "endLine": 564,
        "endChar": 33
      },
      "revId": "d865fe078c9b451fc7ffe1efcc6e9bd356405d1a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4c633caf_d85b131c",
        "filename": "logwrapper/logwrap.c",
        "patchSetId": 1
      },
      "lineNbr": 568,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2019-09-19T16:52:12Z",
      "side": 1,
      "message": "Same for these too, a pattern of misbehavior I had no trouble repeating...",
      "range": {
        "startLine": 568,
        "startChar": 27,
        "endLine": 568,
        "endChar": 33
      },
      "revId": "d865fe078c9b451fc7ffe1efcc6e9bd356405d1a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}